/**
* AUDIO JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* lab.js
* aws-sdk
**/
function webaudioTool(){if(!("audio_context"in window)){var e=window.AudioContext||window.webkitAudioContext||false;window.audio_context=new e}logConsole("Audio is starting up ...");var t=16384;var i=null,n=null,o=null,s=null,r=null,a=null;if(!navigator.getUserMedia)navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(navigator.getUserMedia){navigator.getUserMedia({audio:true},function(e){d(e)},function(e){alert("Error capturing audio.")})}else{alert("getUserMedia not supported in this browser.")}function c(e,t,i){var n=e.length;var o=0;var s=t;console.log("__________ "+i);for(;o<s&&o<n;o+=1){console.log(e[o])}}function l(e){var t,i,n,o;o=e.inputBuffer.getChannelData(0);c(o,5,"from getChannelData")}function d(e){o=window.audio_context.createGain();o.connect(window.audio_context.destination);n=window.audio_context.createMediaStreamSource(e);n.connect(o);s=window.audio_context.createScriptProcessor(t,1,1);s.onaudioprocess=l;n.connect(s);document.getElementById("volume").addEventListener("change",function(){var e=this.value;o.gain.value=e;console.log("curr_volume ",e)});r=window.audio_context.createScriptProcessor(2048,1,1);r.connect(o);a=window.audio_context.createAnalyser();a.smoothingTimeConstant=0;a.fftSize=2048;n.connect(a);a.connect(r);r.onaudioprocess=function(){var e=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(e);var t=mode(e,e.length);var i=mode(e,25);var o=getAverageVolume(e);if(n.playbackState==n.PLAYING_STATE){updateVTP(o,i,t);console.log(JSON.stringify($("meta[name=vtp]").data()))}}}}function filterEcho(e,t){function i(e){var t=e.current_words;var n=e.previous_words;var o=e.cleaned_words;if(!t.length){return e}else{var s=n.indexOf(t[-1]);if(s==-1){o.unshift(t[-1]);t.splice(-1,1);i({current_words:t,previous_words:n,cleaned_words:o})}else{if(t.length==1){t.splice(0,1);i({current_words:t,previous_words:n,cleaned_words:o})}else if(s==0){t.splice(0,1);for(var r=0;r<t.length;r++){o.unshift(t[-1]);t.splice(-1,1)}i({current_words:t,previous_words:n,cleaned_words:o})}else{n.splice(s,n.length-s);prior_index=n.indexOf(t[-2]);if(prior_index==-1){t.splice(-1,1);i({current_words:t,previous_words:n,cleaned_words:o})}else{n.splice(prior_index,n.length-prior_index);t.splice(-1,1);i({current_words:t,previous_words:n,cleaned_words:o})}}}}}var n={current_words:e.split(" "),previous_words:t.split(" "),cleaned_words:[]};n=i(n);return n.cleaned_words}function timestampTranscription(e,t){var i=[];var n=0;var o=0;var s=false;var r=e.split(" ");for(var a=0;a<r.length;a++){for(var c=n;c<t.length;c++){var l=t[c].text.split(" ");for(var d=o;d<l.length;d++){if(r[a]==l[d]){i.push({t:r[a],dt:t[c].dt});n=c;o=d;s=true;break}else if(c+1==t.length){for(var f=0;f<t.length;f++){var v=t[f].text.split(" ");for(var u=0;u<v.length;u++){if(r[a]==v[u]){i.push({t:r[a],dt:t[f].dt});n=f;o=u}else{i.push({t:r[a],dt:$.now()/1e3})}s=true;break}if(s){break}}if(s){break}}}if(s){s=false;break}}}var p=0;var g=0;for(var a=0;a<i.length;a++){if(i[a].dt==g){p+=1e-6;i[a].dt=g+p}else{p=0;g=i[a].dt}}return i}function startSpeechRecognition(e,t=null,i="text",n=null){if(!window.hasOwnProperty("webkitSpeechRecognition")){logConsole("webkitSpeechRecognition not supported by device")}else{if(!("speech_recognition_client"in window)){window.speech_recognition_client=new webkitSpeechRecognition;window.speech_recognition_properties={timestamp:0,speech_in_progress:false,parsing_in_progress:false,transcribed_text:"",transcribed_markup:[],interim_text:"",interim_array:[],interim_callback:t,final_callback:e,filter_callable:n}}window.speech_recognition_client.continuous=true;window.speech_recognition_client.interimResults=true;window.speech_recognition_client.onstart=function(){window.speech_recognition_properties.parsing_in_progress=true};window.speech_recognition_client.onresult=function(e){if("speech_recognition_properties"in window){window.speech_recognition_properties.speech_in_progress=true;if(!window.speech_recognition_properties.timestamp){window.speech_recognition_properties.timestamp=e.timeStamp}if(e.results.length){var t=e.results[0][0].transcript;window.speech_recognition_properties.interim_text=t;window.speech_recognition_properties.interim_array.push({text:t,dt:$.now()/1e3});if(i=="timestamp"){var n=timestampTranscription(t,window.speech_recognition_properties.interim_array)}else{var n=t}if(window.speech_recognition_properties.interim_callback){window.speech_recognition_properties.interim_callback(n)}}for(var o=e.resultIndex;o<e.results.length;++o){var s=e.results[o][0].transcript;if(e.results[o].isFinal){if(i=="timestamp"){var r=timestampTranscription(s,window.speech_recognition_properties.interim_array);window.speech_recognition_properties.transcribed_markup=r}else{var r=s}if(window.speech_recognition_properties.filter_callable){s=window.speech_recognition_properties.filter_callable(r)}if(window.speech_recognition_properties.final_callback){window.speech_recognition_properties.final_callback(r)}window.speech_recognition_properties.transcribed_text=s;window.speech_recognition_properties.interim_text="";window.speech_recognition_properties.interim_array=[];if("speech_recognition_client"in window){window.speech_recognition_client.stop()}}}}};window.speech_recognition_client.onerror=function(e){logConsole("Error transcribing speech: "+e.error)};window.speech_recognition_client.onend=function(e){if("speech_recognition_properties"in window){window.speech_recognition_properties.speech_in_progress=false;if("speech_recognition_on"in window){window.speech_recognition_client.start()}}};window.speech_recognition_client.start();window.speech_recognition_on=true;window.speech_recognition_reset=setInterval(function(){if(window.speech_recognition_properties.speech_in_progress==false){if("speech_recognition_client"in window){window.speech_recognition_client.stop()}}},1e4)}}function stopSpeechRecognition(){if("speech_recognition_reset"in window){clearInterval(window.speech_recognition_reset)}if("speech_recognition_on"in window){delete window.speech_recognition_on}if("speech_recognition_properties"in window){delete window.speech_transcription_properties}if("speech_recognition_client"in window){window.speech_recognition_client.stop();delete window.speech_recognition_client}}function startSpeechTranscription(e,t=null,i="text",n=null,o=null){if(!window.hasOwnProperty("webkitSpeechRecognition")){logConsole("webkitSpeechRecognition not supported by device")}else{if(!("speech_transcription_properties"in window)){window.speech_transcription_properties={timestamp:0,speech_in_progress:false,parsing_in_progress:false,transcribed_text:"",transcribed_markup:[],interim_text:"",interim_array:[],interim_callback:t,final_callback:e,filter_callable:n}}if(!("speech_transcription_client"in window)){window.speech_transcription_client=new webkitSpeechRecognition}window.speech_transcription_client.continuous=true;window.speech_transcription_client.interimResults=true;window.speech_transcription_client.onstart=function(){window.speech_transcription_properties.parsing_in_progress=true};window.speech_transcription_client.onresult=function(e){if("speech_transcription_properties"in window){window.speech_transcription_properties.speech_in_progress=true;if(!window.speech_transcription_properties.timestamp){window.speech_transcription_properties.timestamp=e.timeStamp}if(e.results.length){var t=e.results[0][0].transcript;window.speech_transcription_properties.interim_text=t;window.speech_transcription_properties.interim_array.push({text:t,dt:$.now()/1e3});if(i=="timestamp"){var n=timestampTranscription(t,window.speech_transcription_properties.interim_array)}else{var n=t}if(window.speech_transcription_properties.interim_callback){window.speech_transcription_properties.interim_callback(n)}}for(var o=e.resultIndex;o<e.results.length;++o){var s=e.results[o][0].transcript;if(e.results[o].isFinal){if(i=="timestamp"){var r=timestampTranscription(s,window.speech_transcription_properties.interim_array);window.speech_transcription_properties.transcribed_markup=r}else{var r=s}if(window.speech_transcription_properties.filter_callable){s=window.speech_transcription_properties.filter_callable(r)}if(window.speech_transcription_properties.final_callback){window.speech_transcription_properties.final_callback(r)}window.speech_transcription_properties.transcribed_text=s;window.speech_transcription_properties.interim_text="";window.speech_transcription_properties.interim_array=[];if("speech_transcription_client"in window){window.speech_transcription_client.stop()}}}}};window.speech_transcription_client.onerror=function(e){logConsole("Error transcribing speech: "+e.error);if(o){o(e.error)}};window.speech_transcription_client.onend=function(e){if("speech_transcription_properties"in window){window.speech_transcription_properties.speech_in_progress=false;if("speech_transcription_on"in window){window.speech_transcription_client.start()}}};window.speech_transcription_client.start();window.speech_transcription_on=true;window.speech_transcription_reset=setInterval(function(){if(window.speech_transcription_properties.speech_in_progress==false){if("speech_transcription_client"in window){window.speech_transcription_client.stop()}}},1e4)}}function stopSpeechTranscription(){if("speech_transcription_reset"in window){clearInterval(window.speech_transcription_reset)}if("speech_transcription_on"in window){delete window.speech_transcription_on}if("speech_transcription_properties"in window){delete window.speech_transcription_properties}if("speech_transcription_client"in window){window.speech_transcription_client.stop();delete window.speech_transcription_client}}function playAudio(e,t,i=.5,n=true){if(!("audio_context"in window)){var o=window.AudioContext||window.webkitAudioContext;window.audio_context=new o}if(!("volume_level"in window)){window.volume_level=window.audio_context.createGain()}var s=["audio/mpeg","audio/wav","audio/ogg"];if(s.indexOf(ingestString(t))==-1){logConsole("content_type must be one of "+JSON.stringify(s))}if(typeof i!="number"){i=1}else if(ingestNumber(i)<0||ingestNumber(i)>1){i=1}function r(e,o,s,r){var a="data:"+t+";base64,"+s;var c=new XMLHttpRequest;c.open("GET",a);c.responseType="arraybuffer";c.onload=function(){e.decodeAudioData(c.response,function(t){var s=t;var r=e.createBufferSource();r.buffer=s;o.gain.value=i;r.connect(o);o.connect(e.destination);if(n){if("speech_recognition_client"in window){r.onended=function(e){window.speech_recognition_on=true;window.speech_recognition_client.start()};delete window.speech_recognition_on;window.speech_recognition_client.stop()}if("speech_transcription_client"in window){r.onended=function(e){window.speech_transcription_on=true;window.speech_transcription_client.start()};delete window.speech_transcription_on;window.speech_transcription_client.stop()}}r.start(0)})};c.send()}r(window.audio_context,window.volume_level,e,t)}function streamAudio(e){}function synthesizeSpeech(e,t="Nicole",n=null){if(!("audio_context"in window)){var o=window.AudioContext||window.webkitAudioContext;window.audio_context=new o}function s(e,t){var n=new ArrayBuffer(t.length);var o=new Uint8Array(n);for(i=0;i<t.length;i++){o[i]=t[i]}e.decodeAudioData(n,function(t){buf=t;var i=e.createBufferSource();i.buffer=buf;i.connect(e.destination);i.start(0)})}var r=["Geraint","Gwyneth","Mads","Naja","Hans","Marlene","Nicole","Russell","Amy","Brian","Emma","Raveena","Ivy","Joanna","Joey","Justin","Kendra","Kimberly","Matthew","Salli","Conchita","Enrique","Miguel","Penelope","Chantal","Celine","Mathieu","Dora","Karl","Carla","Giorgio","Mizuki","Liv","Lotte","Ruben","Ewa","Jacek","Jan","Maja","Ricardo","Vitoria","Cristiano","Ines","Carmen","Maxim","Tatyana","Astrid","Filiz","Vicki","Takumi"];if(r.indexOf(ingestString(t))==-1){logConsole("voice_id must be one of "+JSON.stringify(r))}var a=ingestMap(aws_polly_cred);var c={accessKeyId:a.aws_polly_access_key_id,secretAccessKey:a.aws_polly_secret_access_key,region:a.aws_polly_default_region};var l=new AWS.Polly(c);var d={OutputFormat:"mp3",Text:text_message,TextType:"text",VoiceId:t};l.synthesizeSpeech(d,function(e,t){if(e){logConsole("Error synthesizing speech:"+e)}else{s(window.audio_context,t.AudioStream)}})}function synthesizeSpeechChrome(e){default_lang="en-US";logConsole(default_lang);if(default_lang){if("speechSynthesis"in window){if("SpeechSynthesisUtterance"in window){var t=new SpeechSynthesisUtterance;t.text=e;t.volume=1;t.lang=default_lang;t.rate=1;t.pitch=1;t.onstart=function(){console.log("Synthesis Started")};t.onpause=function(){console.log("Synthesis Paused")};t.onresume=function(){console.log("Synthesis Resumed after Pause")};t.onend=function(){console.log("Synthesis Stopped")};logConsole("synthesis attempt");speechSynthesis.speak(t)}}}}
/**
* SOCKETS JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* socket.io-client
* lab.js
* requests.js
**/function updateRooms(e,t){if(!("socket_rooms"in window)){window.socket_rooms=[]}e=ingestString(e);t=ingestString(t);var i=window.socket_rooms;if(e=="join"){var n=i.indexOf(t);if(n==-1){i.push(t)}}else if(e=="leave"){var n=i.indexOf(t);if(n>-1){i.splice(n,1)}}else if(e=="clear"){window.socket_rooms=[];i=[]}return i}function joiningRoom(e,t){var i=new $.Deferred;e.emit("join",{room_id:t},function(e){if(ingestString(e.room_id)){updateRooms("join",e.room_id);i.resolve(e.room_id)}else{i.reject(e)}});i.promise()}function leavingRoom(e,t){var i=new $.Deferred;e.emit("leave",{room_id:t},function(e){if(ingestString(e.room_id)){updateRooms("leave",e.room_id);i.resolve(e.room_id)}else{i.reject(e)}});i.promise()}function handleEvents(e,t,i,n){e.on("reconnect_error",function(){var e=connectingClient(t);reconnect_error.fail(function(e){if(window.device_online){disconnectClient()}})});e.on("connect",function(e){$(i).text("Connected");console.log("Socket Connected");window.device_online=true});e.on("disconnect",function(e){$(i).text("Disconnected");console.log("Socket Disconnected");window.device_online=false});if(ingestString(n)){var o=[];window.ping_pong=setInterval(function(){var t=(new Date).getTime();e.emit("ping_pong",{time:t},function(e){var t=(new Date).getTime()-e.time;o.push(t);if(o.length>30){o=o.slice(-30)}var i=0;for(var s=0;s<o.length;s++)i+=o[s];var r=Math.round(10*i/o.length)/10;$(n).text(r)})},1e3)}e.on("callable",function(e){var t=ingestString(e.func);var i=ingestArray(e.args);if(!(t in window)){logConsole("Error: "+t+" is not in window.")}else{if(i.length){t(...i)}else{t()}}})}function connectingClient(e){var t=new $.Deferred;function i(){logConsole("Cannot connect to websocket at "+e+". Device offline.");t.reject(null)}var n=patchingSession();n.done(function(i){window.socket_client=io.connect(e,{query:{session_token:i}});if(!("socket_channels"in window)){window.socket_channels=[]}t.resolve(window.socket_client)});n.fail(function(n){handlingSession(n).fail(function(o){if(o=="acquired"){if("authentication_view"in window){t.reject();window.authentication_view()}else{t.reject();openAuthentication()}}else if(o=="renewal"){var s=connectingClient(e);s.done(function(e){t.resolve(e)});s.fail(function(e){if(!window.device_online){i()}else{t.reject(e)}})}else if(!window.device_online){i()}else{t.reject(n)}})});return t.promise()}function disconnectClient(){try{if("ping_pong"in window){clearInterval(window.ping_pong)}if("socket_client"in window){window.socket_client.disconnect();delete window.socket_client}window.socket_channels=[];updateRooms("clear")}catch(e){}}function handlingSocket(e,t=null,i=null){var n=new $.Deferred;function o(e,t,i){if(e){var o=[i];if(ingestArray(t).length){o.push(...t)}e(...o)}n.resolve(i)}if("socket_client"in window){o(t,i,window.socket_client)}else{var s=connectingClient(e);s.done(function(n){handleEvents(n,e);o(t,i,n)});s.fail(function(e){n.reject(e)})}return n.promise()}function toggleConnection(e,t,i){if(!("server_url"in window)){window.server_url="/"}var n=$(e);if("socket_client"in window){disconnectClient();n.text("Connect");n.off();n.on("click",function(){toggleConnection(e,t,i)})}else{var o=connectingClient(window.server_url);o.done(function(o){handleEvents(o,t,i);n.text("Disconnect");n.off();n.on("click",function(){toggleConnection(e,t,i)})})}}function retrieveIPAddress(e){var t={};var i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var n=!!window.webkitRTCPeerConnection;if(!i){$("<iframe/>",{id:"lab_rtc_iframe",style:"display: none;",sandbox:"allow-same-origin"}).appendTo($("body"));var o=$("#lab_rtc_iframe").contentWindow;i=o.RTCPeerConnection||o.mozRTCPeerConnection||o.webkitRTCPeerConnection;n=!!o.webkitRTCPeerConnection}var s={optional:[{RtpDataChannels:true}]};var r={iceServers:[{urls:"stun:stun.services.mozilla.com"}]};var a=new i(r,s);function c(i){var n=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}:(:[a-f0-9]{1,4}){6,7})/;var o=n.exec(i);if(o){try{var s=n.exec(i)[1];if(t[s]===undefined)e(s);t[s]=true}catch(e){}}}a.onicecandidate=function(e){if(e.candidate)c(e.candidate.candidate)};a.createDataChannel("");a.createOffer(function(e){a.setLocalDescription(e,function(){},function(){})},function(){});setTimeout(function(){var e=a.localDescription.sdp.split("\n");e.forEach(function(e){if(e.indexOf("a=candidate:")===0)c(e)})},500)}
/**
* REQUESTS JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* lab.js
* data.js
* fingerprints.js
* views.js
**/window.device_online=true;function errorConstructor(e,t){var i=e.status;var n={};try{n=JSON.parse(e.responseText)}catch(e){}var o="Errr! ";if(i===0){o+="No connection. Check network settings.";window.device_online=false}else if(i==404){o+="Page not found. [404]"}else if(i==500){o+="Internal Server Error [500]."}else if(t==="timeout"){o+="Request timeout."}else if(t==="abort"){o+="Request aborted."}else if(mapSize(ingestMap(n))){if(ingestString(n.error)){o+=n.error}}console.log(o);return o}function requestingResource(e){var t=new $.Deferred;function i(e){logConsole("Request Successful.");window.device_online=true;t.resolve(e)}function n(e,i){const n=errorConstructor(e,i);t.reject(n)}function o(){console.log("Waiting...")}var s={schema:{method:"GET",route:"/schema/lab-mission",body:{},params:{},success:i,error:n,wait:o,headers:{}},components:{".method":{discrete_values:["GET","POST","DELETE","PATCH","PUT"]}}};var r=s.schema;unpackKwargs(e,r,"requestingResource");r.headers["X-Timestamp"]=$.now()/1e3;var a=ingestString(loadRecord("session_token"));if(a){r.headers["X-Sessiontoken"]=a}var c=window.server_url+r.route;if(mapSize(r.params)){c+="?";c+=$.param(r.params)}var l={method:r.method,timeout:12e3,crossDomain:true,headers:{},url:c,contentType:"application/json",success:r.success,error:r.error};if(Object.keys(r.body).length&&r.method!="GET"){l.data=JSON.stringify(r.body)}for(var d in r.headers){l.headers[d]=r.headers[d]}$.ajax(l);r.wait();return t.promise()}function methodConstructor(e){var t={schema:{dt:0,id:"",code:0,error:"",methods:[]}};var i=t.schema;unpackKwargs(e,i,"methodConstructor");if(i["methods"]){if(ingestArray(i["methods"]).length){for(var n=0;n<i["methods"].length;n++){try{var o=ingestString(i["methods"][n]["function"]);var s=ingestArray(i["methods"][n]["args"]);callFunction(o,s)}catch(e){var r="Errr! Error constructing method "+o+".";console.log(r);throw e}}}}}function stringRequest(e){updateHistory("stringRequest",[e]);var t={method:"POST",route:"/web",body:{content:e,mode:"text",fingerprint:{},history:window.client_history}};if(mapSize(ingestMap(window.client_fingerprint))){t.body.fingerprint=window.client_fingerprint;requestingResource(t).then(methodConstructor)}else{initializeFingerprint().then(function(){t.body.fingerprint=window.client_fingerprint;requestingResource(t).then(methodConstructor)})}}function methodRequest(e,t){function i(t){var i=ingestMap(t.details);var n=[];if(mapSize(i)){n=[i]}callFunction(e,n)}requestingResource(t).done(i)}function gettingResource(e){var t=new $.Deferred;var e=window.server_url+e;var i={method:"GET",timeout:12e3,crossDomain:true,headers:{},url:e,contentType:"application/json",success:function(e){window.device_online=true;t.resolve(e.details)},error:function(e,i){var n=errorConstructor(e,i);t.reject(n)}};i.headers["X-Timestamp"]=$.now()/1e3;var n=ingestString(loadRecord("session_token"));if(n){i.headers["X-Sessiontoken"]=n}$.ajax(i);return t.promise()}function postingResource(e,t){var i=new $.Deferred;var e=window.server_url+e;var n={method:"POST",timeout:12e3,crossDomain:true,headers:{},data:JSON.stringify(t),url:e,contentType:"application/json",success:function(e){window.device_online=true;i.resolve(e.details)},error:function(e,t){var n=errorConstructor(e,t);i.reject(n)}};n.headers["X-Timestamp"]=$.now()/1e3;var o=ingestString(loadRecord("session_token"));if(o){n.headers["X-Sessiontoken"]=o}$.ajax(n);return i.promise()}function deletingResource(e){var t=new $.Deferred;var e=window.server_url+e;var i={method:"DELETE",timeout:12e3,crossDomain:true,headers:{},url:e,contentType:"application/json",success:function(e){window.device_online=true;t.resolve(e.details)},error:function(e,i){var n=errorConstructor(e,i);t.reject(n)}};i.headers["X-Timestamp"]=$.now()/1e3;var n=ingestString(loadRecord("session_token"));if(n){i.headers["X-Sessiontoken"]=n}$.ajax(i);return t.promise()}function gettingSession(){var e=new $.Deferred;var t=window.server_url+"/session";var i={method:"GET",timeout:12e3,crossDomain:true,headers:{},url:t,contentType:"application/json",success:function(t){window.device_online=true;var i=t.details.session_token;saveRecord("session_token",i);console.log("Session token acquired.");e.resolve(i)},error:function(t,i){var n=errorConstructor(t,i);e.reject(n)}};$.ajax(i);console.log("Retrieving new session token.");return e.promise()}function puttingSession(e){var t=new $.Deferred;var i=window.server_url+"/session";var n={method:"PUT",timeout:12e3,crossDomain:true,headers:{},url:i,contentType:"application/json",success:function(i){window.device_online=true;var n=i.details.session_token;var o=i.details.confirm;saveRecord("session_token",n);console.log("Session token updated.");t.resolve(n,e,o)},error:function(e,i){var n=errorConstructor(e,i);t.reject(n)}};n.headers["X-Timestamp"]=$.now()/1e3;var o=ingestString(loadRecord("session_token"));if(o){n.headers["X-Sessiontoken"]=o}var s={account_email:e};if(mapSize(ingestMap(window.client_fingerprint))){s["client_fingerprint"]=window.client_fingerprint;n.data=JSON.stringify(s);$.ajax(n)}else{initializeFingerprint().then(function(e){s["client_fingerprint"]=e;n.data=JSON.stringify(s);$.ajax(n)})}return t.promise()}function postingSession(e){var t=new $.Deferred;var i=window.server_url+"/session";var n={method:"POST",timeout:12e3,crossDomain:true,headers:{},url:i,contentType:"application/json",success:function(e){window.device_online=true;var i=false;var n=e.details.session_token;saveRecord("session_token",n);var o=ingestMap(e.details.gateway_auth);if(mapSize(o)){saveRecord("gateway_auth",o);i=true;startingPouchDB().then(function(){t.resolve(n,i)})}console.log("Session token updated.");if(!i){t.resolve(n,i)}},error:function(e,i){var n=errorConstructor(e,i);t.reject(n)}};n.headers["X-Timestamp"]=$.now()/1e3;var o=ingestString(loadRecord("session_token"));if(o){n.headers["X-Sessiontoken"]=o}var s={account_password:e};if(mapSize(ingestMap(window.client_fingerprint))){s["client_fingerprint"]=window.client_fingerprint;n.data=JSON.stringify(s);$.ajax(n)}else{initializeFingerprint().then(function(e){s["client_fingerprint"]=e;n.data=JSON.stringify(s);$.ajax(n)})}return t.promise()}function patchingSession(){var e=new $.Deferred;var t=window.server_url+"/session";var i={method:"PATCH",timeout:12e3,crossDomain:true,headers:{},url:t,contentType:"application/json",success:function(t){window.device_online=true;var i=t.details.session_token;saveRecord("session_token",i);console.log("Session token updated.");e.resolve(i)},error:function(t,i){var n=errorConstructor(t,i);e.reject(n)}};i.headers["X-Timestamp"]=$.now()/1e3;var n=ingestString(loadRecord("session_token"));if(n){i.headers["X-Sessiontoken"]=n}var o={};initializeFingerprint().then(function(e){o["client_fingerprint"]=e;i.data=JSON.stringify(o);$.ajax(i)});console.log("Renewing device signature.");return e.promise()}function gettingAccount(){var e=new $.Deferred;var t="account_settings";var i={method:"GET",route:"/account"};function n(){loadRecord(t,function(t){console.log("Device offline. Using local device records.");e.resolve(t)})}if(!ingestBoolean(window.device_online)){n()}else{function o(i){var n=i.details;var o=ingestNumber(i.updated);saveRecord(t,n,o);e.resolve(n)}var s=requestingResource(i);s.done(o);s.fail(function(t){handlingSession(t).fail(function(i){if(i=="acquired"){if("authentication_view"in window){window.authentication_view()}else{openAuthentication()}}else if(i=="renewal"){var o=gettingAccount();o.done(function(t){e.resolve(t)});o.fail(function(t){if(!window.device_online){n()}else{e.reject(t)}})}else if(!window.device_online){n()}else{e.reject(t)}})})}return e.promise()}function puttingAccount(e,t){var i=new $.Deferred;var n=window.server_url+"/account";var o={method:"PUT",timeout:12e3,crossDomain:true,headers:{},url:n,contentType:"application/json",success:function(t){window.device_online=true;var n=t.details.session_token;saveRecord("session_token",n);console.log("Account created.");i.resolve(n,e)},error:function(e,t){var n=errorConstructor(e,t);i.reject(n)}};o.headers["X-Timestamp"]=$.now()/1e3;var s=ingestString(loadRecord("session_token"));if(s){o.headers["X-Sessiontoken"]=s}var r={account_email:e};if(ingestString(t)){r["account_password"]=t}if(mapSize(ingestMap(window.client_fingerprint))){r["client_fingerprint"]=window.client_fingerprint;o.data=JSON.stringify(r);$.ajax(o)}else{initializeFingerprint().then(function(e){r["client_fingerprint"]=e;o.data=JSON.stringify(r);$.ajax(o)})}return i.promise()}function postingAccount(e,t){var i=new $.Deferred;var n=window.server_url+"/account";var o={method:"POST",timeout:12e3,crossDomain:true,headers:{},url:n,contentType:"application/json",success:function(t){window.device_online=true;var n=t.details.session_token;var o=t.details.confirm;saveRecord("session_token",n);if(o){console.log("Confirmation resent.")}else{console.log("Reset sent.")}i.resolve(n,e)},error:function(e,t){var n=errorConstructor(e,t);i.reject(n)}};o.headers["X-Timestamp"]=$.now()/1e3;var s=ingestString(loadRecord("session_token"));if(s){o.headers["X-Sessiontoken"]=s}var r={account_email:e,account_action:t};if(mapSize(ingestMap(window.client_fingerprint))){r["client_fingerprint"]=window.client_fingerprint;o.data=JSON.stringify(r);$.ajax(o)}else{initializeFingerprint().then(function(e){r["client_fingerprint"]=e;o.data=JSON.stringify(r);$.ajax(o)})}return i.promise()}function patchingAccount(e="",t="",i="",n=""){var o=new $.Deferred;var s=window.server_url+"/account";var r={method:"PATCH",timeout:12e3,crossDomain:true,headers:{},url:s,contentType:"application/json",success:function(e){window.device_online=true;var t=e.details.session_token;saveRecord("session_token",t);var i=ingestMap(e.details.gateway_auth);var n=false;if(mapSize(i)){saveRecord("gateway_auth",i);n=true;startingPouchDB().then(function(){console.log("Account confirmed.");o.resolve(t)})}if(!n){console.log("Password updated.");o.resolve(t)}},error:function(e,t){var i=errorConstructor(e,t);o.reject(i)}};r.headers["X-Timestamp"]=$.now()/1e3;var a=ingestString(loadRecord("session_token"));if(a){r.headers["X-Sessiontoken"]=a}var c={};if(e){c["new_password"]=e}if(t){c["account_password"]=t}if(i){c["account_token"]=i}if(n){c["new_email"]=n}if(mapSize(ingestMap(window.client_fingerprint))){c["client_fingerprint"]=window.client_fingerprint;r.data=JSON.stringify(c);$.ajax(r)}else{initializeFingerprint().then(function(e){c["client_fingerprint"]=e;r.data=JSON.stringify(c);$.ajax(r)})}return o.promise()}function deletingAccount(e,t){var i=new $.Deferred;var n=window.server_url+"/account";var o={method:"DELETE",timeout:12e3,crossDomain:true,headers:{},url:n,contentType:"application/json",success:function(t){window.device_online=true;var n=t.details.session_token;saveRecord("session_token",n);var o=ingestMap(t.details.gateway_auth);var s=false;if(mapSize(o)){saveRecord("gateway_auth",o);s=true;startingPouchDB().then(function(){i.resolve(n)})}else{stoppingPouch(window.pouch_db);deleteRecord("gateway_auth")}console.log("Account "+e+"d.");if(!s){i.resolve(n)}},error:function(e,t){var n=errorConstructor(e,t);i.reject(n)}};o.headers["X-Timestamp"]=$.now()/1e3;var s=ingestString(loadRecord("session_token"));if(s){o.headers["X-Sessiontoken"]=s}var r={status_action:e,account_password:t};if(mapSize(ingestMap(window.client_fingerprint))){r["client_fingerprint"]=window.client_fingerprint;o.data=JSON.stringify(r);$.ajax(o)}else{initializeFingerprint().then(function(e){r["client_fingerprint"]=e;o.data=JSON.stringify(r);$.ajax(o)})}return i.promise()}function handlingSession(e){var t=new $.Deferred;error_patterns={expired:new RegExp(/Session\stoken\shas\sexpired/g),decoding:new RegExp(/Session\stoken\sdecoding\serror/g),renewal:new RegExp(/Device\ssignature\shas\sexpired/g),confirm:new RegExp(/Account\shas\snot\sbeen\sconfirmed/g),anonymous:new RegExp(/Account\sis\snot\sauthenticated/g),missing:new RegExp(/Account\sdoes\snot\sexist/g),password:new RegExp(/Password\sdoes\snot\smatch\spassword\son\srecord/g),deactivated:new RegExp(/Account\shas\sbeen\sdeactivated/g)};if(window.error_patterns.expired.test(e)||window.error_patterns.decoding.test(e)){deleteRecord("session_token");gettingSession().then(function(e){t.reject("acquired")})}else if(window.error_patterns.renewal.test(e)){patchingSession().then(function(e){t.reject("renewal")})}else if(window.error_patterns.anonymous.test(e)){t.reject("authentication");if("authentication_view"in window){window.authentication_view()}else{openAuthentication()}}else if(window.error_patterns.deactivated.test(e)){t.reject("deactivated");openAccount()}else{t.reject(e)}return t.promise()}function requestingOAuthToken(e,t,i=null){var n=new $.Deferred;function o(e){if(i){n.resolve();callFunction(i,[e])}else{n.resolve(e)}}if(!ingestBoolean(window.device_online)){n.reject("Device offline.")}else{function s(e){window.device_online=true;var t=e.details.auth_url;var i=window.open(t,"_blank");var s=0;var r=setInterval(function(){try{var e=ingestString(i.document.URL);if(e.indexOf(window.server_url)>-1&&e.indexOf("authorize")==-1){var t=$(i.document).contents().find("[name=oauth2_service_callback]");if(t.length){setTimeout(function(){try{i.close()}catch(e){}},1e4);o("success")}else{try{i.close()}catch(e){}n.reject("Permission denied.")}window.clearInterval(r)}s+=1}catch(e){try{if(i.closed){window.clearInterval(r);n.reject("Authorization closed.")}else{s+=1}}catch(e){s+=1}}if(s>300){try{i.close()}catch(e){}window.clearInterval(r);n.reject("Authorization timeout.")}},500)}var r=window.server_url+"/urls/oauth2/"+e.replace(/_/g,"-");var a={scope:t.join(" ")};r=r+"?"+$.param(a);var c={method:"GET",timeout:12e3,crossDomain:true,headers:{"X-Timestamp":$.now()/1e3},url:r,contentType:"application/json",success:s,error:function(e,t){const i=errorConstructor(e,t);handlingSession(i).always(function(e){if(e=="renewal"){var t="Expired device signature was renewed. Try again.";n.reject(t)}else{n.reject(e)}})},async:false};var l=ingestString(loadRecord("session_token"));if(l){c.headers["X-Sessiontoken"]=l}$.ajax(c)}return n.promise()}function renewingOAuthToken(e,t=null){logConsole("renewing");var i=new $.Deferred;function n(e){if(t){i.resolve();callFunction(t,[e])}else{i.resolve(e)}}if(!ingestBoolean(window.device_online)){i.reject("Device offline.")}else{var o=window.server_url+"/authorize/"+e.replace(/_/g,"-");var s={method:"PATCH",timeout:12e3,crossDomain:true,headers:{"X-Timestamp":$.now()/1e3},url:o,contentType:"application/json",success:function(e){logConsole(o);logConsole(["success",e.status]);window.device_online=true;n(e.details.token)},error:function(n,s){logConsole(o);logConsole(["error",n.status]);const r=errorConstructor(n,s);handlingSession(r).always(function(n){if(n=="renewal"){var o=renewingOAuthToken(e,t);o.done(function(e){i.resolve(e)});o.fail(function(e){i.reject(e)})}else{i.reject(n)}})}};var r=ingestString(loadRecord("session_token"));if(r){s.headers["X-Sessiontoken"]=r}$.ajax(s)}return i.promise()}function loadingItem(e,t,i,n=null){var o=new $.Deferred;var s=i+"/"+t;var r={method:"GET",route:s};function a(e){if(n){o.resolve();callFunction(n,[e])}else{o.resolve(e)}}function c(){loadItem(e,t,function(e){console.log("Device offline. Loading item from local device.");var t=null;if(e){t=e.item}a(t)})}if(!ingestBoolean(window.device_online)){c()}else{function l(n){var s=ingestMap(n.details);var r=ingestNumber(n.updated);var c=loadItem(e,t);if(c.dt<=r){saveItem(e,t,s,r,overwrite=false);a(s)}else{var l=savingItem(e,t,c.item,c.dt,i);l.done(a);l.fail(function(e){o.reject(e)})}}var d=requestingResource(r);d.done(l);d.fail(function(s){handlingSession(s).fail(function(r){if(r=="acquired"){if("authentication_view"in window){window.authentication_view()}else{openAuthentication()}}if(r=="renewal"){var a=gettingItem(e,t,i,n);a.done(function(e){o.resolve(e)});a.fail(function(e){if(!window.device_online){c()}else{o.reject(e)}})}else if(!window.device_online){c()}else{o.reject(s)}})})}}function listingItems(e,t,i=null,n=null,o=0,s=null){var r=new $.Deferred;var a={method:"GET",route:t};n=ingestMap(n);o=ingestNumber(o);if(maxSize(n)||o){a["params"]={}}if(mapSize(n)){var c={};for(var l in n){if(l.slice(0,1)!="."){var d="."+l;c[d]=n[l]}else{c[l]=n[l]}}a["params"]["query"]=JSON.stringify(c)}if(o){a.params["results"]=o}function f(e){if(s){r.resolve();callFunction(s,[e])}else{r.resolve(e)}}function v(){listItems(e,order_criteria,n,o,function(e){console.log("Device offline. Listing items on local device.");f(e)})}if(!ingestBoolean(window.device_online)){v()}else{function u(i){var n=e+"_deletion_markers";var o=ingestMap(loadRecord(n));var s=ingestArray(i.details);var r=[];for(var a=0;a<s.length;a++){if(s[a]in o){deletingItem(e,s[a],t)}else{r.push(s[a])}}f(r)}var p=requestingResource(a);p.done(u);p.fail(function(a){handlingSession(a).fail(function(c){if(c=="acquired"){if("authentication_view"in window){window.authentication_view()}else{openAuthentication()}}if(c=="renewal"){var l=listingItems(e,t,i,n,o,s);l.done(function(e){r.resolve(e)});l.fail(function(e){if(!window.device_online){v()}else{r.reject(e)}})}else if(!window.device_online){v()}else{r.reject(a)}})})}}function savingItem(e,t,i,n=0,o,s=true,r=null){var a=new $.Deferred;var c=o+"/"+t;var l={method:"GET",route:c};function d(e){if(r){a.resolve();callFunction(r,[e])}else{a.resolve(e)}}}function deletingItem(e,t,i,n=null){}
/**
* TRANSCRIPTION JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* jquery.isonscreen.min.js
* sprintf
* autosize
* sha256
* gapi
* lab.js
* data.js
* audio.js
* forms.js
* requests.js
* sockets.js
* views.js
**/function markupTranscription(e,t){var i={html:"",selectors:[],array:[]};var n=[];var o=[];for(var s in e){o.push(s)}o.sort();for(var r=0;r<o.length;r++){n.push({dt:parseFloat(o[r]),text:e[o[r]].t,fx:e[o[r]].fx})}for(var r=0;r<n.length;r++){const e=n[r].text;const o=n[r].dt;const s=ingestArray(n[r].fx);const a=o.toString().replace(/\./g,"_");const c=sprintf("%s_%s",t,a);const l=c+"_t";const d=c+"_s";const f=sprintf('<span id="%s">%s</span>',l,e);const v=sprintf('<span id="%s"> </span>',d);i.html+=v;i.selectors.push({id:"#"+d,effects:s});i.array.push(v);i.html+=f;i.selectors.push({id:"#"+l,date:a,dt:o,effects:s});i.array.push(f)}return i}function transcriptListeners(e,t,i=null){var n=window.pouch_db.source_media;var o=window.pouch_db.source_media_remote;var s={slide:"",color:"font-gray"};if(i){var r=ingestMap(i.data());var a=ingestString(i.attr("class"));s.slide=ingestString(r["fxShowSlide"]);if(a.indexOf("font-purple")>-1){s.color="font-purple"}else if(a.indexOf("font-text")>-1){s.color="font-text"}}for(var c=0;c<e.length;c++){var l=e[c];const i=ingestString(l.id);const n=ingestNumber(l.dt);const o=ingestArray(l.effects);if(n){$(i).attr("data-dt",n.toString())}if(!o.length){s={slide:"",color:"font-gray"}}for(var d=0;d<o.length;d++){var f=o[d];const e=ingestString(f.serv);const t=ingestString(f.func);const n=ingestArray(f.args);if(t=="showSlide"){var v="";if(n.length==1){v=n[0]}else if(n.length>1){v=n.join()}$(i).attr("data-fx-show-slide",v);if(s.slide){if(s.slide==v){}else if(s.color=="font-text"){s.color="font-purple"}else{s.color="font-text"}}else{s.color="font-text"}s.slide=v}}$(i).addClass(s.color);$(i).mouseenter(function(){const e=ingestString(loadRecord("session_token"));const n=ingestString($(i).attr("data-fx-show-slide")).split(",");if(n.length){const c=parseFloat($(i).attr("data-dt"));function o(e){var t={anchor_selector:i,message_status:"normal",message_location:"top",message_html:sprintf('<img src="%s" class="icon-thumb float-top">',e)};showMessage(t)}var s="";if(n.length<3){if(n[0].indexOf("http")==0){s=n[0]}else{s=n[0]+"?token="+e}}else{const i=sha256(n[0]+n[1]+n[2]);var r=[];for(var a=0;a<t.length;a++){if(t[a].indexOf(i)==0){r.push(t[a])}}r.sort(function(e,t){return t-e});for(var a=0;a<r.length;a++){if(i+"."+c+".png">=r[a]){s="/media/"+r[a]+"?token="+e;break}}}if(s){o(s)}}});$(i).mouseleave(function(){var e="#dialog_status_message_"+i.replace("#","").toLowerCase();$(e).remove()})}}function toggleTranscription(e,t,i,n=null){var o=window.pouch_db.audio_transcripts;var s=window.pouch_db.audio_transcripts_remote;var r=window.socket_channels.indexOf("transcription");var a="disable";if(r==-1&&ingestString(t)){a="enable"}else if(r>-1&&ingestString(t)){a="switch"}var c="";var l=window.socket_channels.indexOf("speech");if(l>-1&&a=="enable"){window.socket_channels_speech_memory=true;toggleChannels(e,"speech",emit_update=false);c="disable"}else if("socket_channels_speech_memory"in window&&a=="disable"){toggleChannels(e,"speech",emit_update=false);delete window.socket_channels_speech_memory;c="renable"}function d(t,i){$(t).click(function(){toggleChannels(e,"speech")});$(t).attr("title",i);$(t).removeClass("hidden-link font-faded")}function f(e){$(e).off();$(e).attr("title","Disabled While Transcription Active");$(e).addClass("hidden-link font-faded")}const v="#footer_navigation_speech_link";const u="#header_navigation_speech_link";if($(v).length){if(c=="disable"){f(v);f(u)}else if(c=="renable"){d(v,"Deactivate Speech");d(u,"Deactivate Speech")}}function p(e){var t=$(e).parent().find(".scroll-bottom");if(typeof t!="undefined"){var i=$("#header_container").css("height");var n=parseInt(i.slice(0,-2));var o=$(window).height();var s=$(t).offset().top-o+n;$("html, body").animate({scrollTop:s},1)}}var g="";var _="";function h(n){_=$(t).html();if(g){var o=_.length-g.length;_=_.slice(0,o)}var s="";if(g){s=" "}if($.isArray(n)){for(var r=0;r<n.length;r++){if(r){s+=" "}s+=n[r].t}}else{s+=n}$(t).contents().filter(function(){return this.nodeType==3}).remove();$(t).append(s);autosize.update($(t));p(t);g=deepCopy(s);e.emit("transcription_interim",{_id:i,tokens:n})}function m(t){e.emit("transcription_final",{_id:i,tokens:t})}function w(e){const n=ingestString(e._id);const r=ingestNumber(e.dt);const a=ingestMap(e.tokens);const c=ingestBoolean(e.redraw);const l=ingestArray(e.media);_=$(t).html();if(g){var d=_.length-g.length;_=_.slice(0,d);g=""}o.get(i).then(function(e){for(var i in a){e.tokens[i]=a[i];e.dt=r}if(!("media"in e)){e["media"]=[]}for(var d=0;d<l.length;d++){if(e["media"].indexOf(l[d])==-1){e["media"].push(l[d])}}o.put(e).then(function(){o.replicate.to(s)});var f=[];if(c){f=markupTranscription(e.tokens,n);$(t).empty()}else{f=markupTranscription(a,n);$(t).contents().filter(function(){return this.nodeType==3}).remove()}var v=null;for(var d=0;d<f.array.length;d++){if(_||d){$(f.array[d]).appendTo($(t))}if(_&&d==0){v=$("<div>"+_+"</div>").find("> span:last")}}$(t).attr("data-updated",r.toString());transcriptListeners(f.selectors,e["media"],v);autosize.update($(t));p(t)})}if(a=="enable"){o.replicate.to(s).then(function(){window.socket_channels.push("transcription");e.emit("channels",{media:window.socket_channels});e.emit("transcription_start",{_id:i},function(t){if(t==200){e.on("transcription",w,200);startSpeechTranscription(m,h,"timestamp",filter_callable=null,function(t){if(t=="not-allowed"){$(n.mic_box_selector).removeClass("burst-effect");$(n.mic_selector).removeClass("icon-attention");$(n.text_selector).removeClass("transcript-active");if("client_listeners"in window){if(i in window.client_listeners){clearInterval(window.client_listeners[i]);delete window.client_listeners[i]}}toggleTranscription(e,"",i,n);alert("Audio Transcription requires Access to Microphone.")}})}else{}})})}else if(a=="switch"){o.replicate.to(s).then(function(){e.emit("transcription_start",{_id:i},function(t){if(t==200){window.speech_transcription_properties.final_callback=m;window.speech_transcription_properties.interim_callback=h;e.removeAllListeners("transcription");e.on("transcription",w,200)}else{}})})}else{stopSpeechTranscription();window.socket_channels.splice(r,1);e.emit("channels",{media:window.socket_channels});e.removeAllListeners("transcription");o.replicate.to(s)}}function updateTranscript(e,t){const i="#"+e+"_content_column_main_body";const n=ingestNumber(t.created_dt);const o=ingestNumber(t.dt);const s=ingestString(t.title);const r=ingestString(t.tokens);const a=markupTranscription(r,n);const c=ingestArray(t.media);$(i).children().each(function(){var e=$(this).find(".form-input-contenteditable");var t=$(this).find("input");var i=parseFloat(e.attr("data-created"));var r=parseFloat(e.attr("data-updated"));if(i==n){e.attr("data-updated",o);if(r!=o){e.html(a.html);transcriptListeners(a.selectors,c);t.val(s)}}})}function transcriptionView(e,t,i,n){var o="audio_transcripts";var s="#"+o+"_content_container";var r="#"+o+"_index_entries";var a="#"+o+"_index_create_button";var c="#"+o+"_index_start_button";var l="#"+o+"_content_column_main_body";var d="#"+o+"_content_alert_box";var f="#"+o+"_content_alert_list";var v=window.pouch_db.oauth2_tokens;var u=window.pouch_db.oauth2_tokens_remote;var p=window.pouch_db.audio_transcripts;var g=window.pouch_db.audio_transcripts_remote;var _=window.pouch_db.source_materials;var h=window.pouch_db.source_materials_remote;var m=window.pouch_db.source_media;var w=window.pouch_db.source_media_remote;var b=[];var y=loadRecord("gateway_auth");var x=y.uid;var k=sprintf('<div id="%s_content_container" class="container content-container-scroll"></div>',o);toggleView(s,k);function S(e){var t=Math.floor(e);const i=Math.floor(t/3600);t=e%3600;const n=Math.floor(t/60);const o=Math.floor(t%60);var s=o.toString()+'<span class="font-faded">s</span>';if(o<10){s="0"+s}s=n.toString()+'<span class="font-faded">m</span>'+s;if(n<10&&i){s="0"+s}if(i){s=i.toString()+'<span class="font-faded">h</span>'+s}return s}function C(e,t,i=null,n=true){var o=new $.Deferred;const s=parseFloat($(t).attr("data-start"));const r=$.now()/1e3;const a=$.now()/1e3-s;p.get(e).then(function(e){const s=ingestNumber(e.elapsed_time)+a;e.elapsed_time=s;if(n){p.put(e).then(function(){o.resolve()})}else{o.resolve()}const r=S(s);$(t).html(r);if(ingestArray(i).length){for(var c=0;c<i.length;c++){$(i[c]).html(r)}}});return o.promise()}function A(t,i,n,o,s){if(!("client_listeners"in window)){window.client_listeners={}}var r={mic_box_selector:i,mic_selector:n,text_selector:t,time_selector:o};var a=true;var c=$(t).attr("class");if(c.indexOf("transcript-active")==-1){a=false}const d="#dialog_live";const f="#dialog_live_box";const v="#dialog_live_box_time";if(a){if("transcript_mic_overlay"in window.client_listeners){clearInterval(window.client_listeners["transcript_mic_overlay"])}$(d).hide();$(d).empty();$(i).removeClass("burst-effect");$(n).removeClass("icon-attention");$(t).removeClass("transcript-active");C(s,o).done(function(){clearInterval(window.client_listeners[s]);delete window.client_listeners[s];toggleTranscription(e,"",s,r)})}else{var u=$(l).find(".transcript-active");var p=$(l).find(".burst-effect");var g=$(l).find(".icon-attention");if(u.length){var _=u.parent().parent().parent().find(".elapsed-time");var h=u.attr("data-doc-id");var m=u.attr("data-created");u.removeClass("transcript-active");p.removeClass("burst-effect");g.removeClass("icon-attention");C(h,_);clearInterval(window.client_listeners[h]);delete window.client_listeners[h]}var w=sprintf('                <div class="row">                    <div class="col-sm-11 col-xs-10"></div>                    <div class="col-sm-1 col-xs-2">                        <div class="font-xl text-center line-height-1 padding-vertical-20">                            <div id="dialog_live_box" class="burst-effect">                                <a id="dialog_live_box_icon" class="icon-microphone icon-attention" title="Click to Deactivate Mic"></a>                            </div>                        </div>                    </div>                </div>');w=sprintf('                <div class="row">                    <div class="col-lg-10 col-md-10 col-sm-8 col-xs-6"></div>                    <div class="col-lg-2 col-md-2 col-sm-4 col-xs-6">                        <div id="dialog_live_box" class="font-md text-right icon-attention padding-vertical-20">                            <div id="dialog_live_box_time" class="shadow-white"></div>                        </div>                    </div>                </div>');$(d).html(w);window.client_listeners["transcript_mic_overlay"]=setInterval(function(){const e=$(n).isOnScreen(function(e){return e.top>=10&&e.bottom>=50});if(e){$(d).fadeOut(600)}else{$(d).fadeIn(600)}},500);$(f).off();$(f).on("click",function(){A(t,i,n,o,s)});$(i).addClass("burst-effect");$(t).addClass("transcript-active");$(n).addClass("icon-attention");$(o).attr("data-start",($.now()/1e3).toString());window.client_listeners[s]=setInterval(function(){C(s,o,[v],update_record=false)},1e3);toggleTranscription(e,t,s,r)}}function T(e,t="add"){const n=i[e].service_logo;const s=i[e].service_title;const r='[data-service="'+e+'"]';var a=$(f).find(r);if(t=="add"){if(!$(d).is(":visible")){$(d).show()}if(!a.length){var c=sprintf('                    <div class="row">                        <div class="col-xs-10">                            <div class="row form-text margin-bottom-5 auto-height">                                <div class="col-lg-1 col-md-1 col-sm-2 col-xs-2" style="padding-left: 12px;">                                    <img src="%s" class="icon-sm float-top">                                </div>                                <div class="col-lg-11 col-md-11 col-sm-10 col-xs-10 padding-left-0">                                    <span id="%s_%s_alert_text" class="text-wrap">%s <sup class="bold">(expired)</sup></span>                                </div>                            </div>                        </div>                        <div class="col-xs-2 text-right">                            <span data-service="%s" class="icon-refresh icon-hyperlink form-text"></span>                        </div>                     </div>',n,o,e,s,e);$(c).appendTo($(f));$(f).find(r).click(function(){var n=$(f).find(r);const s=sprintf("#%s_%s_alert_text",o,e);var a=i[e].scopes;var c=i[e].description;var l=retrievingOAuthToken(e,a,c,reprompt=true);l.done(function(i){T(e,t="remove")});l.fail(function(e){const t={anchor_selector:s,message_text:e,message_status:"error",timeout:5e3};showMessage(t)})})}}else if(t=="remove"){if(a.length){$(a).parent().parent().remove()}if(!$.trim($(f).html())){$(d).hide()}}}function D(e){const t=e.source_title;const n=e.service_name;const o=e.source_uri;const s=i[n]["service_logo"];var r=sprintf('            <div class="row">                <div class="col-xs-10">                    <div class="row form-text margin-bottom-5 auto-height">                        <div class="col-lg-1 col-md-1 col-sm-2 col-xs-2" style="padding-left: 12px;">                            <img src="%s" class="icon-sm float-top">                        </div>                        <div class="col-lg-11 col-md-11 col-sm-10 col-xs-10 padding-left-0">                            <span class="text-wrap">%s</span>                        </div>                    </div>                </div>                <div class="col-xs-2 text-right">                    <span data-service="%s" data-uri="%s" class="icon-close icon-hyperlink form-text"></span>                </div>             </div>',s,t,n,o);return r}function R(e,t,i){p.get(i).then(function(e){for(var i=0;i<e.sources.length;i++){const n=ingestString(e.sources[i].source_uri);const o=ingestString(e.sources[i].service_name);if(o==t.service_name&&n==t.source_uri){e.sources.splice(i,1);p.put(e).then(function(){p.replicate.to(g)});break}}});$(e).remove()}function O(t,i){var n=new $.Deferred;_.find({selector:{service_name:t.service_name,source_uri:t.source_uri},use_index:"service_name_source_uri"}).then(function(o){if(!o.docs.length){_.post({service_name:t.service_name,source_uri:t.source_uri,source_title:t.source_title,uid:x,dt:t.dt,hash:t.hash,details:i}).then(function(t){_.replicate.to(h).then(function(){e.emit("save_source",{_id:t.id});n.resolve("saved")})})}else{var s=o.docs[0];if(s.hash!=t.hash){s.details=i;s.hash=t.hash;s.dt=t.dt;_.put(s).then(function(){_.replicate.to(h).then(function(){e.emit("save_source",{_id:s._id});n.resolve("updated")})})}else{n.resolve("")}}});return n.promise()}function j(t,i,n=null){var o=new $.Deferred;m.find({selector:{service_name:t.service_name,source_uri:t.source_uri,object_id:t.object_id},use_index:"service_name_source_uri_object_id"}).then(function(s){if(!s.docs.length){if(n){n().done(function(i){m.post({service_name:t.service_name,source_uri:t.source_uri,object_id:t.object_id,dt:t.dt,uid:x,hash:t.hash,data:i}).then(function(t){m.replicate.to(w).then(function(){e.emit("save_media",{_id:t.id,_rev:t.rev,bucket:"source_media"});o.resolve("saved")}).catch(function(){o.reject()})})}).fail(function(){o.reject()})}else{m.post({service_name:t.service_name,source_uri:t.source_uri,object_id:t.object_id,dt:t.dt,uid:x,hash:t.hash,data:i}).then(function(t){m.replicate.to(w).then(function(){e.emit("save_media",{_id:t.id,_rev:t.rev,bucket:"source_media"});o.resolve("saved")}).catch(function(){o.reject()})})}}else{var r=s.docs[0];if(r.hash!=t.hash){if(n){n().done(function(i){r.data=i;r.hash=t.hash;r.dt=t.dt;m.put(r).then(function(t){m.replicate.to(w).then(function(){e.emit("save_media",{_id:t.id,_rev:t.rev,bucket:"source_media"});o.resolve("updated")}).catch(function(){o.reject()})})}).fail(function(){o.reject()})}else{r.data=data;r.hash=t.hash;r.dt=t.dt;m.put(r).then(function(t){m.replicate.to(w).then(function(){e.emit("save_media",{_id:t.id,_rev:t.rev,bucket:"source_media"});o.resolve("updated")}).catch(function(){o.reject()})})}}else{o.resolve("")}}});return o.promise()}function M(e,t,i){var n=new $.Deferred;gapi.auth.setToken({access_token:i});gapi.client.slides.presentations.get({presentationId:e}).then(function(o){delete o.result.layouts;delete o.result.masters;delete o.result.notesMaster;var s=deepCopy(t);const r=JSON.stringify(o.result);const a=r.replace(/"https.*?googleusercontent.*?"/g,'""');s.hash=sha256(a);const c=deepCopy(s);O(c,o.result).done(function(s){n.resolve();if(s=="saved"||s=="updated"){logConsole(c.source_uri+" "+s);const n=o.result.slides;for(var r=0;r<n.length;r++){var a=deepCopy(t);a.object_id=n[r].objectId;const o=JSON.stringify(n[r]);const s=o.replace(/"https.*?googleusercontent.*?"/g,'""');a.hash=sha256(s);const c=deepCopy(a);function l(){var t=new $.Deferred;gapi.auth.setToken({access_token:i});gapi.client.slides.presentations.pages.getThumbnail({presentationId:e,pageObjectId:c.object_id,thumbnailProperties:{mimeType:"PNG",thumbnailSize:"LARGE"}}).then(function(e){const i=e.result.contentUrl;getFile(i).done(function(e){t.resolve(e)}).fail(function(){t.reject()})}).catch(function(e){logConsole(e)});return t.promise()}j(c,n[r],l).done(function(e){if(e){logConsole(c.object_id+" "+e)}})}}}).fail(function(e){n.reject(e)})}).catch(function(e){n.reject(e)});return n.promise()}function L(e,t,i){var n=new $.Deferred;gapi.auth.setToken({access_token:service_token});gapi.client.sheets.spreadsheets.get({spreadsheetId:e}).then(function(e){var i=deepCopy(t);const o=JSON.stringify(e.result);const s=o.replace(/"https.*?googleusercontent.*?"/g,'""');i.hash=sha256(s);const r=deepCopy(i);O(r,e.result).done(function(e){n.resolve();if(e=="saved"||e=="updated"){logConsole(r.source_uri+" "+e)}}).fail(function(e){n.reject(e)})}).catch(function(e){n.reject(e)});return n.promise()}function I(e,t,n,o,s){function r(e,t,i=false){var n="";if(i){n=' class="font-placeholder"'}const o=sprintf('                <li>                    <a title="%s"%s>                        <div class="container-fluid">                            <div class="row">                                <div class="col-xs-2">                                    <img src="%s" class="icon-sm float-top">                                </div>                                <div class="col-xs-10 padding-left-0">                                    <span class="text-wrap">%s</span>                                </div>                            </div>                        </div>                    </a>                </li>',t,n,e,t);return o}function a(e,t){const i=t.source_uri;var n=false;$(e).find("span[data-uri]").each(function(e,t){const s=$(t).attr("data-uri");const r=$(t).attr("data-service");if(r==o){if(!s||s==i){n=true}}});if(!n||!i){const n=D(t);$(n).appendTo($(e));const a=$(e).find("> div").last();$(a).find(".icon-hyperlink").click(function(){R(a,t,s)});function r(e){p.get(s).then(function(t){if(!("sources"in t)){t["sources"]=[]}t.sources.push(e);if(!i){var n=[];for(var s=0;s<t.sources.length;s++){if(!t.sources[s].service_name==o||!t.sources[s].source_uri){n.push(t.sources[s])}}t.sources=n}p.put(t).then(function(){p.replicate.to(g)})})}v.find({selector:{service_name:o},use_index:"service_name"}).then(function(e){const n=e.docs[0].access_token;var s=deepCopy(t);s.dt=$.now()/1e3;const a=deepCopy(s);if(o=="google_slides"){loadingLibrary("google","slides").then(function(){M(i,a,n).then(function(){r(a)})})}else if(o=="google_sheets"){loadingLibrary("google","sheets").then(function(){M(i,a,n).then(function(){r(a)})})}else{r(a)}})}if(!i){$(e).find("span[data-uri]").each(function(e,t){const i=$(t).attr("data-uri");const n=$(t).attr("data-service");if(i&&n==o){$(t).parent().parent().remove()}})}}var c=$(e).parent();var l=$(e).parent().find("ul");var d=i[o]["service_logo"];var f=i[o]["service_title"];var u=$(e).parent().parent().find("li");const _="#"+o+"_source_paginator";function h(e,i=null,n=0){if(c.attr("class").indexOf("open")==-1){c.addClass("open")}u.each(function(e,t){var i=$(t).find("a").attr("data-service");if(i!=o){$(t).find("ul").empty().hide()}else{$(t).find("ul").empty().show()}});if(e.length){for(var s=0;s<e.length;s++){const i=e[s];const n=r(d,i.source_title);$(n).appendTo(l);const o=l.find("> li").last();$(o).click(function(){a(t,i)});if(!i.source_uri){const e='<li class="divider"></li>';$(e).appendTo(l)}}const i=sprintf('<li id="%s_source_paginator" class="invisible">Paginator</li>',o);$(i).appendTo(l)}else{const e="{ "+f+" empty }";const t=_contruct_service_source(d,e,empty_result=true);$(t).appendTo(l)}function v(e,i){var n=new $.Deferred;$(_).remove();for(var s=0;s<e.length;s++){const i=e[s];const n=r(d,i.source_title);$(n).appendTo(l);const o=l.find("> li").last();$(o).click(function(){a(t,i)})}const c=sprintf('<li id="%s_source_paginator" class="invisible">Paginator</li>',o);$(c).appendTo(l);n.resolve();return n.promise()}if(i){paginateView(_,e,i,v,n)}}if(o=="google_slides"||o=="google_sheets"){const e=i["google_drive"];var m=retrievingOAuthToken("google_drive",e.scopes,e.description);m.fail(function(e){const t={anchor_selector:button_selector,message_text:e,message_status:"error",timeout:5e3};showMessage(t)});m.done(function(e){T(e.service_name,action="remove");const t=e.access_token;gapi.auth.setToken({access_token:t});var i={q:"mimeType='application/vnd.google-apps.presentation'",orderBy:"modifiedTime desc",fields:"nextPageToken, files(id, name)",pageSize:10};if(o=="google_sheets"){i["q"]="mimeType='application/vnd.google-apps.spreadsheet'"}gapi.client.drive.files.list(i).then(function(e){var i=ingestArray(e.result.files);var n=[];for(var s=0;s<i.length;s++){const t=i[s];logConsole(t.name);const r={source_title:t.name,source_uri:t.id,service_name:o,page_token:ingestString(e.result.nextPageToken)};n.push(r)}function r(e){var i=new $.Deferred;var n=e.page_token;if(!n){i.resolve([])}else{var s={pageToken:n,q:"mimeType='application/vnd.google-apps.presentation'",fields:"nextPageToken, files(id, name)",pageSize:10};if(o=="google_sheets"){s["q"]="mimeType='application/vnd.google-apps.spreadsheet'"}gapi.auth.setToken({access_token:t});gapi.client.drive.files.list(s).then(function(e){var t=e.result.files;var n=[];for(var s=0;s<t.length;s++){const i=t[s];logConsole(file_details.name);const r={source_title:i.name,source_uri:i.id,service_name:o,page_token:e.result.nextPageToken};n.push(r)}i.resolve(n)}).catch(function(e){logConsole(e);i.resolve([])})}return i.promise()}h(n,r,10)}).catch(function(e){logConsole(e);_deferred.resolve([])})})}else{var w=[];for(var b=0;b<3;b++){const e={service_name:o,source_title:"My "+f+" Project "+b.toString(),source_uri:"My "+f+" Project "+b.toString()+" URI"};w.push(e)}h(w)}}function P(e,t,n,o){var s=$(e).attr("data-service");var r=i[s].scopes;var a=i[s].description;var c=retrievingOAuthToken(s,r,a);c.done(function(i){T(i.service_name,action="remove");const n=i.access_token;I(e,t,n,s,o)});c.fail(function(e){const t={anchor_selector:n,message_text:e,message_status:"error",timeout:5e3};showMessage(t)})}function E(t,n=false){const s=ingestString(t._id);const a=ingestNumber(t.created_dt);const c=ingestNumber(t.dt);const d=ingestString(t.title);const f=ingestNumber(t.elapsed_time);const v=ingestMap(t.tokens);const u=ingestArray(t.media);const _=ingestArray(t.sources);const h=renderEpoch(a);const m=o+"_"+s;const w="#"+m+"_section";const b="#"+m+"_title";const y="#"+m+"_created";const x="#"+m+"_time";const k="#"+m+"_text";const C="#"+m+"_delete";const T="#"+m+"_mic";const O=T+"_box";const j=o+"_index_"+s;const M="#"+j+"_link";const L="#"+m+"_sources";const I="#"+m+"_source_services";const E="#"+m+"_source_button";const z=S(f);var N=sprintf('            <div id="%s_section" class="section-responsive">                <div class="row form-line">                    <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">&nbsp;</div>                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                        <div class="row">                            <div class="col-xs-2">                                <div class="float-left">                                    <div id="%s_mic_box">                                        <span id="%s_mic" class="icon-microphone form-text icon-hyperlink text-center"></span>                                    </div>                                </div>                            </div>                            <div class="col-xs-4">&nbsp;</div>                            <div class="col-xs-2 text-right">                                <span class="icon-drawer icon-hyperlink hidden-link font-placeholder form-text"></span>                            </div>                            <div class="col-xs-2 text-right">                                <span class="icon-share-alt icon-hyperlink hidden-link font-placeholder form-text"></span>                            </div>                            <div class="col-xs-2 text-right">                                <span id="%s_delete" class="icon-close icon-hyperlink form-text"></span>                            </div>                        </div>                    </div>                </div>                <div class="row form-line auto-height">                    <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                        <div class="form-text auto-height">Sources:</div>                    </div>                    <div class="hidden-lg hidden-md hidden-sm col-xs-12">                        <div class="form-label bold">Sources:</div>                    </div>                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12 auto-height">                        <div id="%s_sources" class="sources-div-class"></div>                        <div class="dropdown">                            <a id="%s_source_button" class="form-text dropdown-toggle" data-toggle="dropdown">                                <div class="row">                                    <div class="col-xs-10">                                        <div class="row form-text margin-bottom-5 auto-height">                                            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-2">                                                <span class="icon-plus"></span>                                            </div>                                            <div class="col-lg-11 col-md-11 col-sm-10 col-xs-10 padding-left-0">                                                <span class="text-wrap">Add Source</span>                                            </div>                                        </div>                                    </div>                                    <div class="col-xs-2 text-right">                                    </div>                                 </div>                            </a>                            <ul id="%s_source_services" class="dropdown-menu">                            </ul>                        </div>                    </div>                </div>                <div class="row form-line">                    <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                        <div class="form-text auto-height">Created:</div>                    </div>                    <div class="hidden-lg hidden-md hidden-sm col-xs-12">                        <div class="form-label bold">Created:</div>                    </div>                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                        <div id="%s_created" class="form-text">%s</div>                    </div>                </div>                <div class="row form-line">                    <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                        <div class="form-text auto-height">Elapsed Time:</div>                    </div>                    <div class="hidden-lg hidden-md hidden-sm col-xs-12">                        <div class="form-label bold">Elapsed Time:</div>                    </div>                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                        <div id="%s_time" class="form-text elapsed-time">%s</div>                    </div>                </div>                <div class="row form-line auto-height">                    <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                        <div class="form-text auto-height">Text:</div>                    </div>                    <div class="hidden-lg hidden-md hidden-sm col-xs-12">                        <div class="form-label bold">Text:</div>                    </div>                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12 auto-height">                        <div id="%s_text" data-created="%s" data-updated="%s" data-doc-id="%s" class="form-input-contenteditable font-gray"></div>                        <div id="%s_bottom" class="scroll-bottom"></div>                    </div>                </div>            </div>',m,m,m,m,m,m,m,m,h,m,z,m,a,c,s,m);var V=markupTranscription(v,s);var F=V.html;var B=sprintf('            <div id="%s" class="form-line">                <a href="#" id="%s_link" class="form-text no-wrap" title="Go to %s Transcript">%s</a>            </div>',j,j,h,h);function q(){var e=$(l).children(":first");var t=$(r).children(":first");var i=e.find(".form-input-contenteditable");if(t.html()){var i=e.find(".form-input-contenteditable");var n=e.find(".sources-div-class");if(!i.html()&&!n.html()){var o=i.attr("data-doc-id");p.get(o).then(function(e){p.remove(e).then(function(){p.replicate.to(g)})});e.remove();t.remove()}}}if(n){q();$(l).prepend(N);if(F){$(k).html(F);transcriptListeners(V.selectors,u)}$(r).prepend(B)}else{$(N).appendTo($(l));$(k).html(F);transcriptListeners(V.selectors,u);$(B).appendTo($(r))}autosize($(k));for(var J=0;J<_.length;J++){const e=_[J];const t=D(e);$(t).appendTo($(L));const i=$(L).find("> div").last();$(i).find(".icon-hyperlink").click(function(){R(i,e,s)})}const U=["google_slides","google_sheets","pinterest"];for(var J=0;J<U.length;J++){const e=U[J];const t=i[e]["service_logo"];const n=i[e]["service_title"];const o="#"+m+"_"+e;const r=sprintf('                <li class="dropdown">                    <a id="%s_%s" title="%s" class="dropdown-toggle" data-service="%s" data-toggle="dropdown">                        <div class="container-fluid">                            <div class="row">                                <div class="col-xs-2">                                    <img src="%s" class="icon-sm float-top">                                </div>                                <div class="col-xs-10 padding-left-0">                                    <span class="text-wrap">%s</span>                                </div>                            </div>                        </div>                    </a>                    <ul class="dropdown-menu scrollable-menu margin-top-10 margin-left-10" style="display: none;">                    </ul>                </li>',m,e,n,e,t,n);$(r).appendTo($(I));$(o).click(function(){P(o,L,E,s)})}$("ul.dropdown-menu [data-toggle=dropdown]").on("click",function(e){e.preventDefault();e.stopPropagation();$(this).parent().addClass("open");$(this).parent().find("ul").parent().find("li.dropdown").addClass("open")});$(M).click(function(){scrollDiv(w)});var H={mic_selector:T,mic_box_selector:O,text_selector:k,time_selector:x};$(C).click(function(){p.get(s).then(function(e){p.remove(e).then(function(){p.replicate.to(g)})});var t=$(k).attr("class");if(t.indexOf("transcript-active")>-1){toggleTranscription(e,"",s,H)}$(w).remove();$("#"+j).remove()});$(T).click(function(){A(k,O,T,x,s)})}function z(e,t){var i=[];for(var n=0;n<e.length;n++){const s=e[n];const r=ingestArray(s.sources);for(var o=0;o<r.length;o++){const e=r[o].service_name;if(i.indexOf(e)==-1){if(!(e in t)){i.push(e)}else if(t[e].expires_at&&t[e].expires_at<$.now()/1e3+600){i.push(e)}}}if(i.indexOf("google_slides")||i.indexOf("google_sheets")){if(i.indexOf("google_drive")==-1){if(!("google_drive"in t)){i.push("google_drive")}else if(t["google_drive"].expires_at&&t["google_drive"].expires_at<$.now()/1e3+600){i.push("google_drive")}}}}return i}function N(){var e=new $.Deferred;v.find({selector:{service_name:{$gt:null}},use_index:"service_name"}).then(function(t){var i={};var n=ingestArray(t.docs);for(var o=0;o<n.length;o++){const e=n[o].service_name;i[e]=n[o]}var s=[];var r=[];var a=[];$(l).find(".form-input-contenteditable").each(function(e,t){a.push($(t).attr("data-doc-id"))});p.allDocs({keys:a,include_docs:true}).then(function(t){for(var n=0;n<t.rows.length;n++){r.push(t.rows[n].doc)}var o=z(r,i);e.resolve(o)})});return e.promise()}function V(e){var t=new $.Deferred;var i=renewingOAuthToken(e);i.done(function(i){T(e,action="remove");t.resolve()});i.fail(function(i){T(e,action="add");t.resolve()});return t.promise()}function F(){var e=$.now()/1e3;var t={uid:x,created_dt:e,title:"",services:{},sources:[],elapsed_time:0,tokens:{},feedback:{},edit:[],view:[],media:[],dt:e};p.post(t).then(function(e){t["_id"]=e.id;const i=e.id;E(t,prepend=true);p.replicate.to(g).then(function(){logConsole("new transcript created")})})}function B(e){var t=new $.Deferred;p.find({selector:{created_dt:{$lt:e.created_dt}},sort:[{created_dt:"desc"}],limit:5,use_index:"created_dt"}).then(function(e){t.resolve(ingestArray(e.docs))});return t.promise()}function q(e,t){var i=new $.Deferred;for(var n=0;n<e.length;n++){const t=e[n];E(t,prepend=false)}var o=[];var s=N();s.then(function(e){for(var t=0;t<e.length;t++){o.push(V(e[t]))}});if(o.length){$.when(o).then(function(){i.resolve()})}else{i.resolve()}return i.promise()}function J(){logConsole(b);var e=[];for(var i=0;i<b.length;i++){e.push(V(b[i]))}$.when(...e).then(function(){try{clearInterval(window.client_listeners["transcript_token_renewal"])}catch(e){}v.sync(u);window.client_listeners["transcript_token_renewal"]=setInterval(function(){var e=N();e.then(function(e){var t=[];logConsole(e);for(var i=0;i<e.length;i++){t.push(V(e[i]))}if(t.length){$.when(...t).then(function(){v.sync(u).then(function(){})})}})},3e5)});$(a).on("click",function(e){F()});var n={name:"Create",icon:"icon-plus",label:"Create New Transcript",onclick:"callFunction",args:[F]};updateAction(n);const s="#"+o+"_content_paginator";paginateView(s,t,B,q,5)}if(!$.trim($(s).html())){var U=sprintf('            <div id="%s_content_row" class="row">                <div id="%s_content_alert_box" style="display: none;">                    <div class="col-sm-3 hidden-xs background-alert"></div>                    <div class="col-sm-9 col-xs-12 background-alert">                        <div class="section-responsive">                            <div class="row form-line">                                <div class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                                    <div class="form-text auto-height">Permissions:</div>                                </div>                                <div class="hidden-lg hidden-md hidden-sm col-xs-12">                                    <div class="form-label bold">Permissions:</div>                                </div>                                <div id="%s_content_alert_list" class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                                </div>                            </div>                        </div>                    </div>                </div>                <div id="%s_content_column_index" class="col-sm-3 hidden-xs">                    <div id="%s_index_section" class="section-last">                        <div id="%s_index_create" class="form-line">                            <a href="#" id="%s_index_create_button" class="form-text"><span class="icon-plus padding-right-5"></span>Create New</a>                        </div>                        <div id="%s_index_entries"></div>                    </div>                </div>                <div id="%s_content_column_main" class="col-sm-9 col-xs-12">                    <div id="%s_content_column_main_body">                    </div>                    <div id="%s_content_paginator" class="invisible">Paginator</div>                </div>            </div>',o,o,o,o,o,o,o,o,o,o,o,o,o);$(s).html(U);for(var H=0;H<t.length;H++){const e=t[H];const i=ingestArray(e.sources);E(e,prepend=false)}b=z(t,n);J()}else{var G=[];var X={};$(l).find(".form-input-contenteditable").each(function(e,t){const i=$(t).attr("data-doc-id");G.push(i);const n=$(t).parent().parent().parent().find(".elapsed-time");X[i]={_id:i,dt:parseFloat($(t).attr("data-updated")),text:t,time:n}});t=[];p.allDocs({keys:G,include_docs:true}).then(function(e){for(var i=0;i<e.rows.length;i++){const n=e.rows[i].doc;t.push(n);const o=n._id;const s=ingestNumber(n.dt);const r=ingestNumber(n.elapsed_time);const a=ingestArray(n.sources);const c=ingestArray(n.media);if(s!=X[o].dt){const e=ingestMap(n.tokens);const t=markupTranscription(e,o);$(X[o].text).html(t);transcriptListeners(t.selectors,c);$(X[o].text).attr("data-updated",s);const i=S(r);$(X[o].time).html(i);autosize($(X[o].text))}}b=z(t,n);J()})}}function openTranscription(e=""){console.log("Opening transcription.");updateHistory(openTranscription,[e]);var t=handlingSocket(window.server_url);function i(t){var i=loadingBucket("audio_transcripts");var n=loadingBucket("oauth2_tokens");var o=loadingBucket("source_materials");var s=loadingBucket("source_media");$.when(i,n,o,s).then(function(i,n,o,s){function r(t,i,n,o){var s={app_title:window.app_title,app_subtitle:"Mitchell Experiment",page_title:"Experiment: Mitchell",page_label:"Storytelling Assistant Interface"};updateTitle(s);showDashboard();transcriptionView(t,i,n,o);scrollDiv(e)}var a=i.find({selector:{created_dt:{$gt:null}},sort:[{created_dt:"desc"}],limit:5,use_index:"created_dt"});var c=n.find({selector:{service_name:{$gt:null}},use_index:"service_name"});var l=loadingServices("mitchell");var d={};var f={};var v={};var u=[];$.when(a,c,l).then(function(e,i,n){u=ingestArray(e.docs);var o=ingestArray(i.docs);for(var s=0;s<o.length;s++){var a=o[s].service_name;d[a]=o[s]}r(t,u,n,d)}).catch(function(e){logConsole(e);r(t,u,f,d)})})}$.when(t).then(i)}
/**
* LAB JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2016-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
**/function logConsole(e){let t=false;if("system_environment"in window){if(window.system_environment=="dev"||window.system_environment=="tunnel"){t=true}}if(e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"){if(t){console.log(e)}}else if($.isArray(e)||typeof e=="object"){if(t){console.log(JSON.stringify(e))}}else if(t){try{console.log(JSON.stringify(e))}catch(e){}}}function deepCopy(e){if(e==null||typeof e!="object"){return e}else{var t=e.constructor();for(var i in e){if(e.hasOwnProperty(i))t[i]=e[i]}return t}}function ingestString(e){var t="";if(typeof e!="string"){return t}else if(e==="undefined"){return t}return e}function ingestMap(e){var t={};if(e==null||typeof e=="undefined"){return t}else if(typeof e!="object"){return t}else if($.isArray(e)){return t}else if(!mapSize(e)){return t}return e}function ingestBoolean(e){var t=false;if(e==null||typeof e=="undefined"){return t}else if(typeof e!="boolean"){return t}return e}function ingestInteger(e){var t=0;if(e==null||typeof e=="undefined"){return t}else if(typeof e!="number"||!(Math.floor(e)===e)){return t}return e}function ingestNumber(e){var t=0;if(e==null||typeof e=="undefined"){return t}else if(typeof e!="number"){return t}return e}function ingestArray(e){var t=[];if(e==null||typeof e=="undefined"){return t}else if(!$.isArray(e)){return t}return e}function isMap(e){if(e==null||typeof e=="undefined"){return false}else if(typeof e!="object"){return false}else if($.isArray(e)){return false}return true}function isFunction(e){if(e==null||typeof e=="undefined"){return false}else if({}.toString.call(e)!="[object Function]"){return false}return true}function mapSize(e){var t=0;$.each(e,function(e,i){t++});return t}function deleteObject(e){for(var t in e){if(e.hasOwnProperty(t)){e[t]=null;delete e[t]}}e=null}function sortArray(e,t){var i=ingestArray(e);var n=ingestArray(t);if(i.length){for(var o=0;o<n.length;o++){var s=ingestMap(i[0]);for(var r in ingestMap(n[o])){if(r in s){if(ingestString(n[o][r])){i.sort(function(e,t){if(t[r]>e[r]){return 1}else if(t[r]<e[r]){return-1}else{return 0}})}else{i.sort(function(e,t){if(e[r]>t[r]){return 1}else if(e[r]<t[r]){return-1}else{return 0}})}}else{throw"sort_criteria["+o.toString()+"]."+r+" is not a field in the objects of the array."}}}}return i}function filterArray(e,t,i=0){var n=[];var o=ingestArray(e);t=ingestMap(t);for(var s=0;s<o.length;s++){var r=true;var a=ingestMap(o[s]);for(var c in t){if(!(c in a)){if("value_exists"in t[c]){if(!t[c]["value_exists"]){continue}}r=false;break}for(var l in t[c]){if(l=="value_exists"){if(!t[c][l]){if(c in a){r=false;break}}}if(l=="equal_to"){if(t[c][l]!=o[s][c]){r=false;break}}}if(!r){break}}if(r){n.push(o[s]);if(ingestInteger(i)){if(n.length>=i){break}}}}return n}function capitalizeString(e,t=false){var i=ingestString(e);if(t){i=i.replace(/_/g," ")}var n=i.replace(/\b\w/g,function(e){return e.toUpperCase()});return n}function injectLinks(e,t=true){function i(e){var i='<a href="'+e+'" target="_blank">'+e+"</a>";if(t){var n='<link rel="dns-prefetch" href="'+e+'">';$("head").append(n)}return i}var n=e.replace(/https?:\/\/.*?(\s|,|$)/g,i);return n}function unpackKwargs(e,t,i){if(typeof e==="undefined"){e={}}for(var n in t){var o="error unpacking "+i+": ";try{if(n in e){if(typeof e[n]===typeof t[n]){t[n]=e[n]}else{o+=n+" must be a "+typeof t[n]+".";logConsole(o)}}}catch(e){o+=n+" failed to unpack.";logConsole(o)}}}function convertElement(e,t){var i=$(e)[0].tagName.toLowerCase();var n="<"+t+"></"+t+">";var o=$(n);$(e).each(function(){$.each(this.attributes,function(){if(this.specified){o.attr(this.name,this.value)}})});o.html($(e)[0].innerHTML);if(t=="a"){o.attr("href","#")}else if(i=="a"){o.removeAttr("href")}$(e).replaceWith(o)}function toggleStyle(e,t){var i=new RegExp(t,"i");var n=$(e);if(typeof n.attr("style")==="undefined"){n.attr("style",t)}else if(!i.test(n.attr("style"))){var o=n.attr("style")+" "+t;n.attr("style",o)}else{var o=n.attr("style").replace(t,"");if(o){n.attr("style",o)}else{n.removeAttr("style")}}}function retrieveParams(){var e={};var t=window.location.search.substring(1);var i=t.split("&");for(var n=0;n<i.length;n++){var o=i[n].split("=");e[o[0]]=decodeURIComponent(o[1])}if(e){if(window.history.pushState){var s=ingestString(window.page_url);var r=ingestString(window.app_title);if(!s){s="/"}if(!r){r="Landing Page"}window.history.pushState({state:"dummy state"},r,s)}}return e}function autofocusEnd(e){$(e).focus(function(){if(this.setSelectionRange){var e=$(this).val().length;this.setSelectionRange(e,e)}else{$(this).val($(this).val())}})}function bindFunction(e,t,i,n=""){if($(e).length){var o=window[t];i=ingestArray(i);if(typeof o=="undefined"){logConsole(sprintf("Function %s is not in the scope.",t))}else{if(i.length){$(e).click(function(){o(...i)})}else{$(e).click(function(){o()})}}}}function unbindListener(e,t=false){if("client_triggers"in window){if(e in window.client_triggers){if(t){for(key in window.client_triggers[e]){if($(key).length){$(key).off()}}}else{if($(e).length){$(e).off()}}delete window.client_triggers[e]}}}function clearListeners(){if("client_triggers"in window){for(key in window.client_triggers){if(ingestBoolean(window.client_triggers[key])){if($(key).length){$(key).off()}}else{const e=ingestMap(window.client_triggers[key]);for(k in e){if($(k).length){$(k).off()}}}}window.client_triggers={}}}function updateHistory(e,t=null){if(!"client_history"in window){window.client_history=[]}if(window.client_history.length>49){window.client_history.shift()}window.client_history.push({func:e,args:t})}function callFunction(e,t=null){t=ingestArray(t);if(typeof e=="string"){var i=window[e];if(typeof i=="undefined"){logConsole("Function "+e+" is not in the global scope.")}else if(t.length){i(...t)}else{i()}}else if(t.length){e(...t)}else{e()}}function getFile(e){var t=new $.Deferred;var i=new XMLHttpRequest;i.onload=function(e){if(this.status==200){var i=new FileReader;i.readAsDataURL(this.response);i.onloadend=function(){t.resolve(i.result)}}else{t.reject()}};i.open("GET",e);i.responseType="blob";i.send();return t.promise()}
/**
* FINGERPRINTS JAVASCRIPT EXTENSION
* @description Functions for retrieving device information 
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* fingerprint2
* retrieve.ip.js
* detect.browser.js
*
* cordova plugins:
* cordova-plugin-device
**/function defineDevice(e){var t={};try{t["cordova_version"]=device.cordova}catch(e){}try{t["device_model"]=device.model}catch(e){}try{t["device_platform"]=device.platform}catch(e){}try{t["device_uuid"]=device.uuid}catch(e){}try{t["device_version"]=device.version}catch(e){}try{t["device_manufacturer"]=device.manufacturer}catch(e){}try{t["device_virtualization"]=device.isVirtual}catch(e){}e(t)}function fingerprintDevice(e){function t(t,i){var n={hash:t,js_fonts:[],hardware_concurrency:0,cpu_class:"",resolution:[],color_depth:0,ip_address:"",language:"",local_storage:0,session_storage:0,navigator_platform:"",timezone_offset:0,touch_support:[]};for(var o=0;o<i.length;o++){var s=i[o];var r=s.key;if(r in n){if(typeof s.value==typeof n[r]){n[r]=s.value}}}timezone_offset=ingestNumber(n.timezone_offset);if(timezone_offset){n["timezone_offset"]=timezone_offset*60}e(n)}try{(new Fingerprint2).get(function(e,i){t(e,i)})}catch(e){}}function initializeRetrieveIP(){var e=new $.Deferred;try{retrieveIPAddress(function(t){e.resolve(t)})}catch(t){e.reject("Unable to retrieve IP address.")}return e.promise()}function initializeFingerprint(){var e=new $.Deferred;if(!("client_fingerprint"in window)){window.client_fingerprint={}}defineDevice(function(e){for(var t in e){window.client_fingerprint[t]=e[t]}});BrowserDetect.init();window.client_fingerprint["browser_name"]=BrowserDetect.browser;window.client_fingerprint["browser_version"]=BrowserDetect.version;if(typeof(window.client_fingerprint["browser_version"]=="number")){window.client_fingerprint["browser_version"]=window.client_fingerprint["browser_version"].toString()}fingerprintDevice(function(t){for(var i in t){window.client_fingerprint[i]=t[i]}var n=initializeRetrieveIP();n.done(function(e){window.client_fingerprint["ip_address"]=e});n.fail(function(e){logConsole(e)});n.always(function(){e.resolve(window.client_fingerprint)})});return e.promise()}function retrievePublicIP(){var e=new $.Deferred;var t={url:"//ipapi.co/json/",crossDomain:true,success:function(t){logConsole(t.ip);e.resolve(t)},error:function(t,i){e.reject("Unable to retrieve IP")}};$.getJSON(t);return e.promise()}
/**
* VIEWS JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* jquery.isonscreen.min.js
* sprintf
* autosize
* gapi
* lab.js
* data.js
* fingerprints.js
* forms.js
* requests.js
* sockets.js
**/function showLanding(){var e=$(".landing-page");var t="display: none;";e.each(function(){var e=new RegExp(/display:\snone/g);if(e.test($(this).attr("style"))){toggleStyle(this,t)}})}function hideLanding(){var e=$(".landing-page");var t="display: none;";e.each(function(){var e=new RegExp(/display:\snone/g);if(!e.test($(this).attr("style"))){toggleStyle(this,t)}})}function showDashboard(){var e=$(".id-verified");var t="display: none;";e.each(function(){var e=new RegExp(/display:\snone/g);if(e.test($(this).attr("style"))){toggleStyle(this,t)}});var i=$(".header-border");i.each(function(){$(this).addClass("navbar-border")});showTitle();$("#header_right_mobile").empty();$("#dialog_options_buttons").empty();$("#header_right_dashboard").show();$("#footer_verified").show()}function hideDashboard(){var e=$(".id-verified");var t="display: none;";e.each(function(){var e=new RegExp(/display:\snone/g);if(!e.test($(this).attr("style"))){toggleStyle(this,t)}});var i=$(".header-border");i.each(function(){$(this).removeClass("navbar-border")});$("#header_right_dashboard").hide();$("#footer_verified").hide()}function showTitle(e=false){var t=$("#header_middle_desktop");var i=new RegExp(/display:\snone/g);var n=!i.test(t.attr("style"));if(!n){toggleStyle("#header_middle_desktop,#header_middle_mobile","display: none;")}if(e){t.removeClass("navbar-start");t.addClass("navbar-center")}else{t.removeClass("navbar-center");t.addClass("navbar-start")}}function hideTitle(e=false){var t=$("#header_middle_desktop");var i=new RegExp(/display:\snone/g);var n=!i.test(t.attr("style"));if(n){toggleStyle("#header_middle_desktop,#header_middle_mobile","display: none;")}if(e){t.removeClass("navbar-start");t.addClass("navbar-center")}else{t.removeClass("navbar-center");t.addClass("navbar-start")}}function showConversation(){var e=$("#dialog_chat");var t=new RegExp(/display:\snone/g);var i=!t.test(e.attr("style"));if(!i){toggleStyle("#dialog_chat","display: none;");var n=$(".id-chat-responsive");n.each(function(){$(this).addClass("chat-responsive")})}}function hideConversation(){var e=$("#dialog_chat");var t=new RegExp(/display:\snone/g);var i=!t.test(e.attr("style"));if(i){toggleStyle("#dialog_chat","display: none;");var n=$(".id-chat-responsive");n.each(function(){$(this).removeClass("chat-responsive")})}}function toggleView(e,t){if(e.indexOf("#")!=0){e="#"+e}$("#content").children().each(function(){$(this).hide()});if(!$(e).length){$("#content").append(t)}else{$(e).show()}}function scrollDiv(e){if(e){var t="#"+e;if($(t).length){var i=$("#header_container").css("height");var n=parseInt(i.slice(0,-2));var o=$(t).offset().top-n;$("html, body").animate({scrollTop:o},1)}}else{$("html, body").animate({scrollTop:0},1)}}function flexibleDialog(e=null){var t=ingestMap(e);var i=ingestString(t.title);var n=ingestString(t.body);var o=ingestBoolean(t.keep_open);var s=sprintf('        <div id="flexible_dialog_box" class="dialog-flexible">            <div class="container-fluid">                <div class="row navbar-accent navbar-border">                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"></div>                    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">                        <div id="flexible_dialog_title" class="navbar-title-24 navbar-center">%s</div>                    </div>                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">                        <div class="navbar-title-24 navbar-end">                            <a id="flexible_dialog_close" title="Close Button" class="icon-close font-sm float-middle"></a>                        </div>                    </div>                </div>            </div>            <div id="flexible_dialog_body" class="container-fluid margin-vertical-10">%s</div>        </div>',i,n);var r="#flexible_dialog_box";var a="#flexible_dialog_title";var c="#flexible_dialog_close";var l="#flexible_dialog_body";var d="#dialog_backdrop";if($(r).length){$(r).remove()}$(d).show();$("body").append(s);function f(){$(d).hide();$(r).remove()}if(o){$(c).click(f)}else{$(r).find("a").each(function(e,t){$(t).click(f)})}$(d).click(f)}function blockquoteDialog(e){var t={schema:{title:"Mission",description:"Statement of purpose for the laboratory.",effective_date:"2016.05.31.13.45.55",details:"To make accessible to each individual the resources of the world.",author:"Collective Acuity"},metadata:{example_statements:["display the lab mission"]}};var i=t.schema;unpackKwargs(e,i,"blockquoteDialog");var n=i.title;var o=n.toLowerCase().replace(/\s/g,"_");var s=i.description;var r=i.details;var a=i.author;var c=sprintf('        <div id="%s_details" class="font-sm text-left" title="%s">            <blockquote class="blockquote-reverse">                <p>%s</p>                <footer>%s</footer>            </blockquote>        </div>',o,s,r,a);var l={title:n,body:c};flexibleDialog(l)}function itemizedDialog(e){var t={schema:{title:"Lab Protocols",description:"How flask bot uses data.",effective_date:0,sections:[{section_title:"Zero Tracking",section_description:"",section_items:["We do not place any weird cookies, use any trackers or allow third parties services to collect data about you from us."]}]},metadata:{example_statements:["display the lab protocols information"]}};var i=t.schema;unpackKwargs(e,i,"itemizedDialog");var n=i.title;var o=n.toLowerCase().replace(/\s/g,"_");var s=i.description;var r=i.sections;var a=sprintf('<div id="%s_details" class="font-mini small text-left" title="%s">',o,s);for(var c=0;c<r.length;c++){a+=sprintf("<strong>%s</strong>",r[c].section_title);a+='<ul class="list-padding">';var l=r[c].section_items;for(var d=0;d<l.length;d++){a+=sprintf("<li>%s</li>",l[d])}a+="</ul>"}a+="</div>";var f={title:n,body:a};flexibleDialog(f)}function slideoutDialog(e,t){var i="#dialog_backdrop_slideout";var n=e;var o=e+" a";var s="slideout-"+t;var r="slideback-"+t;$(i).show();$(n).show();$(n).addClass(s);function a(){$(i).hide();$(i).off();$(n).removeClass(s);$(n).addClass(r);setTimeout(function(){$(n).hide();$(n).removeClass(r)},150)}$(o).click(function(){a()});$(i).click(function(){a()})}function inputDialog(e){var t=ingestString(e.selector);var i=ingestString(e.repeat);var n=ingestString(e.value);var o=ingestString(e.title);var s=ingestString(e.prompt);var r=ingestString(e.label);var a=ingestString(e.type);var c=ingestString(e.placeholder);var l=e.callable;var d=ingestMap(e.criteria);var f=ingestArray(e.args);const v="flexible_dialog_confirm_"+o.toLowerCase().replace(/\s/g,"_");const u=sprintf('        <div id="%s_box" class="form-line text-left">            <div class="col-xs-12 margin-bottom-10">                <div class="form-text auto-height text-wrap">%s</div>            </div>            <div class="col-xs-12">                <div class="form-label bold">%s:</div>            </div>            <div class="col-xs-12 margin-bottom-5">                <form title="%s">                    <div class="row">                        <div class="col-lg-11 col-md-11 col-sm-11 col-xs-10 padding-right-0">                            <label for="%s_input" class="sr-only">%s</label>                            <input id="%s_input" type="%s" placeholder="%s" autofocus class="form-input">                        </div>                        <div class="col-lg-1 col-md-1 col-sm-1 col-xs-2 text-right padding-left-0">                            <div class="form-input">                                <span id="%s_status_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>                                <span id="%s_status_submit" class="icon-arrow-right-circle icon-success"></span>                            </div>                        </div>                    </div>                </form>            </div>        </div>',v,s,r,r,v,r,v,a,c,v,v);var p={title:o,body:u};flexibleDialog(p);const g="#dialog_backdrop";const _="#"+v+"_input";const h="#"+v+"_status_submit";const m="#"+v+"_status_error";const w="#flexible_dialog_box a";function b(e){var t=[e];if(f){for(var i=0;i<f.length;i++){t.push(f[i])}}$(g).click();l(...t)}hidden_title="";if(a=="password"){hidden_title="Password"}inputHandler(_,r,d,b,enter_submit=true,auto_save=false,hidden_title=hidden_title);statusButtonHandler(_,m,h,r,d,b,hidden_title=hidden_title);function y(e){if($(t).length){if($(t).get(0).isContentEditable){$(t).text(n)}else{$(t).val(n)}}if($(i).length){if($(i).get(0).isContentEditable){$(i).text(n)}else{$(i).val(n)}}}$(g).click(y);$(w).click(y);$(_).focus()}function oauth2Dialog(e){const t=e.service_name;const i=e.service_title;const n=e.service_logo;const o="oauth2_dialog_"+t;const s=e.service_scopes;const r=e.service_permission;var a=sprintf('        <div class="col-xs-12 margin-vertical-5">            <div class="row">                <div class="col-xs-12 text-center">                    <a id="%s">                        <img src="%s" alt="%s" class="icon-mega margin-bottom-10">                        <span class="form-text margin-bottom-10">%s</span>                    </a>                </div>            </div>            <div class="row">                <div class="col-xs-12">                    <div class="form-label text-left text-wrap auto-height margin-vertical-5">%s</div>                </div>            </div>        </div>',o,n,i,i,r);var c={title:"Access Authorization",body:a};flexibleDialog(c);const l="#"+o;$(l).on("click",function(){var i=requestingOAuthToken(t,s);i.fail(e.error);i.done(e.success)})}function errorDialog(e){var t="Request Error";var i=e;const n=sprintf('        <div class="col-xs-12 margin-vertical-10">            <div class="form-text auto-height text-wrap">%s</div>        </div>',i);var o={title:t,body:n};flexibleDialog(o)}function retrievingOAuthToken(e,t,i=null,n=false,o=null){var s=ingestArray(t);if(typeof t=="string"){s=[t]}var r=ingestArray(i);if(typeof i=="string"){r=[i]}var a=new $.Deferred;function c(e){if(o){a.resolve();callFunction(o,[e])}else{a.resolve(e)}}var l=window.pouch_db.oauth2_tokens;var d=window.pouch_db.oauth2_tokens_remote;function f(t){logConsole(t);var i=setTimeout(function(){l.replicate.from(d).then(function(i){if(i.docs_written){l.find({selector:{service_name:e},use_index:"service_name"}).then(function(e){const t=e.docs[0];logConsole(t.access_token);c(t)})}else{f(t)}}).catch(function(e){logConsole(JSON.stringify(e));a.reject("sync fail")})},500)}var v=l.find({selector:{service_name:e},use_index:"service_name"});var u=window.pouch_schemas.oauth2_schemas.find({selector:{name:e},use_index:"name"});var p=window.pouch_schemas.record_schemas.find({selector:{name:"lab_scopes"},use_index:"name"});$.when(v,u,p).then(function(t,i,o){var v={};if(t.docs.length){v=t.docs[0]}const u=ingestString(v.access_token);const p=ingestNumber(v.expires_at);const g=i.docs[0].details;const _=o.docs[0].details;var h=[];var m=[];if(!mapSize(v)){m.push(...s)}else{h=v.service_scope.split(" ");for(var w=0;w<s.length;w++){if(h.indexOf(s[w])==-1){m.push(s[w])}}if(m.length){m.push(...h)}}var b="";var y=[];if(!r.length){if(m){for(var w=0;w<m.length;w++){y.push(_[m[w]]["description"])}}else{for(var w=0;w<s.length;w++){y.push(_[s[w]]["description"])}}}else{y.push(...r)}if(y.length==1){b=y[0]}else if(y.length>1){b+="<ul>";for(var w=0;w<y.length;w++){b+="<li>"+y[w]+"</li>"}b+="</ul>"}if(m.length){var x={success:function(){f(u)},error:function(e){a.reject(e)},service_scopes:m,service_permission:b};for(var k in g){x[k]=g[k]}oauth2Dialog(x)}else if(n){var x={success:function(){f(u)},error:function(e){a.reject(e)},service_scopes:h,service_permission:b};for(var k in g){x[k]=g[k]}oauth2Dialog(x)}else if(p&&p<$.now()/1e3){var S=renewingOAuthToken(e);S.done(function(e){l.replicate.from(d).then(function(t){c(e)}).catch(function(t){logConsole(JSON.stringify(t));c(e)})});S.fail(function(e){if(e.indexOf("renewed")>-1||e.indexOf("exist")>-1){var t={success:function(){f(u)},error:function(e){a.reject(e)},service_scopes:h,service_permission:b};for(var i in g){t[i]=g[i]}oauth2Dialog(t)}else{a.reject(e)}})}else{c(v)}});return a.promise()}function loadingSchema(e,t=null){var i=new $.Deferred;window.pouch_schemas.record_schemas.find({selector:{name:e},use_index:"name"}).then(function(e){var n=e.docs[0].details;i.resolve(n);if(t){callFunction(t,[n])}});return i.promise()}function loadingService(e){var t=new $.Deferred;window.pouch_schemas.oauth2_schemas.find({selector:{name:e},use_index:"name"}).then(function(e){var i=e.docs[0].details;t.resolve(i)});return t.promise()}function loadingServices(e=""){var t=new $.Deferred;var i={};window.pouch_schemas.oauth2_schemas.find({selector:{name:{$gt:null}},use_index:"name"}).then(function(n){var o=ingestArray(n.docs);if(!e){for(var s=0;s<o.length;s++){const e=o[s].name;i[e]=o[s].details}t.resolve(i)}else{loadingSchema("lab_experiments").then(function(n){var s=n[e];var r={};for(var a=0;a<s.integrations.length;a++){const e=s.integrations[a].name;r[e]=s.integrations[a]}for(var a=0;a<o.length;a++){var c=o[a].details;var l=c.service_name;if(l in r){i[l]=c;for(var d in r[l]){i[l][d]=r[l][d]}}}t.resolve(i)})}});return t.promise()}function loadingBucket(e,t=true,i=true){var n=new $.Deferred;var o=null;if(!e in window.pouch_db){n.reject(e+" not in window.pouch_db")}else{o=window.pouch_db[e]}function s(s){if(i){const i=e+"_remote";s.sync(window.pouch_db[i]).then(function(i){if(t){o.compact().then(function(t){logConsole(e+" sync complete");n.resolve(o)}).catch(function(e){logConsole(JSON.stringify(e));n.resolve(o)})}else{logConsole(e+" sync complete");n.resolve(s)}}).catch(function(e){logConsole(JSON.stringify(e));n.resolve(s)})}else{if(t){o.compact().then(function(e){n.resolve(o)}).catch(function(e){logConsole(JSON.stringify(e));n.resolve(o)})}else{n.resolve(s)}}}if(!o){var r=patchingSession();r.done(function(t){var i=ingestMap(loadRecord("gateway_auth"));if(mapSize(i)){startingPouchDB().then(function(){if(window.client_history.length){var t=window.client_history.length-1;var i=window.client_history[t].func;var n=ingestArray(window.client_history[t].args);if(n){i(...n)}else{i()}}else{logConsole("fresh");openDashboard()}o=window.pouch_db[e];s(o)})}else{n.reject("user deactivated");openAccount()}});r.fail(function(){n.reject("user not authenticated");openAuthentication()})}else{s(o)}return n.promise()}function loadingLibrary(e,t){var i=new $.Deferred;if(!("javascript_libraries"in window)){window.javascript_libraries={}}if(e in window.javascript_libraries){if(t in window.javascript_libraries[e]){if(e=="google"){if(typeof gapi.client[t]=="undefined"){gapi.client.load(window.javascript_libraries[e][t]).then(function(){i.resolve(gapi.client[t])})}else{i.resolve(gapi.client[t])}}else{i.reject()}}else{i.reject()}}else{i.reject()}return i.promise()}function paginateView(e,t,i,n,o){var s=deepCopy(t);function r(){if($(e).length){if($(e).is(":visible")){setTimeout(function(){if(s.length){const t=$(e).isOnScreen(function(e){return e.top>=-100});if(t){previous_record=ingestMap(s[s.length-1]);i(previous_record).then(function(e){s=e;var t=false;if(s.length){if(s.length<o){t=true}logConsole("paginating");n(s,t).then(function(){if(!t){r()}})}})}else{r()}}},500)}}}r()}function tocLayout(e,t,i=true){if(!ingestString(e)){e="Table of Contents"}var n=[];if($.isArray(t)){for(var o=0;o<t.length;o++){var s={};s.title=ingestString(t[o].section_title);if(!s.title){s.title="Section "+o.toString()}s.id=s.title.toLowerCase().replace(/\s/g,"_");s.selector=ingestString(t[o].section_selector);if(!s.selector){s.selector=sprintf("%s_row"%s.id)}n.push(s)}}var r="/";if("page_url"in window){var r=window.page_url}var a="";if(i){a=sprintf('            <div id="main_top" class="hidden-lg hidden-md hidden-sm">                <div id="top_section" class="section-row">                    <div id="top_section_title" class="form-line">                        <div id="top_section_title_text" class="form-text no-wrap bold" title="%s">%s</div>                    </div>                </div>            </div>',e,e)}var c=sprintf('        <div id="content_container" class="container content-container-scroll">            <div id="content_row" class="row">                <div id="content_column_toc" class="col-sm-3 hidden-xs">                    <div id="toc_section" class="section-last">                        <div id="toc_section_title" class="form-line">                            <div id="toc_section_title_text" class="form-text no-wrap bold" title="%s">%s</div>                        </div>                    </div>                </div>                <div id="content_column_main" class="col-sm-9 col-xs-12">%s                    <div id="content_column_main_body">                    </div>                </div>            </div>        </div>',e,e,a);$("#content").html(c);for(var o=0;o<n.length;o++){var l=n[o].selector;var d=n[o].title;var f=n[o].id;var v=sprintf('            <div id="toc_div_%s" class="form-line">                <a href="%s#%s" id="toc_link_%s" class="form-text no-wrap" title="Go to %s Section">%s</a>            </div>',f,r,l,f,d,d);$("#toc_section").append(v);if(i){var v=sprintf('                <div id="top_div_%s" class="form-line">                    <a href="%s#%s" id="top_link_%s" class="form-text text-nowrap" title="Go to %s Section">%s</a>                </div>',f,r,l,f,d,d);$("#top_section").append(v)}}}function renderEpoch(e){var t=new Date(parseInt(e*1e3,10));return t.toLocaleString()}function contentMiddle(){var e='        <div id="content_container" class="content-container-fill">            <div id="content_row" class="row height-100">                <div id="content_left" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>                <div id="content_middle" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 height-100">                    <div id="content_middle_row" class="row vertical-center">                        <div id="content_middle_column" class="col-lg-12 col-md-12 col-sm-12 col-xs-12"></div>                    </div>                </div>                <div id="content_right" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>            </div>        </div>';$("#content").html(e)}function updateTitle(e){var t={schema:{app_title:"Collective Acuity",app_subtitle:"Welcome to the Laboratory",page_title:"Collective Acuity",page_label:"A Machine Intelligence Laboratory",center_desktop:false},metadata:{example_statements:["update the title fields"]}};var i=t.schema;unpackKwargs(e,i,"updateTitle");var n=document.title.split(" : ");if(i.app_title){n[0]=i.app_title}if(i.app_subtitle){n[1]=i.app_subtitle}document.title=n.join(" : ");var o=["#header_title_desktop_text","#header_title_mobile_text"];for(var s=0;s<o.length;s++){header_id=o[s];if(!i.page_label){$(header_id).removeAttr("title")}else{$(header_id).attr("title",i.page_label)}$(header_id).text(i.page_title)}var r="#header_title_desktop";if(i.center_desktop){$(r).removeClass("navbar-start");$(r).addClass("navbar-center")}else{$(r).removeClass("navbar-center");$(r).addClass("navbar-start")}}function updateAction(e){var t={schema:{name:"Options",icon:"icon-options",label:"View Options",onclick:"slideoutDialog",args:["#dialog_options","bottom"]}};const i="#header_right_mobile";const n="#header_right_button_link";if(typeof e==="undefined"){$(i).hide();$(n).off()}else{var o=t.schema;unpackKwargs(e,o,"updateAction");var s=ingestString(o.onclick);var r=ingestArray(o.args);var a=sprintf('            <div id="header_right_button" class="navbar-title-24 navbar-end">                <a id="header_right_button_link" title="%s" class="%s"></a>            </div>',o.label,o.icon);$(i).html(a);bindFunction(n,s,r)}}function updateOptions(e){var t={schema:{options:[{name:"Experiments",label:"View Experiments",onclick:"openExperiments",args:["experiments_main_body_mitchell"]}]}};var i=t.schema;unpackKwargs(e,i,"updateOptions");var n="#dialog_options_buttons";var o="options_buttons";$(n).empty();for(var s=0;s<i.options.length;s++){var r=i.options[s];var a=ingestString(r.name);var c="dialog_options_button_"+a.toLowerCase().replace(/\s/g,"_");var l="#"+c;var d=ingestString(r.onclick);var f=ingestArray(r.args);var v=ingestString(r.label);var u="navbar-title-24 navbar-center";if(s>0){u+=" options-button"}$("<div/>",{id:c,class:u}).appendTo(n);var p={id:c+"_link",text:a};if(v){p["title"]=v}if(d){$("<a/>").appendTo(l);bindFunction(l,d,f,o)}else{$("<span/>",p).appendTo(l)}}}function updateNavigation(e){var t={schema:{links:[{icon:"icon-chemistry",name:"Experiments",label:"View Experiments",onclick:"methodRequest",args:["experimentView",{method:"GET",route:"/views/experiments"}]}]}};var i=t.schema;unpackKwargs(e,i,"updateNavigation");const n="#header_desktop";const o="#footer_mobile";const s="#header_navigation_row";const r="#footer_navigation_row";var a='<div id="footer_navigation_row" class="row navbar-accent footer-border"></div>';var c='<div id="header_navigation_row" class="row"></div>';$(o).html(a);$(n).html(c);var l=12;var d=0;if(i["links"].length==2){l=6}else if(i["links"].length==3){l=4}else if(i["links"].length==4){l=3}else if(i["links"].length<7){l=2;if(i["links"].length==5){d=4}}else{l=1}for(var f=0;f<i["links"].length;f++){var v=l;if(d&&f==2){v==d}var u=ingestMap(i["links"][f]);var p=ingestString(u.name).toLowerCase().replace(/\s/g,"_");var g="icon-chemistry";if(ingestString(u.icon)){g=ingestString(u.icon)}var _=ingestString(u.label);if(_){_=sprintf(' title="%s"',_)}var h=sprintf('            <div id="footer_navigation_%s_column" class="col-xs-%s">                <div id="footer_navigation_%s_button" class="navbar-title-24 navbar-center">                    <div id="footer_navigation_%s_box">                        <a id="footer_navigation_%s_link" class="%s"%s></a>                    </div>                </div>            </div>',p,v,p,p,p,g,_);$(r).append(h);var m=sprintf('            <div id="header_navigation_%s_column" class="col-xs-%s">                <div id="header_navigation_%s_button" class="navbar-end">                    <div id="header_navigation_%s_box">                        <a id="header_navigation_%s_link" class="%s"%s></a>                    </div>                </div>            </div>',p,v,p,p,p,g,_);$(s).append(m);var w=ingestString(u.onclick);if(w){var b=ingestArray(u.args);var y=sprintf("#header_navigation_%s_link",p);var x=sprintf("#footer_navigation_%s_link",p);bindFunction(y,w,b);bindFunction(x,w,b)}}}function toggleNavigation(e){var t=ingestString(e).toLowerCase().replace(/\s/g,"_");var i=sprintf("#footer_navigation_%s_link",t);var n=sprintf("#header_navigation_%s_link",t);var o="#footer_navigation_row a";var s="#header_navigation_row a";$(o).removeClass("hidden-link bold");$(s).removeClass("hidden-link bold");$(i).addClass("hidden-link bold");console.log(i,$(i).attr("class"));$(n).addClass("hidden-link bold")}function menuBindings(e){const t=ingestArray(e.sections);for(var i=0;i<t.length;i++){const e=ingestArray(t[i].actions);for(var n=0;n<e.length;n++){const t=ingestString(e[n].name).toLowerCase().replace(/\s/g,"_");if(t){var o=ingestString(e[n].onclick);var s=ingestArray(e[n].args);var r="#menu_action_"+t+"_link";bindFunction(r,o,s)}}}}function landingView(){var e='        <div id="landing_container" class="content-container-fill">            <div id="landing_row" class="row height-100">                <div id="landing_left" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>                <div id="landing_middle" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 height-100">                    <div id="landing_middle_row" class="row vertical-center">                        <div id="landing_middle_column" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">                            <div id="landing_box" class="font-mega text-center line-height-1 padding-vertical-20">                                <div id="landing_box_animation" class="burst-effect">                                    <a id="landing_box_icon" title="Click to Open Lab"><img src="/public/images/logos/lab-logo.svg"></a>                                </div>                            </div>                        </div>                    </div>                </div>                <div id="landing_right" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>            </div>        </div>';$("#content").html(e);showLanding();$("#landing_box_icon").click(function(e){$("#landing_box_icon").off();$("#landing_box").fadeOut(600);hideLanding();openLab()})}function inputView(e){var t=ingestString(e.selector);var i=ingestString(e.title);var n=i.toLowerCase().replace(/\s/g,"_");var o=ingestString(e.prompt);var s=ingestString(e.label);var r=ingestString(e.type);var a=e.promise;var c=e.success;var l=ingestArray(e.options);var d=ingestString(e.placeholder);var f=ingestMap(e.criteria);var v=ingestArray(e.promise_args);var u=ingestString(e.repeat_label);var p=ingestString(e.repeat_placeholder);var g=ingestString(e.honeypot_label);var _=ingestString(e.honeypot_type);var h=g.toLowerCase().replace(/\s/g,"_");var m="";if(u&&s){m=sprintf('            <div id="%s_top_repeat" class="col-xs-12"><div class="form-label invisible">%s</div></div>            <div id="%s_middle_repeat" class="col-xs-12 margin-bottom-10"><div class="form-text invisible">&nbsp;</div></div>',n,u,n)}var w=sprintf('        <div id="%s_prompt" class="col-xs-12 margin-bottom-10"><div class="form-text auto-height invisible">%s</div></div>%s        <div id="%s_top" class="col-xs-12"><div class="form-label">&nbsp;</div></div>        <div id="%s_middle" class="col-xs-12 margin-bottom-5"><div class="form-input invisible">&nbsp;</div></div>        <div id="%s_bottom" class="col-xs-12 margin-bottom-10"><div class="form-label">&nbsp;</div></div>',n,o,m,n,n,n);if(o){var b=sprintf('<div id="%s_msg_text" class="form-text auto-height text-wrap">%s</div>',n,o)}var y="";if(m){var x=sprintf('<div id="%s_top_repeat_text" class="form-label bold">%s:</div>',n,u);var k=sprintf('            <form id="%s_form_repeat" title="%s">                <div id="%s_form_row_repeat" class="row">                    <div id="%s_form_left_repeat" class="col-xs-12">                        <label id="%s_form_label_repeat" for="%s_input_repeat" class="sr-only">%s</label>                        <input id="%s_input_repeat" type="%s" placeholder="%s" autofocus class="form-input">                    </div>                </div>            </form>',n,u,n,n,n,n,u,n,r,p);y="#"+n+"_input_repeat"}var S="";var C="";if(g){var C=sprintf('            <div id="%s_form_row" class="row" style="display:none">                <div id="%s_form_left" class="col-xs-12">                    <label id="%s_form_label" for="%s_input" class="sr-only">%s</label>                    <input id="%s_input" type="%s" placeholder="%s" class="form-input">                </div>            </div>',h,h,h,h,g,h,_,d);S="#"+h+"_input"}if(s){var A=sprintf('<div id="%s_top_text" class="form-label bold">%s:</div>',n,s)}if(r){var T=" autofocus";if(m){T=""}var D=sprintf('            <form id="%s_form" title="%s">                <div id="%s_form_row" class="row">                    <div id="%s_form_left" class="col-lg-11 col-md-11 col-sm-11 col-xs-10 padding-right-0">                        <label id="%s_form_label" for="%s_input" class="sr-only">%s</label>                        <input id="%s_input" type="%s" placeholder="%s"%s class="form-input">                    </div>                    <div id="%s_form_right" class="col-lg-1 col-md-1 col-sm-1 col-xs-2 text-right padding-left-0">                        <div id="%s_status" class="form-input">                            <span id="%s_status_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>                            <span id="%s_status_submit" class="icon-arrow-right-circle icon-success"></span>                        </div>                    </div>                </div>%s            </form>',n,s,n,n,n,n,s,n,r,d,T,n,n,n,n,C)}if(l){var R=sprintf('<div id="%s_bottom_row" class="row"></div>',n)}var O=sprintf("#%s_prompt",n);var j=sprintf("#%s_top",n);var M=sprintf("#%s_middle",n);var L=sprintf("#%s_bottom",n);if(m){var I=sprintf("#%s_top_repeat",n);var P=sprintf("#%s_middle_repeat",n)}if(!t){t="#input_box"}$(t).html(w);var E=0;if(o){E=300;$(O).html(b).hide().fadeIn(600)}if(m){setTimeout(function(){$(I).html(x).hide().fadeIn(600);$(P).html(k).hide().fadeIn(600);$(y).focus()})}if(s){setTimeout(function(){$(j).html(A).hide().fadeIn(600)},E)}if(r){setTimeout(function(){$(M).html(D).hide().fadeIn(600);var e=sprintf("#%s_input",n);var t=sprintf("#%s_status_error",n);var o=sprintf("#%s_status_submit",n);if(y){f["identical_to"]={};f["identical_to"][y]=sprintf("does not match %s.",u)}else{$(e).focus()}var s=function(t){var i=[t];if(g){var n=$(S).val();i.push(n)}if(v){for(var o=0;o<v.length;o++){i.push(v[o])}}a(...i).then(c,function(t){var i={anchor_selector:e,message_text:t,message_status:"error",message_location:"bottom",timeout:5e3};showMessage(i);$(e).val("");$(e).focus()})};var l="";if(r=="password"){l="Password"}inputHandler(e,i,f,s,enter_submit=true,auto_save=false,l=l);statusButtonHandler(e,t,o,i,f,s,l=l)},E)}var z=E;if(r||s){z=E+300}if(l){setTimeout(function(){$(L).html(R).hide();var e="#"+n+"_bottom";var t="#"+n+"_bottom_row";var i=12;if(l.length==2){i=6}else if(l.length==3){i=4}for(var o=0;o<l.length;o++){if(o>2){break}const e=ingestString(l[o].name);const s=ingestString(l[o].onclick);const r=ingestString(l[o].label);const a=ingestArray(l[o].args);const c=sprintf("#%s_options_%s_link",n,o);const d=sprintf('                    <div id="%s_options_%s" class="col-xs-%s">                        <a id="%s_options_%s_link" title="%s" class="form-label text-left">%s</a>                    </div>',n,o,i,n,o,r,e);$(d).appendTo(t);bindFunction(c,s,a)}$(e).fadeIn(600)},z)}}function confirmationView(e){var t=ingestString(e.selector);var i=ingestString(e.title);var n=i.toLowerCase().replace(/\s/g,"_");var o=ingestString(e.prompt);var s=ingestString(e.label);var r=ingestArray(e.options);var a="&nbsp;";if(o){a=o}var c="&nbsp;";if(s){c=s}var l=sprintf('        <div id="%s_top" class="col-xs-12 margin-bottom-10"><div class="form-text auto-height invisible">%s</div></div>        <div id="%s_middle" class="col-xs-12 margin-bottom-10"><div class="form-label bold auto-height invisible">%s</div></div>        <div id="%s_bottom" class="col-xs-12 margin-bottom-10"><div class="form-label invisible">&nbsp;</div></div>',n,a,n,c,n);var d=sprintf("#%s_top",n);var f=sprintf("#%s_middle",n);var v=sprintf("#%s_bottom",n);if(!t){t="#input_box"}$(t).html(l);var u=0;if(o){u=300;var p=sprintf('<div id="%s_top_text" class="form-text auto-height">%s</div>',n,o);$(d).html(p).hide().fadeIn(600)}var g=u;if(s){g=u+300;var _=sprintf('<div id="%s_middle_text" class="form-label bold auto-height word-wrap">%s</div>',n,s);setTimeout(function(){$(f).html(_).hide().fadeIn(600)},u)}if(r){setTimeout(function(){var e=sprintf('<div id="%s_bottom_row" class="row"></div>',n);$(v).html(e).hide();var t="#"+n+"_bottom";var i="#"+n+"_bottom_row";var o=12;if(r.length==2){o=6}else if(r.length==3){o=4}for(var s=0;s<r.length;s++){if(s>2){break}const e=ingestString(r[s].name);const t=ingestString(r[s].onclick);const a=ingestString(r[s].label);const c=ingestArray(r[s].args);const l=sprintf("#%s_options_%s_link",n,s);const d=sprintf('                    <div id="%s_options_%s" class="col-xs-%s">                        <a id="%s_options_%s_link" title="%s" class="form-label text-left word-wrap">%s</a>                    </div>',n,s,o,n,s,a,e);$(d).appendTo(i);bindFunction(l,t,c)}$(t).fadeIn(600)},g)}}function tableView(e,t,i,n=false){const o="#"+e;const s=o+"_mobile";const r=o+"_desktop";const a=o+"_tbody";var c=[];var l=0;if(!$(s).length){var d=sprintf('            <div id="%s_mobile" class="hidden-lg hidden-md hidden-sm col-xs-12 mobile-table"></div>            <div id="%s_desktop" class="col-lg-12 col-md-12 col-sm-12 hidden-xs"></div>',e,e);$(o).html(d);var f='<table class="table"><thead class=""><tr>';for(var v=0;v<i.length;v++){for(var u in i[v]){c.push(u);f+="<th>"+i[v][u]+"</th>"}}f+=sprintf('</tr></thead><tbody id="%s_tbody"></tbody></table>',e);$(r).html(f)}else{for(var v=0;v<i.length;v++){for(var u in i[v]){c.push(u)}}$(s).find("> section").each(function(e,t){l+=1})}for(var v=0;v<t.length;v++){var p="<tr>";if(v<t.length-1||!n){$('<section class="row section-row"></section>').appendTo($(s))}else{$('<section class="row section-last"></section>').appendTo($(s))}mobile_col_selector=s+" section:nth-child("+(v+1+l).toString()+")";for(var g=0;g<c.length;g++){var _=c[g];var h="&nbsp;";if(_ in t[v]){h=t[v][_]}p+="<td>"+h+"</td>";var m=i[g][_];var w=sprintf('<div class="col-xs-12 margin-vertical-5"><div class="col-xs-4 padding-left-0 bold">%s:</div><div class="col-xs-8 padding-right-0 text-right">%s</div></div>',m,h);$(w).appendTo($(mobile_col_selector))}p+="</tr>";$(p).appendTo($(a))}}function loginView(){loadingSchema("lab_criteria").then(function(e){var t={app_subtitle:"Login to the Laboratory",page_title:"Account Login",page_subtitle:"Login to the Laboratory"};updateTitle(t);var i={selector:"#input_box",title:"Account Login",label:"Email Address",prompt:"Login to the Laboratory",type:"text",promise:puttingSession,success:function(e,t,i){if(i){console.log("Account has not been confirmed.");confirmWaitView(t)}else{passwordView(t)}},placeholder:"satoshi@bitcoin.org",options:[{name:"Create an Account",label:"Create a New Account",onclick:"signupView"}],criteria:e["email_address"]};inputView(i)})}function passwordView(e){if(!("client_history"in window)){window.client_history=[]}loadingSchema("lab_criteria").then(function(t){var i={selector:"#input_box",title:"Account Password",label:"Account Password",prompt:"Hi, "+e,type:"password",promise:postingSession,success:function(e,t){showTitle();showDashboard();if(!t){openAccount()}else if(window.client_history.length){var i=window.client_history.length-1;var n=window.client_history[i].func;var o=ingestArray(window.client_history[i].args);if(o){n(...o)}else{n()}}else{logConsole("fresh");openDashboard()}},placeholder:"&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;",options:[{name:"Forgot Password?",label:"Reset your Password",onclick:"resetView",args:[e]},{name:"Change Account",label:"Use a Different Account",onclick:"loginView"}],criteria:t["account_password"]};inputView(i)})}function signupView(){loadingSchema("lab_criteria").then(function(e){var t={app_subtitle:"Signup for Laboratory Access",page_title:"Account Signup",page_subtitle:"Signup for Laboratory Access"};updateTitle(t);var i={selector:"#input_box",title:"Account Email",label:"Account Email",prompt:"Signup for Laboratory Access",type:"text",promise:puttingAccount,success:function(e,t){confirmWaitView(t)},placeholder:"satoshi@bitcoin.org",options:[{name:"Login to Account",label:"Login to the Laboratory",onclick:"loginView"},{name:"Lab Protocols",label:"Protocols for Laboratory Access",onclick:"loadingSchema",args:["lab_protocols","itemizedDialog"]}],honeypot_label:"Account Password",honeypot_type:"password",criteria:e["email_address"]};inputView(i)})}function confirmWaitView(e){var t={app_subtitle:"Signup for Laboratory Access",page_title:"Account Confirmation",page_subtitle:"Waiting for Account Confirmation"};updateTitle(t);var i={selector:"#input_box",title:"Account Confirmation",label:"A confirmation link has been sent to your email at "+e,prompt:"Check your Email!",type:"",promise:null,success:null,placeholder:"",options:[{name:"Resend Confirmation",label:"Resend Email to Confirm Account",onclick:"resendConfirmation",args:[e]},{name:"Change Account",label:"Use a Different Account",onclick:"loginView"}]};inputView(i);var n=setInterval(function(){var e=ingestMap(loadRecord("gateway_auth"));if(mapSize(e)){startingPouchDB().done(function(){clearInterval(n);showTitle();showDashboard();if(window.client_history){var e=window.client_history.length-1;var t=window.client_history[e].func;var i=ingestArray(window.client_history[e].args);if(i){t(...i)}else{t()}}else{logConsole("fresh");openDashboard()}})}},5e3)}function resendConfirmation(e){var t=postingAccount(e,"resend");t.done(function(){var t={title:"Email Sent!",body:sprintf("<p>A new confirmation link has been sent to your email at %s</p>",e)};flexibleDialog(t)});t.fail(function(e){var t="#account_confirmation_options_0_link";const i={anchor_selector:t,message_text:e,message_status:"error",timeout:5e3};showMessage(i)});t.always(function(){var e="#account_confirmation_options_0_link";convertElement(e,"span");$(e).off()})}function resetView(e){loadingSchema("lab_criteria").then(function(e){var t={app_subtitle:"Login to the Laboratory",page_title:"Password Reset",page_subtitle:"Reset Account Password"};updateTitle(t);var i={selector:"#input_box",title:"Account Email",label:"Email Address",prompt:"Type Your Email to Reset",type:"type",promise:postingAccount,promise_args:["reset"],success:function(e,t){resetWaitView(t)},placeholder:"satoshi@bitcoin.org",options:[{name:"Change Account",label:"Use a Different Account",onclick:"loginView"}],criteria:deepCopy(e["email_address"])};i["criteria"]["equal_to"]={account_email:"does not match cached address."};inputView(i)})}function resetWaitView(e){var t={app_subtitle:"Login to the Laboratory",page_title:"Password Reset",page_subtitle:"Waiting for Password Reset"};updateTitle(t);var i={selector:"#input_box",title:"Password Reset",label:"A link to reset your password has been sent to your email at "+e,prompt:"Check your Email!",options:[{name:"Change Account",label:"Use a Different Account",onclick:"loginView"}]};confirmationView(i);var n=setInterval(function(){var e={method:"GET",route:"/records/oauth2-services"};var t=requestingResource(e);t.done(function(){clearInterval(n);showTitle();showDashboard();if(window.client_history){var e=window.client_history.length-1;var t=window.client_history[e].func;var i=ingestArray(window.client_history[e].args);if(i){t(...i)}else{t()}}else{logConsole("fresh");openDashboard()}})},5e3)}function updateView(e,t){loadingSchema("lab_criteria").then(function(i){var n={app_subtitle:"Signup for Laboratory Access",page_title:"Account Signup",page_subtitle:"Create your Password"};if(e=="reset"){n["app_subtitle"]="Login to the Laboratory";n["page_title"]="Password Reset";n["page_subtitle"]="Reset your Password"}updateTitle(n);var o={selector:"#input_box",title:"Account Password",label:"Confirm Password",repeat_label:"New Password",prompt:"Create a Password to Finish Signup Process",type:"password",promise:patchingAccount,promise_args:["",t],success:function(t){updateSuccessView(e)},placeholder:"&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;",repeat_placeholder:"&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;",options:[{name:"Change Account",label:"Use a Different Account",onclick:"loginView"}],criteria:i["account_password"]};if(e=="reset"){o["prompt"]="Create a New Password to Finish Reset Process"}inputView(o)})}function updateSuccessView(e){var t={app_subtitle:"Signup for Laboratory Access",page_title:"Account Signup",page_subtitle:"Create your Password"};if(e=="reset"){t["app_subtitle"]="Login to the Laboratory";t["page_title"]="Reset Confirmation";t["page_subtitle"]="Reset your Password"}updateTitle(t);var i={selector:"#input_box",title:"Account Password",prompt:"Sweet! Account Setup Complete.",label:"You can now link third-party services and access laboratory experiments.",options:[{name:"Open Lab",label:"Click to Open Laboratory",onclick:"openLab"}]};if(e=="reset"){i["prompt"]="Sweet! Password Reset Complete.";i["label"]="You can now access the laboratory using your new password."}confirmationView(i)}function reportView(e){var t={app_subtitle:"Report Behavior",page_title:"Report Confirmation",page_subtitle:"Confirmation of Reported Behavior"};updateTitle(t);function i(e){var t={selector:"#input_box",title:"Behavior Report",prompt:"Thank You! Reported Abuse Recorded.",label:"Reporting activity on your account which you did not perform helps the lab identify unusual behavior and keep your account safe.",options:[{name:"Open Lab",label:"Click to Open Laboratory",onclick:"openLab"}]};confirmationView(t)}var n={method:"PUT",route:"/report",body:{account_token:e}};requestingResource(n).always(i)}function oauth2CallbackView(e){var t=e["service_title"]+" Connected";var i={app_subtitle:t};updateTitle(i);var n={selector:"#input_box",title:t,prompt:sprintf("Sweet! Your laboratory experiments are now connected to %s.",e["service_title"]),label:"Closing in 10...",options:[{name:"Close Now",label:"Click to Close Window",onclick:"close"}]};confirmationView(n);var o=9;var s=sprintf("#%s_middle_text",t.toLowerCase().replace(/\s/g,"_"));var r=setInterval(function(){if(o>0){var e=sprintf("Closing in %s...",o);$(s).text(e);o-=1}else{clearInterval(r)}},1e3)}function overloadView(){}function integrationsView(e,t,i,n){var o=[];var s={};var r=[];i=ingestMap(i);for(var a in i){var c=i[a];r.push({name:a,date:ingestNumber(c.service_added),type:"oauth2"});for(var l=0;l<ingestArray(c.service_tags).length;l++){if($.inArray(c.service_tags[l],o)==-1){o.push(c.service_tags[l]);s[c.service_tags[l]]=[]}s[c.service_tags[l]].push(a)}}r.sort(function(e,t){return t.date-e.date});o.sort();o.unshift("Latest");if($.inArray("Important",o)>-1){o.splice($.inArray("Important",o),1);o.unshift("Important")}for(var a in s){s[a].sort()}var d="service_integrations";var f="#service_integrations_content_container";var v='<div id="service_integrations_content_container" class="container content-container-scroll"></div>';toggleView(f,v);var u=sprintf('        <div id="service_integrations_content_row" class="row">            <div id="service_integrations_content_column_index" class="col-sm-3 hidden-xs">                <div id="service_integrations_index_section" class="section-last">                    <div id="service_integrations_index_section_title" class="form-line">                        <div id="service_integrations_index_section_title_text" class="form-text no-wrap bold" title="Integration Categories">Categories</div>                    </div>                </div>            </div>            <div id="service_integrations_content_column_main" class="col-sm-9 col-xs-12">                <div id="service_integrations_content_column_main_body">                </div>            </div>        </div>');$(f).html(u);var p={};var g={};var _={};var h={};function m(e,t,i,n){const o=i.service;const s=i.description;const r=i.title;const a=r.toLowerCase().replace(/\s/g,"_");const c=sprintf("%s_%s_%s",t,o,a);const l=ingestArray(i.experiments);const d=c+"_input";const f=i.scope;if(!(f in p)){p[f]=[]}p[f].push({selector:"#"+d,service:o});var v="";var u="icon-plus icon-hyperlink font-sm";if(n.indexOf(f)>-1){v=" checked";u="icon-check icon-success font-sm"}var g=[];var _="";if(l.length){_=" Integrates with: ";for(var h=0;h<l.length;h++){var m=l[h].title;var w=ingestString(l[h].url);var b=m.toLowerCase().replace(/\s/g,"_");var y=c+"_exp_"+b;var x="";var k="";if(w.indexOf("http")==0){k=sprintf(' href="%s"',w)}else{x=deepCopy(w)}if(h){_+=", "}_+=sprintf('<a%s id="%s">%s</a>',k,y,m);if(x){const e="#"+y;g.push({selector:e,func:x})}}}var S=sprintf('            <div id="%s_container" class="col-xs-12">                <div id="%s_row" class="row">                    <div class="col-xs-2"></div>                    <div id="%s_left" class="col-xs-1">                        <div id="%s" class="%s"></div>                    </div>                    <div id="%s_right" class="col-xs-9">                        <div id="%s_title" class="form-text text-left">%s</div>                    </div>                </div>                <div class="row">                    <div class="col-xs-3"></div>                    <div id="%s_bottom" class="col-xs-9">                        <div id="%s_desc" class="form-label text-left text-wrap auto-height margin-vertical-5">%s%s</div>                    </div>                </div>            </div>',c,c,c,d,u,c,c,r,c,c,s,_);$(e).append(S);for(var C=0;C<g.length;C++){const e=g[C].selector;const t=g[C].func;$(e).on("click",function(e){callFunction(t)})}}function w(i,n,o,s){function r(e){var t=$("html, body").scrollTop();for(var i=0;i<s.length;i++){const t=s[i];if($(t.selector).length){if(e.indexOf(o)>-1){$(t.selector).attr("class","icon-check icon-success font-sm")}else{$(t.selector).attr("class","icon-plus icon-hyperlink font-sm")}}}}function a(e){if(e=="sync fail"){r(o)}else{for(var t=0;t<s.length;t++){const i=s[t];if($(i.selector).length){const t={anchor_selector:i.selector,message_text:e,message_status:"error",timeout:5e3};showMessage(t)}}}}if(i){var c=retrievingOAuthToken(n,o);c.done(function(e){r(e.service_scope)});c.fail(function(e){logConsole(e);a(e)})}else{e.find({selector:{service_name:n},use_index:"service_name"}).then(function(i){var s="";if(i.docs.length){var a=i.docs[0];var c=[];const r=a.service_scope;if(r){c=r.split(" ")}var l=[];for(var d=0;d<c.length;d++){if(c[d]!=o){l.push(c[d])}}if(l){if(l.length==1){s=l[0]}else{s=l.join(" ")}}var f=[];if(s){a.service_scope=s;f.push(e.put(a))}else{f.push(e.remove(a))}if(i.docs.length>1){for(var d=1;d<i.docs.length;d++){const t=i.docs[d];f.push(e.remove(t))}}if(f){$.when(...f).then(function(){e.sync(t).then(function(e){logConsole(n+" scopes updated")})})}}r(s)})}}function b(e,t,i,n="",o=""){const s="#"+t;const r=i.service_logo;const a=ingestString(i.service_url);const c=t+"_input";const l=i.service_title;const d=injectLinks(i.service_description);const f=i.service_organization;const v=ingestArray(i.service_scopes);var u="";if(n){u=" checked"}var p=f;if(a){var p=sprintf('<a id="%s_organization_link" href="%s" target="_blank">%s</a>',t,a,f)}var g=sprintf('            <div id="%s_container" class="col-lg-6 col-md-6 col-sm-12 col-xs-12">                <div id="%s_details" class="row">                    <div id="%s_left" class="col-xs-3">                        <img src="%s" class="icon-mega">                    </div>                    <div id="%s_right" class="col-xs-9">                        <div class="row">                            <div id="%s_title" class="col-xs-12 form-text text-left bold margin-bottom-5">%s</div>                        </div>                        <div class="row">                            <div id="%s_organization" class="col-xs-12 form-label text-left margin-bottom-5">by %s</div>                        </div>                        <div class="row">                            <div id="%s_description" class="col-xs-12 form-label text-left text-wrap auto-height margin-bottom-5">%s</div>                        </div>                    </div>                </div>                \x3c!-- <div id="%s_label" class="row margin-bottom-5">                    <div class="col-xs-3"></div>                    <div id="%s_label_text" class="col-xs-9 form-label bold text-left">Supports the following permissions:</div>                </div> --\x3e                <div id="%s_scopes" class="row margin-bottom-10 auto-height">                </div            </div>',t,t,t,r,t,t,l,t,p,t,d,t,t,t);$(e).append(g);const _="#"+t+"_scopes";for(var h=0;h<v.length;h++){const e=v[h];m(_,t,e,o)}}for(var l=0;l<o.length;l++){const e=o[l];const t=e.toLowerCase().replace(/\s/g,"_");const a="service_integrations_main_body_"+t;const c="service_integrations_index_section_"+t+"_link";var y=sprintf('            <div id="service_integrations_index_section_%s" class="form-line">                <a id="%s" class="form-text no-wrap" title="Go to %s Category">%s</a>            </div>',t,c,e,e);$("#service_integrations_index_section").append(y);var x="#"+c;$(x).click(function(){scrollDiv(a)});var k=sprintf('            <div id="%s" class="section-last">                <div id="%s_title" title="%s" class="form-text margin-bottom-10 bold">%s</div>                <div id="%s_services" class="row"></div>            </div>',a,a,e,e,a);$("#service_integrations_content_column_main_body").append(k);if(e=="Latest"){var S=3;if(r.length<3){S=r.length}for(var C=0;C<S;C++){var A=r[C].name;var T=r[C].type;var D=sprintf("%s_service_%s",a,A);var R=i[A];var O="";var j="";if(A in n){O=ingestString(n[A].access_token);j=ingestString(n[A].service_scope)}var M=sprintf("#%s_services",a);if(T=="oauth2"){const e=[M,D,R,O,j];b(...e)}if(C&&C%2){$('<div class="clearfix"></div>').appendTo($(M))}}}else{for(var C=0;C<s[e].length;C++){var A=s[e][C];var T=r[C].type;var D=sprintf("%s_service_%s",a,A);var R=i[A];var O="";var j="";if(A in n){O=ingestString(n[A].access_token);j=ingestString(n[A].service_scope)}var M=sprintf("#%s_services",a);if(T=="oauth2"){const e=[M,D,R,O,j];b(...e)}if(C&&C%2){$('<div class="clearfix"></div>').appendTo($(M))}}}}for(var a in p){const e=a;const t=p[a];for(var l=0;l<p[a].length;l++){const i=p[a][l];const n=i.service;$(i.selector).on("click",function(i){const o=$(this).attr("class");if(o.indexOf("icon-plus")>-1){w(true,n,e,t)}else{w(null,n,e,t)}})}}}function settingsView(e,t,i,n,o){function s(e,t){var i=ingestString(t.field_placeholder);var n=ingestString(t.field_value);var o=ingestString(t.field_type);var s="";if(n){s=sprintf(' value="%s"',n)}var r=e+"_input";if(o=="text"){var a=sprintf('<input id="%s" type="text" placeholder="%s" class="form-input"%s>',r,i,s)}else if(o=="textarea"){var a=sprintf('<textarea id="%s" placeholder="%s" class="form-input-textarea"%s></textarea>',r,i,s)}else if(o=="fixed"){var a=sprintf('<div id="%s" class="form-text no-wrap">%s</div>',r,n)}else if(o=="password"){var a=sprintf('<input id="%s" type="password" placeholder="%s" class="form-input"%s>',r,i,s)}else if(o=="button"){var c=sprintf('<div class="row"><div class="col-lg-4 col-md-4 col-sm-12 col-xs-12"><div id="%s" class="form-button">%s</div></div></div>',r,n)}$("#"+e+"_form_left").append(a);if(o=="textarea"){var l="#"+r;autosize($(l))}}function r(e,t){var i=sprintf('            <form id="%s_form" title="%s">                <div id="%s_form_row" class="row auto-height margin-bottom-10"></div>            </form>',e,t.field_description,e);$("#"+e+"_middle").append(i);var n="col-lg-12 col-md-12 col-sm-12 col-xs-12";var o=false;if(ingestBoolean(t.field_status)){if(ingestString(t.field_type)!="textarea"){n="col-lg-11 col-md-11 col-sm-11 col-xs-10 padding-right-0"}o=true}var r=sprintf('            <div id="%s_form_left" class="%s">                <label id="%s_form_label" for="%s_input" class="sr-only">%s</label>            </div>',e,n,e,e,t.field_description);$("#"+e+"_form_row").html(r);var a=sprintf('<span id="%s_status_success" class="icon-check icon-success"></span>',e);if(!ingestBoolean(t.field_autosave)){a=sprintf('<a id="%s_status_success" class="icon-arrow-right-circle icon-success"></a>',e)}var c=sprintf('            <div id="%s_form_right" class="col-lg-1 col-md-1 col-sm-1 col-xs-2 text-right padding-left-0">                <div id="%s_status" class="form-input">                    <span id="%s_status_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>%s                </div>            </div>',e,_form_right_class,e,e,a);var l=sprintf('            <div id="%s_form_textarea" class="form-submit-overlay">                <div id="%s_form_textarea_row" class="row">                    <div id="%s_form_textarea_right" class="col-xs-1 text-right">                        <div id="%s_status" class="form-text">                            <span id="%s_status_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>%s                        </div>                    </div>                </div>            </div>',e,e,e,e,e,a);if(o){if(ingestString(t.field_type)=="textarea"){$("#"+e+"_middle").append(l)}else{$("#"+e+"_form_row").append(c)}}s(e,t)}function a(e,t){var i=t.field_options;if(!$.isArray(i)){i=[]}var n=ingestString(t.field_description);var o=ingestBoolean(t.field_value);if(i.length){o=ingestString(t.field_value)}var s=sprintf("%s_middle",e);var r="#"+s;var a=sprintf("%s_toggle",e);var c="#"+a;var l=e+"_input";var d=sprintf('<div id="%s" class="form-text auto-height margin-bottom-10"></div>',a);$(r).html(d);if(i.length){for(var f=0;f<i.length;f++){var v=i[f].value;var u=i[f].title;var p=i[f].description;var g="";if(o==v){g=" checked"}var _="";if(f+1<i.length){_=" margin-bottom-5"}var h=sprintf("%s_input_%s",e,v);var m=sprintf('                    <div class="row">                            <div class="col-xs-1">                                <input id="%s" type="radio" name="%s" class="radial-md" value="%s"%s>                            </div>                            <div id="%s_text" class="col-xs-11%s">%s</div>                    </div>',h,l,v,g,h,_,p);$(c).append(m)}}else{var g="";if(o){g=" checked"}var m=sprintf('                <div class="row">                    <div class="col-xs-1">                        <input id="%s" class="radial-md" type="checkbox"%s>                    </div>                    <div id="%s_text" class="col-xs-11">%s</div>                </div>',l,g,l,n);$(c).append(m)}}function c(e,o,s,c){const l="#"+s;const d=ingestString(c.field_name);const f=ingestString(c.field_title);const v=ingestString(c.field_type);const u=ingestBoolean(c.field_status);const p=ingestMap(c.field_criteria);const g=ingestBoolean(c.field_autosave);const _=ingestArray(c.field_options);const h=injectLinks(ingestString(c.field_info));const m=sprintf("%s_field_%s",o,d);const w=sprintf("#%s_input",m);const b=sprintf("#%s_status_error",m);const y=sprintf("#%s_status_success",m);var x=sprintf('            <div id="%s_column padding-bottom-5">                <div id="%s_left" class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                    <div id="%s_left_title" class="form-text auto-height margin-bottom-10">                        %s:                    </div>                </div>                <div id="%s_top" class="hidden-lg hidden-md hidden-sm col-xs-12">                    <div id="%s_left_top" class="form-label bold">                        %s:                    </div>                </div>                <div id="%s_middle" class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                </div>                <div id="%s_bottom" class="col-lg-9 col-lg-offset-3 col-md-9 col-md-offset-3 col-sm-9 col-sm-offset-3 col-xs-12">                </div>\t\t\t</div>',m,m,m,f,m,m,f,m,m);$(l).append(x);var k=["text","textarea","fixed","password","button"];var S=["checkbox","radial"];if($.inArray(v,k)>-1){r(m,c)}else if($.inArray(v,S)>-1){a(m,c)}if(h){const e="#"+m+"_bottom";var C=sprintf('<div id="%s_info" class="form-label text-left text-wrap auto-height">%s</div>',m,h);$(e).html(C)}function A(o){var s={};s[e]={};s[e][d]=o;t.get(n).then(function(e){var n=upsertValues(s,e);t.put(n).then(function(){if($(w).length){if($(w).get(0).isContentEditable){$(w).text(o)}else{$(w).val(o)}}t.replicate.to(i).then(function(e){}).catch(function(e){logConsole(JSON.stringify(e))})}).catch(function(e){const t={anchor_selector:w,message_text:e,message_status:"error",timeout:5e3};showMessage(t)})})}if(v=="radial"){if(_.length){for(var T=0;T<_.length;T++){const e=_[T].value;const t=w+"_"+e;$(t).on("click",function(t){if($(this).is(":checked")){A(e)}})}}}else if(v=="checkbox"){$(w).on("click",function(e){if($(this).is(":checked")){A(true)}else{A(false)}})}else if(v!="fixed"&&v!="button"){inputHandler(w,f,p,A);if(u){if(g){statusIconHandler(w,b,p)}else{statusButtonHandler(w,b,y,f,p,A)}}}}var l="#"+e+"_content_container";var d=sprintf('<div id="%s_content_container" class="container content-container-scroll"></div>',e);toggleView(l,d);var f=sprintf('        <div id="%s_content_row" class="row">            <div id="%s_content_column_index" class="col-sm-3 hidden-xs">                <div id="%s_index_section" class="section-last">                    <div id="%s_index_section_title" class="form-line">                        <div id="%s_index_section_title_text" class="form-text no-wrap bold" title="List of Sections">Sections</div>                    </div>                </div>            </div>            <div id="%s_content_column_main" class="col-sm-9 col-xs-12">                <div id="%s_content_column_main_body">                </div>            </div>        </div>',e,e,e,e,e,e,e);$(l).html(f);for(var v=0;v<o.length;v++){const t=o[v].section_title;const i=o[v].section_name;const n=e+"_main_body_"+i;const s=e+"_index_section_"+i+"_link";const r=o[v].section_description;const a=o[v].section_fields;const l=n+"_fields";const d="#"+e+"_index_section";var u=sprintf('            <div id="%s_index_section_%s" class="form-line">                <a id="%s" class="form-text no-wrap" title="Go to %s Section">%s</a>            </div>',e,i,s,t,t);$(d).append(u);var p="#"+s;$(p).click(function(){scrollDiv(n)});const f="#"+e+"_content_column_main_body";var g=sprintf('            <div id="%s" class="section-last">                <div id="%s_title" title="%s" class="form-text margin-bottom-10 bold">%s</div>                <div id="%s" class="row"></div>            </div>',n,n,r,t,l);$(f).append(g);for(var _=0;_<a.length;_++){c(i,n,l,a[_])}}}function accountView(e,t){var i="account_settings";var n="";var o="#"+i+"_content_container";var s=o+" .hidden-bottom";function r(e,t){const i=ingestString(t.placeholder);const n=ingestString(t.value);const o=ingestString(t.type);const s=ingestString(t.description);const r=ingestBoolean(t.status);const a=ingestString(t.color);const c="#"+e+"_middle";const l="#"+e+"_form_row";var d=sprintf('            <form id="%s_form" title="%s">                <div id="%s_form_row" class="row auto-height margin-bottom-10"></div>            </form>',e,s,e);$(c).append(d);var f="col-lg-12 col-md-12 col-sm-12 col-xs-12";if(r){f="col-lg-11 col-md-11 col-sm-11 col-xs-10 padding-right-0"}var v="";if(n){v=sprintf(' value="%s"',n)}var u=e+"_input";var p="";if(a){p=" "+a}g="";if(o=="text"){var g=sprintf('<input id="%s" type="text" placeholder="%s" class="form-input%s"%s>',u,i,p,v)}else if(o=="textarea"){var g=sprintf('<textarea id="%s" placeholder="%s" class="form-input-textarea%s">%s</textarea>',u,i,p,n)}else if(o=="fixed"){var g=sprintf('<div id="%s" class="form-text no-wrap%s">%s</div>',u,p,n)}else if(o=="password"){var g=sprintf('<input id="%s" type="password" placeholder="%s" class="form-input%s"%s>',u,i,p,v)}else if(o=="button"){var g=sprintf('<div class="row"><div class="col-lg-4 col-md-4 col-sm-12 col-xs-12"><div id="%s" class="form-button">%s</div></div></div>',u,n)}var _=sprintf('            <div id="%s_form_left" class="%s">                <label id="%s_form_label" for="%s_input" class="sr-only">%s</label>%s            </div>',e,f,e,e,s,g);$(l).html(_);var h=sprintf('            <div id="%s_form_right" class="col-lg-1 col-md-1 col-sm-1 col-xs-2 text-right padding-left-0">                <div id="%s_status" class="form-input">                    <span id="%s_status_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>                    <a id="%s_status_success" class="icon-arrow-right-circle icon-success"></a>                </div>            </div>',e,e,e,e);if(r){$(l).append(h)}if(o=="textarea"){var m="#"+u;autosize($(m))}}function a(e,i,o,a){const c="#"+o;const l=ingestString(a.name);const d=ingestString(a.title);const f=ingestString(a.type);const v=ingestBoolean(a.status);const u=sprintf("%s_field_%s",i,l);const p=injectLinks(ingestString(a.info));const g=ingestString(a.value);var _={};const h=ingestMap(a.criteria);for(var m in h){_[m]=h[m]}const w=ingestString(a.repeat);if(w){const e=sprintf("#%s_field_%s_input",i,w);const t=sprintf("#%s_field_%s_left_title",i,w);var b=$(t).text();b=b.trim().slice(0,-1);_["identical_to"]={};_.identical_to[e]=sprintf("does not match %s.",b)}const y=deepCopy(_);const x=sprintf("#%s_input",u);const k=sprintf("#%s_status_error",u);const S=sprintf("#%s_status_success",u);if(g=="Reactivate"&&l=="update_status"){n=' style="display: none;"'}var C=sprintf('            <div id="%s_column">                <div id="%s_left" class="col-lg-3 col-md-3 col-sm-3 hidden-xs">                    <div id="%s_left_title" class="form-text auto-height margin-bottom-10">                        %s:                    </div>                </div>                <div id="%s_top" class="hidden-lg hidden-md hidden-sm col-xs-12">                    <div id="%s_left_top" class="form-label bold">                        %s:                    </div>                </div>                <div id="%s_middle" class="col-lg-9 col-md-9 col-sm-9 col-xs-12">                </div>                <div id="%s_bottom" class="col-lg-9 col-lg-offset-3 col-md-9 col-md-offset-3 col-sm-9 col-sm-offset-3 col-xs-12 hidden-bottom"%s>                </div>\t\t\t</div>',u,u,u,d,u,u,d,u,u,n);$(c).append(C);r(u,a);if(p){const e="#"+u+"_bottom";var A=sprintf('<div id="%s_info" class="form-label text-left text-wrap auto-height">%s</div>',u,p);$(e).html(A)}function T(e,t,i){const n={anchor_selector:t,message_text:e,message_status:i,timeout:5e3};showMessage(n)}function D(){}function R(e){function i(e,t,i){var n=["",e,"",t];var o=patchingAccount(...n);o.done(function(){T("Email address update successful.",i,"success");gettingAccount();$(i).val(t)});o.fail(function(e){T(e,x,"error")})}var n={selector:x,value:g,title:"Confirm Update",prompt:"To update the email address for your account, please type your current password.",label:"Current Password",type:"password",callable:i,criteria:t["account_password"],args:[e,x]};inputDialog(n)}function O(e){function n(e,t,i){var n=patchingAccount(t,e);n.done(function(){T("Password update successful.",i,"success")});n.fail(function(e){T(e,x,"error")})}var o={selector:x,value:g,title:"Confirm Update",prompt:"To update the password for your account, please type your current password.",label:"Current Password",type:"password",callable:n,criteria:t["account_password"],args:[e,x]};if(w){o["repeat"]=sprintf("#%s_field_%s_input",i,w)}inputDialog(o)}function j(e){const n=e.toUpperCase().slice(0,1)+e.slice(1);function o(e,t,o){var r=deletingAccount(t,e);r.done(function(){T(n+" successful.",o,"success");const e="#"+i+"_field_account_status_input";const r="#"+i+"_field_update_status_bottom";gettingAccount();if(t=="deactivate"){$(e).text("inactive").removeClass("font-success").addClass("font-error");$(o).text("Reactivate");$(s).hide()}else{$(e).text("active").removeClass("font-error").addClass("font-success");$(o).text("Deactivate");$(s).show()}$(o).off();$(o).on("click",function(e){const t=$(this).text();if(t.indexOf("Deactivate")>-1){j("deactivate")}else{j("reactivate")}})});r.fail(function(e){T(e,x,"error")})}var r={selector:x,value:g,title:"Confirm "+n,prompt:sprintf("To %s your account, please type your current password.",e),label:"Current Password",type:"password",callable:o,criteria:t["account_password"],args:[e,x]};inputDialog(r)}if(l=="email_address"){inputHandler(x,d,y,R,enter_submit=true,auto_save=false);statusButtonHandler(x,k,S,d,y,R)}else if(l=="new_password"){inputHandler(x,d,y,D,enter_submit=false,auto_save=false,hidden_title="Password")}else if(l=="account_password"){inputHandler(x,d,y,O,enter_submit=true,auto_save=false,hidden_title="Password");statusButtonHandler(x,k,S,d,y,O,hidden_title="Password")}else if(l=="update_status"){$(x).on("click",function(e){const t=$(this).text();if(t.indexOf("Deactivate")>-1){j("deactivate")}else{j("reactivate")}})}}var c=sprintf('<div id="%s_content_container" class="container content-container-scroll"></div>',i);toggleView(o,c);var l=sprintf('        <div id="%s_content_row" class="row">            <div id="%s_content_column_index" class="col-sm-3 hidden-xs">                <div id="%s_index_section" class="section-last">                    <div id="%s_index_section_title" class="form-line">                        <div id="%s_index_section_title_text" class="form-text no-wrap bold" title="List of Sections">Sections</div>                    </div>                </div>            </div>            <div id="%s_content_column_main" class="col-sm-9 col-xs-12">                <div id="%s_content_column_main_body">                </div>            </div>        </div>',i,i,i,i,i,i,i);$(o).html(l);for(var d=0;d<e.length;d++){const t=e[d].title;const n=e[d].name;const o=i+"_main_body_"+n;const s=i+"_index_section_"+n+"_link";const r=e[d].description;const c=e[d].fields;const l=o+"_fields";const g="#"+i+"_index_section";var f=sprintf('            <div id="%s_index_section_%s" class="form-line">                <a id="%s" class="form-text no-wrap" title="Go to %s Section">%s</a>            </div>',i,n,s,t,t);$(g).append(f);var v="#"+s;$(v).click(function(){scrollDiv(o)});const _="#"+i+"_content_column_main_body";var u=sprintf('            <div id="%s" class="section-last">                <div id="%s_title" title="%s" class="form-text margin-bottom-10 bold">%s</div>                <div id="%s" class="row"></div>            </div>',o,o,r,t,l);$(_).append(u);for(var p=0;p<c.length;p++){a(n,o,l,c[p])}}const g=i+"_main_body_log";const _=i+"_index_section_log_link";const h="#"+i+"_index_section";const m="#"+i+"_content_column_main_body";var f=sprintf('        <div class="form-line hidden-bottom"%s>            <a id="%s" class="form-text no-wrap" title="Go to Access Log Section">Access Log</a>        </div>',n,_);$(h).append(f);var w="#"+_;var b="#"+g;$(w).click(function(){scrollDiv(b)});var y=sprintf('        <div id="%s" class="section-last hidden-bottom"%s>            <div id="%s_title" title="Access Log" class="form-text margin-bottom-10 bold">Access Log</div>            <div class="row">                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">                    <div id="%s_button" class="form-button">View Records</div>                </div>            </div>        </div>',g,n,g,g);$(m).append(y);var x="#"+g+"_button";$(x).click(function(){openAccess()})}function transformAccess(e){for(var t=0;t<e.length;t++){if(ingestString(e[t].desc)){e[t]["desc"]=capitalizeString(e[t]["desc"])}if(ingestNumber(e[t].dt)){e[t]["date"]=renderEpoch(e[t]["dt"])}var i="";if(ingestString(e[t].city)){i+=e[t].city}if(ingestString(e[t].region)){if(i){i+=", "}i+=e[t].region}if(ingestString(e[t].country)){if(i){i+=", "}i+=e[t].country}if(!i){i="Unknown"}e[t]["location"]=i}return e}function accessView(e,t){const i="access_records";const n="#"+i+"_content_container";const o=sprintf('<div id="%s_content_container" class="container content-container-scroll"></div>',i);toggleView(n,o);const s=i+"_log_table";const r=sprintf('        <div id="%s_content_row" class="row">            <div id="%s_content_column_main" class="col-xs-12">                <div id="%s_content_column_main_body">                    <div id="%s" class="row"></div>                    <div id="%s_paginator" class="invisible">Paginator</div>                </div>            </div>        </div>',i,i,i,s,s);$(n).html(r);const a=[{date:"Date"},{desc:"Description"},{platform:"Platform"},{client:"Client"},{ip:"IP Address"},{location:"Location"}];tableView(s,t,a);function c(t){var i=new $.Deferred;e.find({selector:{dt:{$lt:t.dt}},sort:[{dt:"desc"}],limit:10,use_index:"dt"}).then(function(e){i.resolve(ingestArray(e.docs))}).catch(function(e){logConsole(e);i.resolve([])});return i.promise()}function l(e,t){var i=new $.Deferred;e=transformAccess(e);tableView(s,e,a,t);i.resolve();return i.promise()}const d="#"+s+"_paginator";paginateView(d,t,c,l,10)}function updateConversation(e,t,i=true,n="",o=10){var s=$(e);if(s.length){var r="";if(ingestString(n)){logConsole(n+": "+t);r=sprintf('                <div class="row auto-height">                    <div class="col-xs-10">                        <div class="form-line italic text-wrap">%s: %s</div>                    </div>                </div>',n,t)}else{logConsole("me: "+t);r=sprintf('                <div class="row auto-height">                    <div class="col-xs-2"><div class="form-line">&nbsp;</div></div>                    <div class="col-xs-10">                        <div class="form-line text-right text-wrap italic font-faded">%s</div>                    </div>                </div>',t)}setTimeout(function(){$(r).appendTo(s).hide().fadeIn(600);var e=$("#dialog_chat").offset().top;s.children().each(function(){const t=$(this).offset().top;if(t-e<0){$(this).remove()}else if($("#dialog_chat").is(":visible")){if(t-e<50){$(this).fadeTo(600,.33)}else if(t-e<100){$(this).fadeTo(600,.66)}}})},600)}}function toggleChannels(e,t,i=true){if(!("socket_channels"in window)){window.socket_channels=[]}var n="dialog_chat";var o="#"+n+"_input_box";var s="#"+n+"_submit_box";var r="#"+n+"_message_box";var a="#"+n+"_transcript_box";var c=n+"_input";var l=n+"_submit";var d="#"+c+"_message_text";var f="#"+l+"_message_success";var v="#"+l+"_message_error";var u=sprintf("#footer_navigation_%s_link",t);var p=sprintf("#footer_navigation_%s_box",t);var g=sprintf("#header_navigation_%s_link",t);var _=sprintf("#header_navigation_%s_box",t);function h(){var e=sprintf('            <div id="%s_row" class="row">                <div id="%s_column" class="col-xs-12">                    <form id="%s_form" title="New Message">                        <div id="%s_form_row" class="row">                            <div id="%s_form_left" class="col-xs-12 auto-height">                                <textarea id="%s_message_text" placeholder="type message here..." class="form-input-textarea"></textarea>                            </div>                        </div>                    </form>                </div>            </div>',c,c,c,c,c,c);$(o).html(e);var t=sprintf('            <div id="%s_row" class="row">                <div id="%s_column" class="col-xs-1 text-right">                    <div id="%s_text" class="form-text">                        <span id="%s_message_error" class="icon-ban icon-error icon-overlay" style="display: none;"></span>                        <span id="%s_message_success" class="icon-arrow-right-circle icon-success"></span>                    </div>                </div>            </div>',l,l,l,l,l,l);$(s).html(t);$(d).focus();autosize($(d))}function m(t){if(window.socket_channels.indexOf("message")>-1){e.emit("message",{msg:t,sender:"user"},function(e){if(e==200){updateConversation(r,t)}else{updateConversation(r,t,false)}});$(d).val("");$(d).focus();autosize.update($(d))}}function w(e){$(d).val(e);autosize.update($(d))}function b(t){if(window.socket_channels.indexOf("speech")>-1){e.emit("speech_final",{transcription:t,sender:"user"},function(e){setTimeout(function(){if(e==200){updateConversation(r,t)}else{updateConversation(r,t,false)}},600)})}setTimeout(function(){if(window.socket_channels.indexOf("message")>-1){$(d).val("");autosize.update($(d))}},600)}var y=false;var x=window.socket_channels.indexOf(t);if(x==-1){window.socket_channels.push(t);y=true}else{window.socket_channels.splice(x,1)}if(i){e.emit("channels",{media:window.socket_channels})}if(y){var k="Deactivate "+capitalizeString(t);$(u).addClass("icon-attention");$(u).attr("title",k);$(g).addClass("icon-attention");$(g).attr("title",k);var S=false;for(var C=0;C<window.socket_channels.length;C++){if(window.socket_channels[C]!=t){S=true;const e=sprintf("#footer_navigation_%s_box",window.socket_channels[C]);const t=sprintf("#header_navigation_%s_box",window.socket_channels[C]);$(e).removeClass("burst-effect");$(t).removeClass("burst-effect")}}if(S){var A=setInterval(function(){var e=true;for(var t=0;t<window.socket_channels.length;t++){const i=sprintf("#footer_navigation_%s_box",window.socket_channels[t]);const n=sprintf("#header_navigation_%s_box",window.socket_channels[t]);const o=ingestString($(i).attr("class"));const s=ingestString($(n).attr("class"));if(o.indexOf("burst-effect")>-1||s.indexOf("burst-effect")>-1){e=false;break}}if(e){for(var t=0;t<window.socket_channels.length;t++){const e=sprintf("#footer_navigation_%s_box",window.socket_channels[t]);const i=sprintf("#header_navigation_%s_box",window.socket_channels[t]);$(e).addClass("burst-effect");$(i).addClass("burst-effect")}clearInterval(A)}},50)}else{$(p).addClass("burst-effect");$(_).addClass("burst-effect")}}else{var k="Activate "+capitalizeString(t);$(u).removeClass("icon-attention");$(u).attr("title",k);$(g).removeClass("icon-attention");$(g).attr("title",k);$(p).removeClass("burst-effect");$(_).removeClass("burst-effect")}if(y){if(t=="speech"){startSpeechRecognition(b,w);e.on("speech",function(e){playAudio(e.audio_data,e.content_type,e.volume_level)})}else if(t=="message"){showConversation();if(!$.trim($(o).html())){h();inputHandler(d,"Message",{},m,enter_submit=true,auto_save=false);statusButtonHandler(d,v,f,"Message",{},m)}else{$(d).focus()}e.on("message",function(e){var t=ingestString(e.sender);var i=ingestString(e.msg);updateConversation(r,i,true,t)})}}else{if(t=="speech"){stopSpeechRecognition();e.removeAllListeners("speech");$(d).focus()}else if(t=="message"){hideConversation();$(o).empty();$(s).empty();e.removeAllListeners("message")}}}function conversationView(e,t=null){var i="dialog_chat";var n=["message","speech","video","location"];var o={message:{icon:"icon-bubbles",name:"message",label:"Activate Message",onclick:"toggleChannels",args:[e,"message"]},speech:{icon:"icon-microphone",name:"speech",label:"Activate Speech",onclick:"toggleChannels",args:[e,"speech"]},video:{icon:"icon-camrecorder",name:"video",label:"Video Not Supported"},location:{icon:"icon-location-pin",name:"location",label:"Location Not Supported"}};function s(){var e={links:[]};for(var t=0;t<n.length;t++){e.links.push(o[n[t]])}updateNavigation(e)}var r=["message","speech"];var a=ingestArray(window.socket_channels);var c=[];var l=a.indexOf("transcription");if(l>-1){r.splice(1,1);o["speech"]["label"]="Disabled While Transcription Active";delete o["speech"]["onclick"];delete o["speech"]["args"]}if(ingestArray(t).length){for(var d=0;d<t.length;d++){if(r.indexOf(t[d])>-1){if(a.indexOf(t[d])==-1){c.push(t[d])}}}}s();for(var d=0;d<n.length;d++){const e=o[n[d]]["name"];if(r.indexOf(n[d])==-1){const t=sprintf("#footer_navigation_%s_link",e);const i=sprintf("#header_navigation_%s_link",e);$(t).addClass("hidden-link font-faded");$(i).addClass("hidden-link font-faded")}}for(var d=0;d<c.length;d++){if(d+1<c.length){toggleChannels(e,c[d],emit_update=false)}else{toggleChannels(e,c[d])}}}function openLab(){console.log("Opening lab.");openDashboard()}function openAuthentication(){console.log("Opening authentication.");openLogin()}function openDashboard(){openTranscription()}function openLogin(){function e(){showTitle(center_desktop=true);$("#landing_middle_row").removeClass("row").addClass("col-xs-12");var e="#landing_middle_column";var t='<div id="input_box" title="Login" class="form-line text-left"></div>';$(e).append(t);loginView()}if($("#landing_box").length){setTimeout(function(){$("#landing_box").remove();e()},600)}else{var t='        <div id="landing_container" class="content-container-fill">            <div id="landing_row" class="row height-100">                <div id="landing_left" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>                <div id="landing_middle" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 height-100">                    <div id="landing_middle_row" class="row vertical-center">                        <div id="landing_middle_column" class="col-lg-12 col-md-12 col-sm-12 col-xs-12"></div>                    </div>                </div>                <div id="landing_right" class="col-lg-4 col-md-4 col-sm-3 hidden-xs"></div>            </div>        </div>';$("#content").html(t);e()}}function openUpdate(e,t){hideLanding();showTitle(center_desktop=true);contentMiddle();$("#content_middle_row").removeClass("row").addClass("col-xs-12");var i="#content_middle_column";var n='<div id="input_box" title="Login" class="form-line text-left"></div>';$(i).append(n);updateView(e,t)}function openReport(e){hideLanding();showTitle(center_desktop=true);contentMiddle();$("#content_middle_row").removeClass("row").addClass("col-xs-12");var t="#content_middle_column";var i='<div id="input_box" title="Login" class="form-line text-left"></div>';$(t).append(i);reportView(e)}function openOAuth2Callback(e){console.log("Opening callback.");updateHistory(openOAuth2Callback,[e]);var t=loadingService(e);function i(e){hideLanding();showTitle(center_desktop=true);contentMiddle();$("#content_middle_row").removeClass("row").addClass("col-xs-12");var t="#content_middle_column";var i=sprintf('            <div id="logo_box" title="%s" class="col-xs-12 text-center">                <img src="%s" class="icon-mega margin-bottom-10">            </div>',e["service_title"],e["service_logo"]);$(t).append(i);var n=sprintf('<div id="input_box" title="%s" class="form-line text-left"></div>',e["service_title"]);$(t).append(n);oauth2CallbackView(e)}t.done(i)}function openIntegrations(e=""){console.log("Opening integrations.");updateHistory(openIntegrations,[e]);function t(t,i,n,o){var s={app_title:window.app_title,app_subtitle:"Service Integrations",page_title:"Service Integrations",page_label:"Manage Integrations with Existing Services"};updateTitle(s);showDashboard();integrationsView(t,i,n,o);scrollDiv(e)}function i(e,t){var i=new $.Deferred;e.find({selector:{service_name:{$gt:null}},use_index:"service_name"}).then(function(n){var o={};for(var s=0;s<n.docs.length;s++){const t=n.docs[s];const i=t["service_name"];if(i in o){e.remove(t)}else{o[i]=t}}function r(t,i){var n=new $.Deferred;var o=renewingOAuthToken(t);o.done(function(e){n.resolve(e)});o.fail(function(o){e.remove(i).then(function(){n.resolve({service_name:t})})});return n.promise()}var a=[];for(var c in o){const e=o[c].expires_at;if(e&&e<$.now()/1e3){const e=c;const t=o[c];a.push(r(e,t))}}if(a.length){$.when(...a).then(function(){const n=arguments;e.replicate.from(t).then(function(e){for(var t=0;t<n.length;t++){const e=n[t].service_name;if("access_token"in n[t]){o[e]=n[t]}else{delete o[e]}}i.resolve(o)}).catch(function(e){logConsole(JSON.stringify(e));for(var t=0;t<n.length;t++){const e=n[t].service_name;if("access_token"in n[t]){o[e]=n[t]}else{delete o[e]}}i.resolve(o)})})}else{i.resolve(o)}});return i.promise()}loadingBucket("oauth2_tokens").then(function(e){var n=window.pouch_db["oauth2_tokens_remote"];var o=i(e,n);var s=loadingServices();var r=loadingSchema("lab_experiments");var a=loadingSchema("lab_scopes");$.when(s,r,a,o).then(function(i,o,s,r){var a={};for(var c in o){for(var l=0;l<o[c]["integrations"].length;l++){const e=o[c]["integrations"][l];for(var d=0;d<e["scopes"].length;d++){const t=e["scopes"][d];if(!(t in a)){a[t]=[]}const i={title:o[c]["title"],name:o[c]["name"],type:o[c]["type"],enabled:o[c]["enabled"],logo:o[c]["logo"],url:o[c]["url"],added:o[c]["added"]};a[t].push(i)}}}for(var c in a){a[c].sort(function(e,t){return t.added-e.added})}var f=[];for(var c in s){var v={scope:c,experiments:a[c]};for(var u in s[c]){v[u]=s[c][u]}f.push(v)}f.sort(function(e,t){if(e.scope>t.scope){return 1}if(e.scope<t.scope){return-1}return 0});var p={};for(var l=0;l<f.length;l++){const e=f[l]["service"];if(!(e in p)){p[e]=[]}p[e].push(f[l])}for(var c in s){const e=s[c]["service"];if(e in i&&e in p){i[e]["service_scopes"]=p[e]}}t(e,n,i,r)})})}function openPreferences(e=""){console.log("Opening preferences.");updateHistory(openPreferences,[e]);function t(t,i,n,o){var s="user_preferences";var r=ingestMap(o);var a=ingestArray(n);for(var c=0;c<a.length;c++){var l=a[c].section_name;if(l in r){var d=a[c].section_fields;for(var f=0;f<d.length;f++){var v=d[f].field_name;if(v in r[l]){var u=r[l][v];a[c].section_fields[f].field_value=u}}}}var p={app_title:window.app_title,app_subtitle:"User Preferences",page_title:"User Preferences",page_label:"Update Preferences for Laboratory Account"};updateTitle(p);showDashboard();settingsView(s,t,i,o._id,a);scrollDiv(e)}loadingBucket("user_preferences").then(function(e){var i=window.pouch_db["user_preferences_remote"];var n=loadingSchema("lab_preferences");var o=e.allDocs({include_docs:true});$.when(n,o).then(function(n,o){if(!o.rows.length){const i=loadRecord("gateway_auth");var s={uid:i.uid,dt:$.now()/1e3,laboratory_settings:{research_level:"beta"}};e.post(s).then(function(i){s["_id"]=i["id"];s["_rev"]=i["rev"];t(e,n,s)})}else{var s=o.rows[0].doc;t(e,i,n,s)}})})}function openAccount(e=""){console.log("Opening account.");updateHistory(openAccount,[e]);var t=loadingSchema("lab_accounts");var i=loadingSchema("lab_criteria");var n=gettingAccount();$.when(t,i,n).then(function(t,i,n){var o=ingestMap(n);for(var s=0;s<t.length;s++){var r=t[s].name;if(r in o){var a=t[s].fields;for(var c=0;c<a.length;c++){var l=a[c].name;if(l in o[r]){var d=o[r][l];t[s].fields[c].value=d;if(l=="email_address"){t[s].fields[c].placeholder=d}else if(l=="account_status"){if(d=="inactive"){t[s].fields[2].value="Reactivate";t[s].fields[c].color="font-error"}}}if(l in i){t[s].fields[c].criteria=deepCopy(i[l])}}}}var f={app_title:window.app_title,app_subtitle:"Account Settings",page_title:"Account Settings",page_label:"Update Settings for Laboratory Account"};updateTitle(f);showDashboard();accountView(t,i);scrollDiv(e)})}function openAccess(e=""){console.log("Opening access.");updateHistory(openAccess,[e]);function t(t,i){var n={app_title:window.app_title,app_subtitle:"Access Records",page_title:"Access Records",page_label:"Account Access Logs"};updateTitle(n);showDashboard();accessView(t,i);scrollDiv(e)}loadingBucket("access_records").then(function(e){e.find({selector:{dt:{$gt:null}},sort:[{dt:"desc"}],limit:10,use_index:"dt"}).then(function(i){var n=ingestArray(i.docs);n=transformAccess(n);t(e,n)})})}function openConversation(e=""){var t=[];if(ingestString(e)){t=e.split(" ")}var i=handlingSocket(window.server_url);function n(e){if(!$("#header_navigation_message_link").length){conversationView(e,t)}else if(!$("#dialog_chat").is(":visible")){$("#dialog_chat").show()}}$.when(i).then(n)}function signOut(){console.log("Signing out.");var e={};updateTitle(e);const t="#header_right_desktop";const i="#ooter_verified_mobile";$(t).empty();$(i).empty();$("#header_right_mobile").empty();$("#dialog_options_buttons").empty();$("#dialog_chat_message_box").empty();$("#dialog_chat_input_box").empty();$("#dialog_chat_submit_box").empty();hideConversation();hideDashboard();landingView();if("speech_recognition_client"in window){stopSpeechRecognition()}if("speech_transcription_client"in window){stopSpeechTranscription()}if("pouch_db"in window){stoppingPouch(window.pouch_db)}if("socket_client"in window){disconnectClient()}if("map_object"in window){delete window.map_object;window.map_markers=[];$("#google_map_script").remove()}clearRecords();gettingSession();window.client_history=[];window.client_fingerprint={};if("client_listeners"in window){for(var n in window.client_listeners){try{clearInterval(window.client_listeners[n])}catch(e){}}}window.client_listeners={};initializeFingerprint()}
/**
* DATA JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requirements:
* jquery
* lab.js
* pouchdb (https://pouchdb.com/)
* modernizr (https://modernizr.com/) 
* * localstorage
**/function upsertValues(e,t){var i=null;e=deepCopy(ingestMap(e));if(!mapSize(e)){i=deepCopy(e)}else{i=ingestMap(t);for(key in e){if(!mapSize(ingestMap(e[key]))){i[key]=e[key]}else{if(!(key in i)){i[key]={}}for(k in e[key]){i[key][k]=e[key][k]}}}}return i}function saveRecord(e,t,i=null,n=true,o=null){if(!("client_records"in window)){window.client_records={}}var s=null;var r=e+"_record_timestamp";var a=ingestMap(i);if(mapSize(a)){s=a}else{s=ingestNumber(i);if(!s){s=$.now()/1e3}}if(n){if(Modernizr.localstorage){var c=JSON.stringify({value:t});var l=JSON.stringify({value:s});localStorage.setItem(e,c);localStorage.setItem(r,l);logConsole(e+" record saved in Local Storage.")}else{window.client_records[e]=t;window.client_records[r]=s;logConsole(e+" record saved in Window.")}if(o){callFunction(o,[t])}return t}else{var d=loadRecord(e);var f=upsertValues(t,d);if(Modernizr.localstorage){var c=JSON.stringify({value:f});var l=JSON.stringify({value:s});localStorage.setItem(e,c);localStorage.setItem(r,l);logConsole(e+" record updated in Local Storage.")}else{window.client_records[e]=f;window.client_records[r]=s;logConsole(e+" record updated in Window.")}if(o){callFunction(o,[f])}return f}}function loadRecord(e,t=null){if(!("client_records"in window)){window.client_records={}}if(Modernizr.localstorage){var i=localStorage.getItem(e);try{i=JSON.parse(i);var n=i.value}catch(e){var n=null}}else{var n=window.client_records[e]}if(t){callFunction(t,[n])}return n}function deleteRecord(e,t=0){if(!("client_records"in window)){window.client_records={}}var i=e+"_record_timestamp";if(Modernizr.localstorage){localStorage.removeItem(e);if(!t){localStorage.removeItem(i)}else{var n=JSON.stringify({value:t});localStorage.setItem(i,n)}logConsole(e+" record deleted from Local Storage.")}else if(e in window.client_records){delete window.client_records[e];if(!t){delete window.client_records[i]}else{window.client_records[i]=t}logConsole(e+" record deleted from Window.")}}function cleanRecord(e){var t=e+"_record_timestamp";if(loadRecord(t)){if(!loadRecord(e)){if(Modernizr.localstorage){localStorage.removeItem(t);logConsole("Deletion marker for "+e+" removed from Local Storage.")}else{delete window.client_records[t];logConsole("Deletion marker for "+e+" removed from Window.")}}}}function clearRecords(){if(Modernizr.localstorage){for(var e=0;e<localStorage.length;++e){var t=localStorage.key(e);localStorage.removeItem(t)}logConsole("All records deleted from Local Storage.")}else{window.client_records={};logConsole("All records deleted from Window")}}function startingPouchDB(e=true,t=false){var i=$.Deferred();if(!("pouch_db"in window)){window.pouch_db={}}if(!("pouch_index"in window)){window.pouch_index={}}if(!("pouch_ddoc"in window)){window.pouch_ddoc={}}var n=ingestMap(loadRecord("gateway_auth"));var o=ingestString(window.gateway_url);var s=ingestString(n.uid);var r=ingestString(n.password);var a=initializingPouch(window.pouch_db,o,s,r);a.done(function(){var e=indexingPouch(window.pouch_db,window.pouch_index,window.pouch_ddoc);$.when(e).then(function(){i.resolve()})});return i.promise()}function initializingPouch(e,t,i="",n=""){var o=$.Deferred();var s=t;if(i){const e="://"+i+":"+n+"@";s=t.replace(/(:\/\/)/g,e)}var r={};var a={ajax:{cache:false,timeout:12e3,crossDomain:true},skip_setup:true};var c=[];for(var l in ingestMap(e)){if(!l.match(/_remote$/)&&!l.match(/_handler$/)){const t=l;const i=s+"/"+l;const n=l+"_remote";if(!e[t]){try{e[t]=new PouchDB(t,r);logConsole(l+" db created")}catch(i){logConsole(i);if(JSON.stringify(i).indexOf("idb")>-1){r["adapter"]="websql";e[t]=new PouchDB(t,r);logConsole(l+" db created")}else{throw i}}e[n]=new PouchDB(i,a)}}}if(c.length){$.when(...c).then(function(){o.resolve(e)})}else{o.resolve(e)}return o.promise()}function syncingPouch(e,t,i="",n="",o=false){var s=new $.Deferred;var r=t;if(i){const e="://"+i+":"+n+"@";r=t.replace(/(:\/\/)/g,e)}var a={live:true,retry:true};var c=[];for(var l in ingestMap(e)){if(!l.match(/_remote$/)&&!l.match(/_handler$/)){const t=l;const i=r+"/"+l;const n=l+"_remote";const s=l+"_handler";const f="pouch_sync_"+l+"_handler";const v=l+" syncing canceled";const u=l+" sync started";const p=l+" syncing started";const g=l+" sync restarted";const _=l+" sync complete";function d(t,i){var n=new $.Deferred;t.on("complete",function(t){delete e[i];n.resolve();logConsole(_)});return n.promise()}if(!ingestString(localStorage.getItem(f))){if(o){e[s]=PouchDB.sync(t,i,a);e[s].on("complete",function(t){delete e[s];logConsole(v)}).on("error",function(t){delete e[s];logConsole(t)}).on("change",function(e){logConsole("change");logConsole(e)}).on("paused",function(e){}).on("active",function(){});logConsole(p)}else{e[s]=PouchDB.sync(t,i);c.push(d(e[s],s));logConsole(u)}}}}if(c.length){$.when(...c).then(function(){s.resolve(e)})}else{s.resolve(e)}return s.promise()}function indexingPouch(e,t,i=null){var n=new $.Deferred;var o=[];for(var s in t){if(s in e){const i=ingestArray(t[s]);for(var r=0;r<i.length;r++){const t=ingestMap(i[r]);const n=s;if(mapSize(t)){o.push(e[n].createIndex(t));logConsole(n+" index created")}}}}if(i){for(var a in i){if(a in e){const t=ingestArray(i[a]);for(var c=0;c<t.length;c++){const i=ingestMap(t[c]);const n=a;if(mapSize(i)){function l(){var t=new $.Deferred;e[n].put(i).catch(function(e){if(e.name!=="conflict"){throw e}t.resolve()}).then(function(){t.resolve();logConsole(n+" ddoc created")});return t.promise()}o.push(l())}}}}}if(!o.length){n.resolve()}else{$.when(...o).then(function(){n.resolve()})}return n.promise()}function stoppingPouch(e,t=null){var i=new $.Deferred;function n(t){var i=new $.Deferred;if(t.length){const o=t.pop();e[o.local].sync(e[o.remote]).then(function(){logConsole(o.local+" sync complete");n(t).done(function(){i.resolve()}).fail(function(e){i.reject(e)})}).catch(function(e){i.reject(e)})}else{i.resolve()}return i.promise()}function o(){var t=new $.Deferred;var i=[];var o=[];for(var s in ingestMap(e)){if(!s.match(/_handler$/)&&!s.match(/_remote$/)){const t=s+"_remote";if(t in e){o.push({local:s,remote:t})}}}if(o.length){n(o).done(function(){t.resolve()}).fail(function(e){t.reject(e)})}else{t.resolve()}return t.promise()}var s=o();s.done(function(){var t=[];var n=[];for(var o in ingestMap(e)){if(o.match(/_handler$/)){t.push(e[o].cancel())}else if(o.match(/_remote$/)){n.push(o)}else{n.push(o)}}if(t.length){$.when(...t).then(function(){var t=[];for(var o=0;o<n.length;o++){const i=n[o];try{if(i.match(/_handler$/)||i.match(/_remote$/)){t.push(e[i].close())}else{t.push(e[i].destroy())}}catch(e){logConsole(e)}}if(t.length){$.when(...t).then(function(){for(var t in e){if(!t.match(/_remote$/)&&!t.match(/_handler$/)){logConsole(t+" destroyed")}e[t]=null}i.resolve(n)})}else{i.resolve([])}})}else{var s=[];for(var r=0;r<n.length;r++){const t=n[r];try{if(t.match(/_handler$/)||t.match(/_remote$/)){s.push(e[t].close())}else{s.push(e[t].destroy())}}catch(e){logConsole(e)}}if(s.length){$.when(...s).then(function(){for(var t in e){if(!t.match(/_remote$/)&&!t.match(/_handler$/)){logConsole(t+" destroyed")}e[t]=null}i.resolve(n)})}else{i.resolve([])}}});s.fail(function(e){if(t){t(e)}});return i.promise()}function stoppingPouchSync(e){var t=new $.Deferred;var i=[];for(var n in ingestMap(e)){if(n.match(/_handler$/)){if(e[n]){i.push(e[n].cancel())}}}if(i.length){$.when(...i).then(function(){t.resolve()})}else{t.resolve()}return t.promise()}function searchingPouchRevs(e,t,i){function n(e,t,i,o){var s=new $.Deferred;if(o.length){const i=o.pop();e.get(t,{rev:i}).done(function(e){if(e.dt<=dt){s.resolve(e)}else{n(t,dt,o).done(function(e){s.resolve(e)})}}).catch(function(e){s.reject(e)})}else{s.reject()}return s.promise()}var o=[];for(var s=0;s<rev_results._revs_info.length;s++){o=rev_results._revs_info[s].rev}}function saveItem(e,t,i,n=0,o=true,s=null){var r="saveItem";if(!("client_records"in window)){window.client_records={}}if(!ingestString(e)){throw r+'(table_key="") value must be a string.'}else if(!ingestString(t)){throw r+'(item_key="...") value must be a string.'}else if(!isMap(i)){throw r+"item_details={...}) value must be a map."}var a=$.now()/1e3;if(ingestNumber(n)){a=n}if(Modernizr.localstorage){var c=localStorage.getItem(e);try{c=JSON.parse(c);var l=c.value}catch(e){var l={}}}else{var l=window.client_records[e];if(typeof l=="undefined"){var l={}}}var d=" updated in ";if(!(t in l)){d=" added to ";l[t]={dt:a,item:i}}else if(o){d=" overwritten in ";l[t]={dt:a,item:i}}else{l[t]={dt:a,item:upsertValues(i,l[t].item)}}if(Modernizr.localstorage){var f=JSON.stringify({value:l});localStorage.setItem(e,f);logConsole("Item "+t+d+e+" on Local Storage.")}else{window.client_records[e]=l;logConsole("Item "+t+d+e+" in window.")}var v={key:t,item:i,dt:a};if(s){callFunction(s,[v])}return v}function loadItem(e,t,i=null){var n="loadItem";if(!("client_records"in window)){window.client_records={}}if(!ingestString(e)){throw n+'(table_key="") value must be a string.'}else if(!ingestString(t)){throw n+'(item_key="...") value must be a string.'}if(Modernizr.localstorage){var o=localStorage.getItem(e);try{o=JSON.parse(o);var s=o.value}catch(e){var s={}}}else{var s=window.client_records[e];if(typeof s=="undefined"){var s={}}}var r=null;if(!(t in s)){throw n+'(item_key="'+t+'") does not exist in table '+e+"."}else{var a=s[t];r={key:t,item:a.item,dt:a.dt}}if(i){callFunction(i,[r])}return r}function listItems(e,t=null,i=null,n=0,o=null){var s="listItems";if(!("client_records"in window)){window.client_records={}}if(!ingestString(e)){throw s+'(table_key="") value must be a string.'}n=ingestNumber(n);t=ingestArray(t);if(Modernizr.localstorage){var r=localStorage.getItem(e);try{r=JSON.parse(r);var a=r.value}catch(e){var a={}}}else{var a=window.client_records[e];if(typeof a=="undefined"){var a={}}}var c=[];var l=$.map(a,function(e,t){return t});l.sort();var d=e+"_item_metadata_"+$.now().toString();for(var f=0;f<l.length;f++){var v=l[f];var u=a[v].item;u[d]={key:v,dt:a[v].dt};c.push(u)}if(t.length){c=sortArray(c,t)}var p=filterArray(c,i,n);var g=[];for(var f=0;f<p.length;f++){g.push(p[f][d].key)}if(o){callFunction(o,[g])}return g}function deleteItem(e,t,i=0,n=null){var o="deleteItem";if(!("client_records"in window)){window.client_records={}}if(!ingestString(e)){throw o+'(table_key="") value must be a string.'}else if(!ingestString(t)){throw o+'(item_key="...") value must be a string.'}if(Modernizr.localstorage){var s=localStorage.getItem(e);try{s=JSON.parse(s);var r=s.value}catch(e){var r={}}}else{var r=window.client_records[e];if(typeof r=="undefined"){var r={}}}if(ingestNumber(i)){var a=e+"_deletion_markers";if(Modernizr.localstorage){var s=localStorage.getItem(a);try{s=JSON.parse(s);var c=s.value}catch(e){var c={}}}else{var c=window.client_records[a];if(typeof c=="undefined"){var c={}}}}var l=false;if(t in r){delete r[t];l=true;if(Modernizr.localstorage){var d=JSON.stringify({value:r});localStorage.setItem(e,d);logConsole("Item "+t+" deleted from "+e+" on Local Storage.")}else{window.client_records[e]=r;logConsole("Item "+t+" deleted from "+e+" in window.")}if(ingestNumber(i)){c[t]=i;if(Modernizr.localstorage){var d=JSON.stringify({value:c});localStorage.setItem(a,d)}else{window.client_records[a]=c}}}if(n){callFunction(n,[l])}return l}
/**
* FORMS JAVASCRIPT EXTENSION
* @author rcj1492
* @license ©2016-2018 Collective Acuity
* @email support@collectiveacuity.com
*
* requires: 
* jquery
* lab.js
**/function showMessage(e){var t={anchor_selector:"#header_middle",message_text:"Status Message",message_html:"",message_status:"success",message_location:"bottom",timeout:0};unpackKwargs(e,t,"showMessage");var i=t.anchor_selector;var n=t.message_text;var o=t.message_status;var s=t.message_location;var r=t.message_html;var a=t.timeout;var c=$(i).offset();var l=$(i).width();var d=$(i).height();var f=$("html, body").scrollTop();var v="dialog_status_message_"+i.replace("#","").toLowerCase();var u="#"+v;if($(u).length){$(u).remove()}var p='<div id="'+v+'" style="display: none;"></div>';var g=["dialog-tooltip","padding-vertical-5","padding-horizontal-5","font-mini","text-wrap"];if(o=="success"){g.push("font-success")}else if(o=="error"){g.push("font-error")}if(r){g.push("page-tooltip")}else{g.push("page-status-message")}var _=g.join(" ");$("body").append(p);var h=$(u);h.addClass(_);if(r){h.html(r)}else{h.text(n)}if(s=="bottom"){var m=h.width();var w=h.css("padding-top");var w=parseFloat(w.replace(/[^-\d\.]/g,""));var b=c.top+d+w-f;var y=c.left+l/2-m/2}else if(s=="top"){var m=h.width();var x=h.height();var k=h.css("padding-bottom");var k=parseFloat(k.replace(/[^-\d\.]/g,""));var b=c.top-x-k*3-f;var y=c.left+l/2-m/2}else if(s=="right"){var w=h.css("padding-top");var w=parseFloat(w.replace(/[^-\d\.]/g,""));var S=h.css("padding-right");var S=parseFloat(S.replace(/[^-\d\.]/g,""));var b=c.top-w-f;var y=c.left+l+S}else if(s=="left"){var m=h.width();var w=h.css("padding-top");var w=parseFloat(w.replace(/[^-\d\.]/g,""));var S=h.css("padding-right");var S=parseFloat(S.replace(/[^-\d\.]/g,""));var b=c.top-w-f;var y=c.left-m-S*2.5}else{var m=h.width();var w=h.css("padding-top");var w=parseFloat(w.replace(/[^-\d\.]/g,""));var b=c.top-w;var y=c.left+l/2-m/2}var C=$(window).width();if(y<0){y=0}if(y+m>C){y=C-m}h.css({top:b,left:y});if(a){setTimeout(function(){h.fadeOut()},a)}h.fadeIn()}function hideMessage(e){var t="#dialog_status_message_"+e.replace("#","").toLowerCase();$(t).hide()}function inputValidator(e,t){var i=ingestMap(t.must_contain);var n=ingestMap(t.must_not_contain);var o=ingestMap(t.identical_to);var s=ingestMap(t.equal_to);var r=ingestNumber(t.max_length);var a="";var c="";for(var l in i){var d=new RegExp(l,"i");if(!d.test(e)){a=i[l];break}}for(var l in o){if(!$(l).length){logConsole(l+" is not a valid selector.")}else if($(l).val()!=e){a=o[l];break}}for(var l in s){if(l!=e){a=s[l];break}}for(var l in n){var d=new RegExp(l,"i");if(d.test(e)){c=n[l];break}}if(r){if(e.length>r){c="contain contain more than "+r.toString()+" characters."}}return{required:a,prohibited:c}}function submitValidator(e,t,i,n,o=""){var s=inputValidator(e,i);var r={anchor_selector:n,message_text:"Status Message",message_status:"error",message_location:"bottom"};if(s.prohibited){var a="Oops! ";if(!t){a+="Input "}else if(o){a+=o+" "+s.required}else{a+=t+" "}a+=s.prohibited;r.message_text=a;showMessage(r);return null}else if(s.required){var a="Errr! ";if(!e){a+=t+" cannot be empty."}else if(o){a+=o+" "+s.required}else{a+='"'+e+'" '+s.required}r.message_text=a;showMessage(r);return null}else{return e}}function inputHandler(e,t,i,n,o=true,s=true,r=""){$(e).keypress(function(e){var t=e.keyCode;if(t===10||t===13){e.preventDefault()}});$(e).keyup(function(s){var a=s.keyCode;if($(this).get(0).isContentEditable){var c=$(this).text()}else{var c=$(this).val()}var l=inputValidator(c,i);var d={anchor_selector:e,message_text:"Status Message",message_status:"error",message_location:"bottom"};if(l.prohibited){var f="Oops! ";if(!t){f+="Input "}else{f+=t+" "}f+=l.prohibited;d.message_text=f;showMessage(d)}else if((a==10||a==13)&&o){if(l.required){var f="Errr! ";if(!c){f+=t+" cannot be empty."}else if(r){f+=r+" "+l.required}else{f+='"'+c+'" '+l.required}d.message_text=f;showMessage(d)}else{n(c)}}else{hideMessage(e)}});if(s){$(e).focusout(function(o){if($(this).get(0).isContentEditable){var s=$(this).text()}else{var s=$(this).val()}var a=submitValidator(s,t,i,e,r);if(a===null){}else{n(a)}})}}function statusIconHandler(e,t,i){$(e).keyup(function(){if($(this).get(0).isContentEditable){var e=$(this).text()}else{var e=$(this).val()}console.log(e);var n=inputValidator(e,i);if(e==""){$(t).hide()}else if(n.required||n.prohibited){$(t).show()}else{$(t).hide()}})}function statusButtonHandler(e,t,i,n,o,s,r=""){function a(){$(i).click(function(){var t=$(e).val();var i=submitValidator(t,n,o,e,r);if(i===null){}else{s(i)}})}$(e).keyup(function(e){if($(this).get(0).isContentEditable){var n=$(this).text()}else{var n=$(this).val()}var s="a";if($(i).length){s=$(i)[0].tagName.toLowerCase()}var r=inputValidator(n,o);if(n==""){$(t).hide();if(s=="span"){convertElement(i,"a");a()}}else if(r.required||r.prohibited){$(t).show();if(s=="a"){convertElement(i,"span")}}else{$(t).hide();if(s=="span"){convertElement(i,"a");a()}}});a()}function successMessage(e,t,i){try{var n=JSON.parse(e)}catch(e){var n={}}var o=n.status;var s=n.message;var r=n.status;var a="<p>"+n.message+"</p>";if(typeof t==="string"){if(typeof i!="string"){var i=""}showMessage(t,s,o,i,2e3)}else{$("#dialog_middle_center_header_title").text(r);$("#dialog_middle_center_content_middle").html(a);openDialog("#dialog_middle_center")}}function errorMessage(e,t,i,n){var o=e.status;try{var s=JSON.parse(e.responseText)}catch(e){var s={}}var r="Errr! ";if(o===0){r+="No connection. Check network settings."}else if(o==404){r+="Page not found. [404]"}else if(o==500){r+="Internal Server Error [500]."}else if(t==="timeout"){r+="Request timeout."}else if(t==="abort"){r+="Request aborted."}if(typeof s.status==="string"){var a=s.status;var c=s.status}else{var a="error";var c=o}if(typeof s.message==="string"){var r=s.message;var l="<p>"+s.message+"</p>"}else{var l="<p>"+r+"</p>"}if(typeof i==="string"){if(typeof n!="string"){var n=""}showMessage(i,r,a,n)}else{$("#dialog_middle_center_header_title").text(c);$("#dialog_middle_center_content_middle").html(l);openDialog("#dialog_middle_center")}}function waitMessage(e,t,i,n){if(typeof i==="undefined"){var i=""}if(typeof n==="undefined"){var n="overlay"}var o="dialog_status_message_"+e.replace("#","").toLowerCase();var s="#"+o;var r=new String(t);var a=t.length;for(var c=0;c+a<a*2;c++){r+="&nbsp;"}showMessage(e,r,i,n);function l(e){var t=e.length;var i=new String(e);var n=$(s);function o(s){if(!(s%t)){i=new String(e)}else{i+="."}var r=new String(i);var a=i.length;for(var c=0;c+a<t*2;c++){r+="&nbsp;"}n.html(r);setTimeout(function(){if(n.is(":visible")){o(++s)}},125)}o(0)}l(t)}
/**
* STACKOVERFLOW JAVASCRIPT EXTENSION
* @license https://creativecommons.org/licenses/by-sa/2.5/
*
* VisibilityListener
* @source https://stackoverflow.com/a/1060034/4941585
* @author community wiki
*
* BrowserDetect
* @source https://stackoverflow.com/a/13480430/4941585
* @author https://stackoverflow.com/users/1582029/code-uniquely
*
* syntaxHighlight
* @source https://stackoverflow.com/a/7220510/4941585
* @author https://stackoverflow.com/users/27862/user123444555621
**/function VisibilityListener(e=null){var t="hidden";if(t in document){document.addEventListener("visibilitychange",i)}else if((t="mozHidden")in document){document.addEventListener("mozvisibilitychange",i)}else if((t="webkitHidden")in document){document.addEventListener("webkitvisibilitychange",i)}else if((t="msHidden")in document){document.addEventListener("msvisibilitychange",i)}else if("onfocusin"in document){document.onfocusin=document.onfocusout=i}else{window.onpageshow=window.onpagehide=window.onfocus=window.onblur=i}function i(i){var n="visible";var o="hidden";var s={focus:n,focusin:n,pageshow:n,blur:o,focusout:o,pagehide:o};i=i||window.event;if(i.type in s){document.body.className=s[i.type]}else{document.body.className=this[t]?"hidden":"visible"}if(e){e(document.body.className)}}if(document[t]!==undefined){i({type:document[t]?"blur":"focus"})}}var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string;this.versionSearchString=e[t].subString;if(i.indexOf(e[t].subString)!==-1){return e[t].identity}}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t===-1){return}var i=e.indexOf("rv:");if(this.versionSearchString==="Trident"&&i!==-1){return parseFloat(e.substring(i+3))}else{return parseFloat(e.substring(t+this.versionSearchString.length+1))}},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"MS Edge"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"},{string:navigator.userAgent,subString:"OPR",identity:"Opera"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"}]};function syntaxHighlight(e){if(typeof e!="string"){e=JSON.stringify(e,undefined,2)}e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";if(/^"/.test(e)){if(/:$/.test(e)){t="key"}else{t="string"}}else if(/true|false/.test(e)){t="boolean"}else if(/null/.test(e)){t="null"}return'<span class="'+t+'">'+e+"</span>"})}