/**
* VIEWS JAVASCRIPT EXTENSION
* @author rcj1492
* @license Â©2017-2018 Collective Acuity
* @email support@collectiveacuity.com
* 
* requires: 
* jquery.js
* sprintf.js
* stackoverflow.js
* autosize.js
* lab.js
**/
function registerHandler(e,t){var i;var o;$(e).keypress(function(e){i=e.keyCode;if(i===10||i===13){e.preventDefault()}});$(e).keyup(function(e){i=e.keyCode;if($(this).get(0).isContentEditable){o=$(this).text()}else{o=$(this).val()}if(i==10||i==13){t(o)}});$(e).focusout(function(e){if($(this).get(0).isContentEditable){o=$(this).text()}else{o=$(this).val()}t(o)})}function requestingResource(e){var t=new $.Deferred;function i(e){logConsole("Request Successful.");window.device_online=true;t.resolve(e)}function o(e,i){const o=errorConstructor(e,i);t.reject(o)}function n(){console.log("Waiting...")}var a=ingestString(e.route);var s=ingestMap(e.params);var r=window.server_url+a;if(mapSize(s)){r+="?";r+=$.param(s)}var l=ingestString(e.method);var c={method:l,timeout:12e3,crossDomain:true,headers:{},url:r,contentType:"application/json",success:i,error:o};if(isFunction(e.success)){c.success=e.success}if(isFunction(e.error)){c.error=e.error}var d=ingestMap(e.body);if(mapSize(d)&&l!="GET"){c.data=JSON.stringify(d)}var v=ingestMap(e.headers);for(var u in v){c.headers[u]=v[u]}$.ajax(c);if(isFunction(e.wait)){e.wait()}else{n()}return t.promise()}function errorDialog(e){var t="";var i="";var o={invalid:new RegExp(/Access token is invalid/g),missing:new RegExp(/Access token is missing/g)};if(o.missing.test(e)){t="Token Missing";i='To access this content, an access token is required. You can register your access token, using the "Register Token" button in the menu panel.';openBlank()}else if(o.invalid.test(e)){t="Token Invalid";i="The access token you have registered is not a valid token on record. Please double-check the value you have entered.";openBlank()}else{t="Request Error";i=e}const n=sprintf('        <div class="col-xs-12 margin-vertical-10">            <div class="form-text auto-height text-wrap">%s</div>        </div>',i);var a={title:t,body:n};flexibleDialog(a)}function registerDialog(){var e=ingestString(localStorage.getItem("access_token"));var t="";if(e){t=' value="'+e+'"'}const i=sprintf('        <div class="form-line text-left">            <div class="col-xs-12 margin-bottom-10">                <div class="form-text auto-height text-wrap">Policy Address:</div>            </div>            <div class="col-xs-12 margin-bottom-5">                <form title="Policy Address">                    <div class="row">                        <div class="col-xs-12">                            <label for="access_token_input" class="sr-only">Policy Address</label>                            <input id="access_token_input" type="text" autofocus class="form-input"%s>                        </div>                    </div>                </form>            </div>        </div>',t);var o={title:"Update Address",body:i};flexibleDialog(o);const n="#dialog_backdrop";const a="#access_token_input";function s(e){localStorage.setItem("access_token",e);openBlank();$(n).click()}registerHandler(a,s);autofocusEnd(a)}function updateTitle(e){var t={schema:{app_title:"Baseline",app_subtitle:"A Claims Validation Platform",page_title:"Baseline",page_label:"A Claims Validation Platform",center_desktop:false},metadata:{example_statements:["update the title fields"]}};var i=t.schema;unpackKwargs(e,i,"updateTitle");var o=document.title.split(" : ");if(i.app_title){o[0]=i.app_title}if(i.app_subtitle){o[1]=i.app_subtitle}document.title=o.join(" : ");var n=["#header_title_desktop_text","#header_title_mobile_text"];for(var a=0;a<n.length;a++){header_id=n[a];if(!i.page_label){$(header_id).removeAttr("title")}else{$(header_id).attr("title",i.page_label)}$(header_id).text(i.page_title)}var s="#header_title_desktop";if(i.center_desktop){$(s).removeClass("navbar-start");$(s).addClass("navbar-center")}else{$(s).removeClass("navbar-center");$(s).addClass("navbar-start")}}function openDocumentation(e=""){function t(t){openDashboard();var i={app_title:window.app_title,app_subtitle:"API Documentation",page_title:"API Documentation",page_label:"View API Documentation",center_desktop:true};updateTitle(i);var o="documentation";var n="#documentation_container";var a='<div id="documentation_container" class="container content-container-scroll"></div>';toggleView(n,a);const s=syntaxHighlight(JSON.stringify(t,undefined,2));const r='<pre class="text-wrap pre-json">'+s+"</pre>";$(n).html(r);scrollDiv(e)}var i=ingestString();requestingResource({route:"/api/v1",method:"GET"}).done(function(e){logConsole(e.schema);t(e)})}function openProfile(e=""){function t(t=null){openDashboard();var i={center_desktop:true};updateTitle(i);toggleNavigation("User Profile");var o="profile";var n="#profile_container";var a='<div id="profile_container" class="container content-container-scroll"></div>';toggleView(n,a);if(t){const e=' value="'+ingestString(t.name_first)+'"';const i=' value="'+ingestString(t.name_last)+'"';const o=' value="'+ingestString(t.address)+'"';const a=' value="'+ingestString(t.policy_id)+'"';const s=ingestBoolean(t.status);const r=sprintf('                <section class="section-last">                    <div class="form-line text-left">                        <div class="col-xs-12 margin-bottom-5">                            <div class="form-text auto-height text-wrap">First Name:</div>                        </div>                        <div class="col-xs-12 margin-bottom-20">                            <form title="First Name">                                <div class="row">                                    <div class="col-xs-12">                                        <label for="name_first_input" class="sr-only">First Name:</label>                                        <input id="name_first_input" type="text" class="form-input"%s>                                    </div>                                </div>                            </form>                        </div>                    </div>                    <div class="form-line text-left">                        <div class="col-xs-12 margin-bottom-5">                            <div class="form-text auto-height text-wrap">Last Name:</div>                        </div>                        <div class="col-xs-12 margin-bottom-20">                            <form title="Last Name">                                <div class="row">                                    <div class="col-xs-12">                                        <label for="name_last_input" class="sr-only">Last Name:</label>                                        <input id="name_last_input" type="text" class="form-input"%s>                                    </div>                                </div>                            </form>                        </div>                    </div>                    <div class="form-line text-left">                        <div class="col-xs-12 margin-bottom-5">                            <div class="form-text auto-height text-wrap">Address:</div>                        </div>                        <div class="col-xs-12 margin-bottom-20">                            <form title="Address">                                <div class="row">                                    <div class="col-xs-12">                                        <label for="address_input" class="sr-only">Address:</label>                                        <input id="address_input" type="text" class="form-input"%s>                                    </div>                                </div>                            </form>                        </div>                    </div>                    <div class="form-line text-left">                        <div class="col-xs-12 margin-bottom-5">                            <div class="form-text auto-height text-wrap">Policy ID:</div>                        </div>                        <div class="col-xs-12 margin-bottom-20">                            <form title="Policy ID">                                <div class="row">                                    <div class="col-xs-12">                                        <label for="policy_id_input" class="sr-only">Policy ID:</label>                                        <input id="policy_id_input" type="text" class="form-input"%s>                                    </div>                                </div>                            </form>                        </div>                    </div>                    <div class="form-line text-left">                        <div id="account_status_id" class="col-lg-3 col-md-3 col-sm-3 col-xs-12 form-button margin-bottom-5">Activate Service</div>                        <div class="col-xs-12 font-text margin-bottom-20 text-wrap">By activating the service, you are allowing Baseline to dispatch a quadcopter to your address and collect photos of the exterior of your property and infrastructure sometime this week weather permitting as well as once every year from this date.</div>                    </div>                </section>',e,i,o,a);$(n).html(r);const l="#account_status_id";$(l).click(function(){var e=$(l).text();if(e=="Activate Service"){$(l).text("Deactivate Service");$(l).addClass("form-button-off");$(l).removeClass("form-button")}else{$(l).text("Activate Service");$(l).removeClass("form-button-off");$(l).addClass("form-button")}})}scrollDiv(e)}var i=ingestString(localStorage.getItem("access_token"));requestingResource({route:"/account",method:"GET",params:{token:i}}).done(function(e){logConsole(e);t(e.details)}).fail(function(e){errorDialog(e)})}function openFlight(e=""){function t(t=null){openDashboard();var i={center_desktop:true};updateTitle(i);toggleNavigation("Flight Plan");var o="flight";var n="#flight_container";var a='<div id="flight_container" class="container content-container-scroll"></div>';toggleView(n,a);if(t){const e=syntaxHighlight(JSON.stringify(t,undefined,2));const i='<pre class="text-wrap pre-json">'+e+"</pre>";$(n).html(i)}scrollDiv(e)}var i=ingestString(localStorage.getItem("access_token"));requestingResource({route:"/account",method:"GET",params:{token:i}}).done(function(e){logConsole(e);t(e.details)}).fail(function(e){errorDialog(e)})}function openReport(e=""){function t(t=null){openDashboard();var i={center_desktop:true};updateTitle(i);toggleNavigation("Image Report");var o="report";var n="#report_container";var a='<div id="report_container" class="container content-container-scroll"></div>';toggleView(n,a);if(t){var s=sprintf('                <div class="row">                    <div id="%s_index" class="col-lg-3 col-md-3 col-sm-3 col-xs-12"></div>                    <div id="%s_main" class="col-lg-9 col-md-9 col-sm-9 hidden-xs"></div>                </div>',o,o);$(n).html(s);const e="#"+o+"_index";const i="#"+o+"_main";const a="#"+o+"_index_update";const v="#"+o+"_main_update";const u="#"+o+"_main_active";var r=sprintf('                <section class="section-row">                    <div class="row form-line">                        <div class="col-xs-12 font-title no-wrap">%s</div>                    </div>                    <div class="row form-line">                        <div class="col-xs-1"></div><div id="report_index_update" class="col-xs-4 form-button">Update</div>                    </div>                </section>',t.address);$(r).appendTo(e);var l=sprintf('                <section class="section-row">                    <div class="row form-line">                        <div class="col-xs-10 form-title no-wrap">%s</div><div id="report_main_update" class="col-xs-2 form-button">Update</div>                    </div>                    <div id="report_main_active"></div>                </section>',t.address);$(l).appendTo(i);for(var c=0;c<t.waypoints.length;c++){const i=t.waypoints[c];const o=sprintf("%s, %s",i.lat.toString(),i.lon.toString());for(var d=0;d<i.photos.length;d++){const t=i.photos[d];const n=sprintf('                        <section class="section-row">                            <div class="row form-line">                                <div class="col-xs-3">%s</div>                                <div class="col-xs-6">%s</div>                                <div class="col-xs-3">%sft</div>                            </div>                            <div id="report_index_photo_%s_%s" class="row form-line">                                <div class="col-xs-12">                                    <table><tbody><tr><td align="center">                                        <img src="%s" style="width:100%%;height:auto;margin-left:auto;margin-right:auto;">                                    </td></tr></tbody></table>                                </div>                            </div>                        </section>',t.date,o,t.elevation,c,d,t.src);$(n).appendTo(e);const a=sprintf("#report_index_photo_%s_%s",c,d);$(a).click(function(){$(u).html(n)});if(c==0&&d==0){$(u).html(n)}}}}scrollDiv(e)}var i=ingestString(localStorage.getItem("access_token"));requestingResource({route:"/account",method:"GET",params:{token:i}}).done(function(e){logConsole(e);t(e.details)}).fail(function(e){errorDialog(e)})}function openBlank(){openDashboard();var e={center_desktop:true};updateTitle(e);var t="blank";var i="#blank_container";var o='<div id="blank_container" class="container content-container-fill"></div>';toggleView(i,o);var n='        <div id="center_middle" class="center-middle">            <img src="/public/images/baseline-logo-600.png" class="icon-landing font-watermark hidden-lg hidden-md hidden-sm">            <img src="/public/images/baseline-logo-600.png" class="font-watermark hidden-xs">        </div>';$(i).html(n)}function openDashboard(){$("#landing_container").remove();$(".dashboard-view").each(function(e){if(!$(this).is(":visible")){$(this).show()}});$(".landing-view").each(function(e){if($(this).is(":visible")){$(this).hide()}});$(".header-border").addClass("navbar-border");$(".header-border").addClass("navbar-accent");var e={links:[{icon:"icon-user",name:"User Profile",label:"View User Profile",onclick:"openProfile"},{icon:"icon-location-pin",name:"Flight Plan",label:"View Flight Plan",onclick:"openFlight"},{icon:"icon-chart",name:"Image Report",onclick:"openReport",label:"View Image Report"}]};updateNavigation(e)}function landingView(){const e="#content";const t="#logo_button";const i='        <div id="landing_container">            <div id="center_middle" class="center-middle">                <div class="burst-effect">                    <a id="logo_button"><img src="/public/images/logo.svg" class="icon-thumb"></a>                </div>            </div>        </div>';$(e).html(i);$("#header_desktop,#footer_mobile").empty();$(".dashboard-view").each(function(e){if($(this).is(":visible")){$(this).hide()}});$(".landing-view").each(function(e){if(!$(this).is(":visible")){$(this).show()}});$(".header-border").removeClass("navbar-border");$(".header-border").removeClass("navbar-accent");$(t).click(function(){openProfile()})}function signOut(){for(var e=0;e<localStorage.length;++e){var t=localStorage.key(e);localStorage.removeItem(t)}logConsole("All records deleted from Local Storage.");landingView()}var device_handlers={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,false);document.addEventListener("DOMContentLoaded",this.onDeviceReady,false)},bindHeaders:function(){$("#menu_button").click(function(){slideoutDialog("#dialog_menu","left")});menu_details={sections:[{actions:[{icon:"icon-home",name:"Policy Address",onclick:"registerDialog",label:"Change Policy Address"},{icon:"icon-doc",name:"Documentation",onclick:"openDocumentation",label:"View API Documentation"},{icon:"icon-logout",name:"Sign-Out",onclick:"signOut",label:"Sign Out from Laboratory"}]},{actions:[{icon:"icon-social-twitter",name:"Twitter",onclick:"open",args:["https://twitter.com/CollectiveAcuit"],label:"Open Twitter Page"},{icon:"icon-social-facebook",name:"Facebook",onclick:"open",args:["https://www.facebook.com/collectiveacuity/"],label:"Open Facebook Page"}]}]};menuBindings(menu_details);$("#info_button").click(function(){var e={title:"Mission",description:"Statement of purpose for the laboratory.",effective_date:"2016.05.31.13.45.55",author:"Collective Acuity",details:"To make accessible to each individual the resources of the world."};blockquoteDialog(e)});$("#header_title_text_mobile, #header_title_text_desktop").click(function(){$("html, body").animate({scrollTop:0},500)})},onDeviceOffline:function(){window.device_online=false;console.log("Device Offline")},onDeviceOnline:function(){window.device_online=true;console.log("Device Online")},constructWindow:function(){window.device_online=true;window.system_environment="dev";window.app_title="Baseline";window.server_protocol=location.protocol;window.server_domain=document.domain;window.server_port=location.port;window.server_url=window.server_protocol+"//"+window.server_domain;if(window.server_port){window.server_url+=":"+window.server_port}},loadLibraries:function(){var e=new $.Deferred;var t=[];e.resolve();return e.promise()},openView:function(){var e=retrieveParams();if("address"in e){var t=e["address"];localStorage.setItem("access_token",t)}if("view"in e){var i=e["view"];var o="";if("section"in e){o=e["section"]}if(i=="documentation"){openDocumentation(o)}else if(i=="profile"){openProfile(o)}}else{if(!$.trim($("#content").html())){landingView()}}},onDeviceReady:function(){device_handlers.constructWindow();device_handlers.bindHeaders();device_handlers.loadLibraries();device_handlers.openView();document.addEventListener("offline",device_handlers.onDeviceOffline,false);document.addEventListener("online",device_handlers.onDeviceOnline,false);console.log("Device Ready")}};device_handlers.initialize();